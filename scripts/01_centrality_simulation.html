<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Björn S. Siepe">
<meta name="author" content="Matthias Kloft">
<meta name="author" content="Fridtjof Petersen">
<meta name="author" content="Yong Zhang">
<meta name="author" content="Laura F. Bringmann">
<meta name="author" content="Daniel W. Heck">
<meta name="dcterms.date" content="2025-04-11">

<title>Using features of dynamic networks to guide treatment selection and outcome prediction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="01_centrality_simulation_files/libs/clipboard/clipboard.min.js"></script>
<script src="01_centrality_simulation_files/libs/quarto-html/quarto.js"></script>
<script src="01_centrality_simulation_files/libs/quarto-html/popper.min.js"></script>
<script src="01_centrality_simulation_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="01_centrality_simulation_files/libs/quarto-html/anchor.min.js"></script>
<link href="01_centrality_simulation_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="01_centrality_simulation_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="01_centrality_simulation_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="01_centrality_simulation_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="01_centrality_simulation_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background"><span class="header-section-number">1</span> Background</a></li>
  <li><a href="#data-generation" id="toc-data-generation" class="nav-link" data-scroll-target="#data-generation"><span class="header-section-number">2</span> Data Generation</a>
  <ul class="collapse">
  <li><a href="#data-generating-processes" id="toc-data-generating-processes" class="nav-link" data-scroll-target="#data-generating-processes"><span class="header-section-number">2.1</span> Data-Generating Processes</a></li>
  <li><a href="#setting-parameters" id="toc-setting-parameters" class="nav-link" data-scroll-target="#setting-parameters"><span class="header-section-number">2.2</span> Setting parameters</a></li>
  <li><a href="#simulating-data" id="toc-simulating-data" class="nav-link" data-scroll-target="#simulating-data"><span class="header-section-number">2.3</span> Simulating Data</a></li>
  </ul></li>
  <li><a href="#analysis" id="toc-analysis" class="nav-link" data-scroll-target="#analysis"><span class="header-section-number">3</span> Analysis</a></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">4</span> Summary</a></li>
  <li><a href="#executing-simulation" id="toc-executing-simulation" class="nav-link" data-scroll-target="#executing-simulation"><span class="header-section-number">5</span> Executing Simulation</a></li>
  <li><a href="#write-to-standard-r-script" id="toc-write-to-standard-r-script" class="nav-link" data-scroll-target="#write-to-standard-r-script"><span class="header-section-number">6</span> Write to standard R script</a></li>
  <li><a href="#resummarize-after-fixing-details-in-summary-function" id="toc-resummarize-after-fixing-details-in-summary-function" class="nav-link" data-scroll-target="#resummarize-after-fixing-details-in-summary-function"><span class="header-section-number">7</span> Resummarize after fixing details in summary function</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Using features of dynamic networks to guide treatment selection and outcome prediction</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
<p class="subtitle lead">Simulation Code</p>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Authors</div>
  <div class="quarto-title-meta-heading">Affiliations</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Björn S. Siepe <a href="https://orcid.org/0000-0002-9558-4648" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Marburg
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Matthias Kloft <a href="https://orcid.org/0000-0003-1845-6957" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Marburg
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Fridtjof Petersen <a href="https://orcid.org/0000-0002-4913-8532" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Groningen
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Yong Zhang <a href="https://orcid.org/0000-0002-6313-2575" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Groningen
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Laura F. Bringmann <a href="https://orcid.org/0000-0002-8091-9935" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Groningen
          </p>
      </div>
    <div class="quarto-title-meta-contents">
    <p class="author">Daniel W. Heck <a href="https://orcid.org/0000-0002-6302-9252" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Marburg
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 11, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="background" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Background</h1>
<p>This script contains the <code>SimDesign</code> code for the simulation study. The visualization of the results is done in the <code>05_simulation_viz.qmd</code> script.</p>
<p>We first load all relevant packages:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(SimDesign)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mlVAR)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(graphicalVAR)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gimme)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(future)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corpcor)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"scripts"</span>, <span class="st">"00_functions.R"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="data-generation" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Data Generation</h1>
<section id="data-generating-processes" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="data-generating-processes"><span class="header-section-number">2.1</span> Data-Generating Processes</h2>
<p>Load DGP based on estimated network structures:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># non-sparse Graph to simulate from</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>graph_nonsparse <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/graph_semisparse_synth.RDS"</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sparse DGP</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>graph_sparse <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/graph_semisparse_synth.RDS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="setting-parameters" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="setting-parameters"><span class="header-section-number">2.2</span> Setting parameters</h2>
<p>We define the conditions and the fixed parameters for the simulation.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dgp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sparse"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of timepoints</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>n_tp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">60</span>, <span class="dv">120</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>heterogeneity <span class="ot">&lt;-</span> <span class="st">"high"</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulation parameters</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of individuals </span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>n_id <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">75</span>, <span class="dv">200</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Design Conditions</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>df_design <span class="ot">&lt;-</span> SimDesign<span class="sc">::</span><span class="fu">createDesign</span>(</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">dgp =</span> dgp,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_id =</span> n_id,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">heterogeneity =</span> heterogeneity,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_tp =</span> n_tp</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of variables</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>n_var <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co"># for regression</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>reg_error_sd <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Should GIMME use only nondirected contemporaneous effects?</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>gimme_var_only <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Should GIMME return partial correlations?</span></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>gimme_pcor <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Should data for non-Bayesian methods be person-mean centered?</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>mean_center <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="co"># random effects sds</span></span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="co"># beta_sd &lt;- 0.1</span></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co"># kappa_sd &lt;- 0.1</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="co"># # Strength of the correlation</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="co"># hard-coded down below</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="co"># beta_reg &lt;- c(0, 0.2, 0.4)</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>sim_pars <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_id =</span> n_id,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_var =</span> n_var,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># n_tp = n_tp,</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  <span class="at">reg_error_sd =</span> reg_error_sd,</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="co"># beta_sd = beta_sd,</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  <span class="co"># kappa_sd = kappa_sd,</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>  <span class="at">graph_nonsparse =</span> graph_nonsparse,</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>  <span class="at">graph_sparse =</span> graph_sparse,</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>  <span class="at">gimme_var_only =</span> gimme_var_only,</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_center =</span> mean_center</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Pre-compiling the Stan model</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>model_name <span class="ot">&lt;-</span> <span class="st">"MLVAR_lkj_only"</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Compile model</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>sim_pars<span class="sc">$</span>mlvar_model <span class="ot">&lt;-</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  rstan<span class="sc">::</span><span class="fu">stan_model</span>(</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">file =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"scripts"</span>, <span class="st">"models"</span>, <span class="fu">paste0</span>(model_name, <span class="st">".stan"</span>)),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">model_name =</span> model_name</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To simulate data with a specific correlation, we need to obtain the true standard deviation of the different centrality measures. For the temporal network, this is easy to compute, as it just follows from the random effects of the VAR matrix. For the partial correlations, this is a bit more complicated, as we simulate from the true covariance matrix, but calculate the centrality based on the partial correlation matrix. Therefore, we just simulate a large number of partial correlation matrices for the data-generating process of each condition and then calculate the implied standard deviation of the centrality measure.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of simulations to obtain sd</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>n_sim_sd <span class="ot">&lt;-</span> <span class="dv">30000</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>sd_results_strength <span class="ot">&lt;-</span> sd_results_outstrength <span class="ot">&lt;-</span> sd_results_instrength <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, <span class="at">length =</span> <span class="fu">nrow</span>(df_design))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(df_design)){</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  condition <span class="ot">&lt;-</span> df_design[i,]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  dgp_graph <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(condition<span class="sc">$</span>dgp <span class="sc">==</span> <span class="st">"sparse"</span>, </span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"graph_sparse"</span>, </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"graph_nonsparse"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  beta_sd <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(condition<span class="sc">$</span>heterogeneity <span class="sc">==</span> <span class="st">"low"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                    <span class="fl">0.05</span>,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                    <span class="fl">0.075</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  sigma_sd <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(condition<span class="sc">$</span>heterogeneity <span class="sc">==</span> <span class="st">"low"</span>,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                    <span class="fl">0.05</span>,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                    <span class="fl">0.075</span>)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  ml_sim <span class="ot">&lt;-</span> <span class="fu">sim_gvar_loop</span>(</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                     <span class="at">graph =</span> sim_pars[[dgp_graph]],</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">beta_sd =</span> beta_sd,</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">kappa_sd =</span> kappa_sd,</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sigma_sd =</span> sigma_sd, </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_person =</span> n_sim_sd,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_time =</span> condition<span class="sc">$</span>n_tp,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_node =</span> sim_pars<span class="sc">$</span>n_var,</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">max_try =</span> <span class="dv">1000</span>,</span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">listify =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sim_pkg =</span> <span class="st">"mlVAR"</span>,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sparse_sim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">most_cent_diff_temp =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">most_cent_diff_temp_min =</span> <span class="fl">0.05</span>,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">most_cent_diff_cont =</span> <span class="cn">TRUE</span>,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">most_cent_diff_cont_min =</span> <span class="fl">0.05</span>,</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">innov_var_fixed_sigma =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtain true centralities</span></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  true_cent <span class="ot">&lt;-</span> <span class="fu">centrality_mlvar_sim</span>(ml_sim,</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">sim_fn =</span> <span class="st">"sim_gvar_loop"</span>)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  strength <span class="ot">&lt;-</span> <span class="fu">sapply</span>(true_cent<span class="sc">$</span>strength, <span class="st">`</span><span class="at">[</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  outstrength <span class="ot">&lt;-</span> <span class="fu">sapply</span>(true_cent<span class="sc">$</span>outstrength, <span class="st">`</span><span class="at">[</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  instrength <span class="ot">&lt;-</span> <span class="fu">sapply</span>(true_cent<span class="sc">$</span>instrength, <span class="st">`</span><span class="at">[</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  strength_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(strength)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  outstrength_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(outstrength)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>  instrength_sd <span class="ot">&lt;-</span> <span class="fu">sd</span>(instrength)</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>  sd_results_strength[[i]] <span class="ot">&lt;-</span> strength_sd</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  sd_results_outstrength[[i]] <span class="ot">&lt;-</span> outstrength_sd</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  sd_results_instrength[[i]] <span class="ot">&lt;-</span> instrength_sd</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>sd_results <span class="ot">&lt;-</span> <span class="fu">list</span>(sd_results_strength, sd_results_outstrength, sd_results_instrength)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sd_results) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sd_results_strength"</span>, <span class="st">"sd_results_outstrength"</span>, <span class="st">"sd_results_instrength"</span>)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(sd_results, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"true_sd_semisparse.RDS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>As we only need to compute the true SD once, we can simply load it from disk to save time:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>true_sd <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"true_sd_semisparse.RDS"</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(true_sd) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sd_results_strength"</span>, <span class="st">"sd_results_outstrength"</span>, <span class="st">"sd_results_instrength"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df_design<span class="sc">$</span>strength_sd <span class="ot">&lt;-</span> <span class="fu">unlist</span>(true_sd<span class="sc">$</span>sd_results_strength)</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>df_design<span class="sc">$</span>outstrength_sd <span class="ot">&lt;-</span> <span class="fu">unlist</span>(true_sd<span class="sc">$</span>sd_results_outstrength)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>df_design<span class="sc">$</span>instrength_sd <span class="ot">&lt;-</span> <span class="fu">unlist</span>(true_sd<span class="sc">$</span>sd_results_instrength)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="simulating-data" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="simulating-data"><span class="header-section-number">2.3</span> Simulating Data</h2>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sim_generate <span class="ot">&lt;-</span> <span class="cf">function</span>(condition, <span class="at">fixed_objects =</span> <span class="cn">NULL</span>){</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">source</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"scripts"</span>, <span class="st">"00_functions.R"</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># obtain fixed params</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  SimDesign<span class="sc">::</span><span class="fu">Attach</span>(fixed_objects)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  dgp_graph <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(condition<span class="sc">$</span>dgp <span class="sc">==</span> <span class="st">"sparse"</span>, </span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"graph_sparse"</span>, </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"graph_nonsparse"</span>)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  beta_sd <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(condition<span class="sc">$</span>heterogeneity <span class="sc">==</span> <span class="st">"low"</span>,</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                    <span class="fl">0.05</span>,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                    <span class="fl">0.075</span>)</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  sigma_sd <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(condition<span class="sc">$</span>heterogeneity <span class="sc">==</span> <span class="st">"low"</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                    <span class="fl">0.05</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                    <span class="fl">0.075</span>)</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale kappa random effects w.r.t diagonal elements</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  mean_diag_kappa <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">diag</span>(fixed_objects[[dgp_graph]]<span class="sc">$</span>kappa)) </span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  kappa_sd_low <span class="ot">&lt;-</span> <span class="fl">0.05</span> <span class="sc">*</span> mean_diag_kappa</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  kappa_sd_high <span class="ot">&lt;-</span> <span class="fl">0.075</span> <span class="sc">*</span> mean_diag_kappa</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  kappa_sd <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(condition<span class="sc">$</span>heterogeneity <span class="sc">==</span> <span class="st">"low"</span>,</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>                     kappa_sd_low,</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>                     kappa_sd_high)</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  ml_sim <span class="ot">&lt;-</span> <span class="fu">sim_gvar_loop</span>(</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>                     <span class="at">graph =</span> fixed_objects[[dgp_graph]],</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>                     <span class="at">beta_sd =</span> beta_sd,</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>                     <span class="at">kappa_sd =</span> kappa_sd,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sigma_sd =</span> sigma_sd, </span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_person =</span> condition<span class="sc">$</span>n_id,</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_time =</span> condition<span class="sc">$</span>n_tp,</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">n_node =</span> n_var,</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">max_try =</span> <span class="dv">10000</span>,</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>                     <span class="at">listify =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sim_pkg =</span> <span class="st">"mlVAR"</span>,</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">sparse_sim =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>                     <span class="at">most_cent_diff_temp =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>                     <span class="at">most_cent_diff_temp_min =</span> <span class="fl">0.05</span>,</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>                     <span class="at">most_cent_diff_cont =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>                     <span class="at">most_cent_diff_cont_min =</span> <span class="fl">0.05</span>,</span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>                     <span class="at">innov_var_fixed_sigma =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(ml_sim<span class="sc">$</span>beta))){</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Generation of Betas failed"</span>)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(ml_sim<span class="sc">$</span>pcor))){</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Generation of PCORs failed"</span>)</span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  } </span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtain true centralities</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>  true_cent <span class="ot">&lt;-</span> <span class="fu">centrality_mlvar_sim</span>(ml_sim,</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">sim_fn =</span> <span class="st">"sim_gvar_loop"</span>)</span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtain true centralities</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  instrength <span class="ot">&lt;-</span> <span class="fu">sapply</span>(true_cent<span class="sc">$</span>instrength, <span class="st">`</span><span class="at">[</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>  outstrength <span class="ot">&lt;-</span> <span class="fu">sapply</span>(true_cent<span class="sc">$</span>outstrength, <span class="st">`</span><span class="at">[</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  strength <span class="ot">&lt;-</span> <span class="fu">sapply</span>(true_cent<span class="sc">$</span>strength, <span class="st">`</span><span class="at">[</span><span class="st">`</span>, <span class="dv">1</span>)</span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Simulate correlated data with true variance of centralities</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># first column is the density to keep track of the density</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># and for compatibility with an old sim function</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>  sim_correlated <span class="ot">&lt;-</span> <span class="cf">function</span>(density, </span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>                             r_true, </span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>                             sd_true){</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  y_matrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> <span class="fu">length</span>(density), <span class="at">ncol =</span> <span class="fu">length</span>(r_true) <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  y_matrix[, <span class="dv">1</span>] <span class="ot">&lt;-</span> density</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_along</span>(r_true)) {</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>    sd_error <span class="ot">&lt;-</span> sd_true <span class="sc">*</span> <span class="fu">sqrt</span>(<span class="dv">1</span> <span class="sc">-</span> r_true[i]<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>    y_matrix[, i <span class="sc">+</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> r_true[i] <span class="sc">*</span> density <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(density), <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sd_error)</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(y_matrix)</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>  <span class="co"># True density standard deviations would just be the random effects sds</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>  <span class="co"># divided by the sqrt(n) -&gt; it's just the standard deviation of the average</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of multiple independent random variables. BUT we convert to partial </span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a>  <span class="co"># correlations, and we take the absolute values, so we just approximate</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the true SD with a monte carlo approach</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>  covariate_cont_strength <span class="ot">&lt;-</span> <span class="fu">sim_correlated</span>(<span class="at">density =</span> strength,</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">r_true =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>),</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">sd_true =</span> condition<span class="sc">$</span>strength_sd)</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>  covariate_in_strength <span class="ot">&lt;-</span> <span class="fu">sim_correlated</span>(<span class="at">density =</span> instrength, </span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">r_true =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>), </span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>                                          <span class="at">sd_true =</span> condition<span class="sc">$</span>instrength_sd)</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>  covariate_out_strength <span class="ot">&lt;-</span> <span class="fu">sim_correlated</span>(<span class="at">density =</span> outstrength, </span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">r_true =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>), </span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">sd_true =</span> condition<span class="sc">$</span>outstrength_sd)</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">sd</span>(instrength) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"No variation in instrength"</span>)</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">sd</span>(outstrength) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"No variation in outstrength"</span>)</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">sd</span>(strength) <span class="sc">==</span> <span class="dv">0</span>){</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"No variation in strength"</span>)</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Sanity checks</span></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a>  cor_strength <span class="ot">&lt;-</span> <span class="fu">cor</span>(covariate_cont_strength[,<span class="dv">1</span>], covariate_cont_strength)</span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>  cor_instrength <span class="ot">&lt;-</span> <span class="fu">cor</span>(covariate_in_strength[,<span class="dv">1</span>], covariate_in_strength)</span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>  cor_outstrength <span class="ot">&lt;-</span> <span class="fu">cor</span>(covariate_out_strength[,<span class="dv">1</span>], covariate_out_strength)</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return data and true centralities</span></span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>  ret_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> ml_sim<span class="sc">$</span>data,</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta =</span> ml_sim<span class="sc">$</span>beta_l,</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>    <span class="at">kappa =</span> ml_sim<span class="sc">$</span>kappa_l,</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>    <span class="at">pcor =</span> ml_sim<span class="sc">$</span>pcor_l,</span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>    <span class="at">covariate_cont_strength =</span> covariate_cont_strength,</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">covariate_out_strength =</span> covariate_out_strength,</span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a>    <span class="at">covariate_in_strength =</span> covariate_in_strength,</span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_cent =</span> true_cent,</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co"> delete these</span></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>    <span class="at">cor_strength =</span> cor_strength,</span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>    <span class="at">cor_instrength =</span> cor_instrength,</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>    <span class="at">cor_outstrength =</span> cor_outstrength</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ret_data)</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="analysis" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Analysis</h1>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>sim_analyse <span class="ot">&lt;-</span> <span class="cf">function</span>(condition, dat, <span class="at">fixed_objects =</span> <span class="cn">NULL</span>){</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Preparation</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  SimDesign<span class="sc">::</span><span class="fu">Attach</span>(fixed_objects)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if mean centering option is true, if so, mean center</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">isTRUE</span>(fixed_objects<span class="sc">$</span>mean_center)){</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>data_centered <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dat<span class="sc">$</span>data, <span class="cf">function</span>(x){</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>      x <span class="sc">|&gt;</span> </span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">|&gt;</span> </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> . <span class="sc">-</span> <span class="fu">mean</span>(.)))</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Concatenate list of data into dataframe with id column</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  df_data_centered <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(purrr<span class="sc">::</span><span class="fu">map</span>(dat<span class="sc">$</span>data_centered, dplyr<span class="sc">::</span>as_tibble)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                              , <span class="at">.id =</span> <span class="st">"ID"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.factor</span>(ID))</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  df_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(purrr<span class="sc">::</span><span class="fu">map</span>(dat<span class="sc">$</span>data, dplyr<span class="sc">::</span>as_tibble)</span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>                              , <span class="at">.id =</span> <span class="st">"ID"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">as.factor</span>(ID))</span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>  n_id <span class="ot">&lt;-</span> condition<span class="sc">$</span>n_id</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- graphicalVAR</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit models</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a>  fit_gvar <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dat<span class="sc">$</span>data_centered, <span class="cf">function</span>(x){</span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tryCatch</span>({<span class="fu">suppressMessages</span>(graphicalVAR<span class="sc">::</span><span class="fu">graphicalVAR</span>(x, </span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a>                               <span class="at">nLambda =</span> <span class="dv">50</span>,</span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a>                               <span class="at">verbose =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a>                               <span class="at">gamma =</span> <span class="dv">0</span>, </span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a>                               <span class="at">scale =</span> <span class="cn">FALSE</span>))}, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(fit_gvar))){</span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Not all GVAR models converged."</span>)</span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtain centralities, IDs nested in list</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a>  cent_gvar <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">transpose</span>(<span class="fu">lapply</span>(fit_gvar, <span class="cf">function</span>(x){</span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">centrality_gvar</span>(x)</span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a>  }))</span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a>  dens_temp_gvar <span class="ot">&lt;-</span> <span class="fu">unlist</span>(cent_gvar<span class="sc">$</span>dens_temp)</span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>  dens_cont_gvar <span class="ot">&lt;-</span> <span class="fu">unlist</span>(cent_gvar<span class="sc">$</span>dens_cont)</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>  outstrength_gvar <span class="ot">&lt;-</span> <span class="fu">lapply</span>(cent_gvar<span class="sc">$</span>outstrength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x))</span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a>  instrength_gvar <span class="ot">&lt;-</span> <span class="fu">lapply</span>(cent_gvar<span class="sc">$</span>instrength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x))</span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a>  strength_gvar <span class="ot">&lt;-</span> <span class="fu">lapply</span>(cent_gvar<span class="sc">$</span>strength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x))</span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a>  instrength_gvar_first <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cent_gvar<span class="sc">$</span>instrength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x[<span class="dv">1</span>]))</span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a>  strength_gvar_first <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cent_gvar<span class="sc">$</span>strength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x[<span class="dv">1</span>]))</span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a>  outstrength_gvar_first <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cent_gvar<span class="sc">$</span>outstrength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x[<span class="dv">1</span>]))</span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create list of subject-specific estimates</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a>  beta_gvar <span class="ot">&lt;-</span> <span class="fu">lapply</span>(fit_gvar, <span class="cf">function</span>(x){</span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>beta[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a>  pcor_gvar <span class="ot">&lt;-</span> <span class="fu">lapply</span>(fit_gvar, <span class="cf">function</span>(x){</span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>PCC</span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit regression</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>  reg_gvar_in_strength <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(i) <span class="fu">lm</span>(dat<span class="sc">$</span>covariate_in_strength[, i] <span class="sc">~</span> instrength_gvar_first))</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>  reg_gvar_cont_strength <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(i) <span class="fu">lm</span>(dat<span class="sc">$</span>covariate_cont_strength[, i] <span class="sc">~</span> strength_gvar_first))</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>  reg_gvar_out_strength <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(i) <span class="fu">lm</span>(dat<span class="sc">$</span>covariate_out_strength[, i] <span class="sc">~</span> outstrength_gvar_first))</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove fit object to save memory</span></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(fit_gvar)</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- GIMME</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit model</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>  fit_gimme <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({gimme<span class="sc">::</span><span class="fu">gimme</span>(dat<span class="sc">$</span>data_centered,</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a>                            <span class="at">ar =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>                            <span class="at">subgroup =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>                            <span class="at">plot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>                            <span class="at">hybrid =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>                            <span class="at">groupcutoff =</span> .<span class="dv">75</span>,</span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a>                            <span class="at">subcutoff =</span> .<span class="dv">75</span>,</span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>                            <span class="at">VAR =</span> gimme_var_only)}, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(fit_gimme))){</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"GIMME did not converge."</span>)</span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># for var_only, we need to first extract the contemporaneous matrices</span></span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">isTRUE</span>(gimme_var_only)){</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>    fit_gimme<span class="sc">$</span>contemp_mat <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(fit_gimme<span class="sc">$</span>path_est_mats), <span class="cf">function</span>(i){</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gimme_cor_mat</span>(fit_gimme, <span class="at">id =</span> i, <span class="at">n_vars =</span> n_var, <span class="at">pcor =</span> fixed_objects<span class="sc">$</span>gimme_pcor)</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a>  cent_gimme <span class="ot">&lt;-</span> <span class="fu">centrality_gimme</span>(fit_gimme,</span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">var_only =</span> gimme_var_only)</span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtain centralities</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a>  dens_temp_gimme <span class="ot">&lt;-</span> <span class="fu">unlist</span>(cent_gimme<span class="sc">$</span>dens_temp)</span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a>  dens_cont_gimme <span class="ot">&lt;-</span> <span class="fu">unlist</span>(cent_gimme<span class="sc">$</span>dens_cont)</span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>  outstrength_gimme <span class="ot">&lt;-</span> <span class="fu">lapply</span>(cent_gimme<span class="sc">$</span>outstrength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x))</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a>  instrength_gimme <span class="ot">&lt;-</span> <span class="fu">lapply</span>(cent_gimme<span class="sc">$</span>instrength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x))</span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>  strength_gimme <span class="ot">&lt;-</span> <span class="fu">lapply</span>(cent_gimme<span class="sc">$</span>strength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x))</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>  outstrength_gimme_first <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cent_gimme<span class="sc">$</span>outstrength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x[<span class="dv">1</span>]))</span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a>  instrength_gimme_first <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cent_gimme<span class="sc">$</span>instrength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x[<span class="dv">1</span>]))</span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a>  strength_gimme_first <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cent_gimme<span class="sc">$</span>strength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x[<span class="dv">1</span>]))</span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create list of subject-specific estimates</span></span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a>  beta_gimme <span class="ot">&lt;-</span> <span class="fu">lapply</span>(fit_gimme<span class="sc">$</span>path_est_mats, <span class="cf">function</span>(x){</span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>    x[,<span class="dv">1</span><span class="sc">:</span>n_var]</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">isFALSE</span>(gimme_var_only)){</span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>      pcor_gimme <span class="ot">&lt;-</span> <span class="fu">lapply</span>(fit_gimme<span class="sc">$</span>path_est_mats, <span class="cf">function</span>(x){</span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>    x[, (n_var<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(n_var<span class="sc">*</span><span class="dv">2</span>)]</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">isTRUE</span>(gimme_var_only)){</span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a>    pcor_gimme <span class="ot">&lt;-</span> <span class="fu">lapply</span>(fit_gimme<span class="sc">$</span>contemp_mat, <span class="cf">function</span>(x){</span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a>      x</span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit regression</span></span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>  reg_gimme_in_strength <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(i) <span class="fu">lm</span>(dat<span class="sc">$</span>covariate_in_strength[, i] <span class="sc">~</span> instrength_gimme_first))</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>  reg_gimme_cont_strength <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(i) <span class="fu">lm</span>(dat<span class="sc">$</span>covariate_cont_strength[, i] <span class="sc">~</span> strength_gimme_first))</span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a>  reg_gimme_out_strength <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(i) <span class="fu">lm</span>(dat<span class="sc">$</span>covariate_out_strength[, i] <span class="sc">~</span> outstrength_gimme_first))</span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(fit_gimme)</span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>  <span class="co"># #--- frequentist mlVAR</span></span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit model</span></span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>  fit_mlvar <span class="ot">&lt;-</span> <span class="fu">tryCatch</span>({<span class="fu">suppressWarnings</span>(mlVAR<span class="sc">::</span><span class="fu">mlVAR</span>(df_data_centered,</span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>                            <span class="at">vars =</span> <span class="fu">paste0</span>(<span class="st">"V"</span>, <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span>n_var)),</span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>                            <span class="at">idvar =</span> <span class="st">"ID"</span>,</span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a>                            <span class="at">estimator =</span> <span class="st">"lmer"</span>,</span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a>                            <span class="at">contemporaneous =</span> <span class="st">"correlated"</span>,</span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a>                            <span class="at">temporal =</span> <span class="st">"correlated"</span>,</span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a>                            <span class="at">nCores =</span> <span class="dv">1</span>,</span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a>                            <span class="at">scale =</span> <span class="cn">FALSE</span>))}, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>)</span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(fit_mlvar))){</span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"mlVAR did not converge."</span>)</span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtain centralities</span></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a>  cent_mlvar <span class="ot">&lt;-</span> <span class="fu">centrality_mlvar</span>(fit_mlvar)</span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a>  dens_temp_mlvar <span class="ot">&lt;-</span> <span class="fu">unlist</span>(cent_mlvar<span class="sc">$</span>dens_temp)</span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>  dens_cont_mlvar <span class="ot">&lt;-</span> <span class="fu">unlist</span>(cent_mlvar<span class="sc">$</span>dens_cont)</span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>  outstrength_mlvar <span class="ot">&lt;-</span> <span class="fu">lapply</span>(cent_mlvar<span class="sc">$</span>outstrength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x))</span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a>  strength_mlvar <span class="ot">&lt;-</span> <span class="fu">lapply</span>(cent_mlvar<span class="sc">$</span>strength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x))</span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>  instrength_mlvar <span class="ot">&lt;-</span> <span class="fu">lapply</span>(cent_mlvar<span class="sc">$</span>instrength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x))</span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>  outstrength_mlvar_first <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cent_mlvar<span class="sc">$</span>outstrength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x[<span class="dv">1</span>]))</span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>  instrength_mlvar_first <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cent_mlvar<span class="sc">$</span>instrength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x[<span class="dv">1</span>]))</span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a>  strength_mlvar_first <span class="ot">&lt;-</span> <span class="fu">sapply</span>(cent_mlvar<span class="sc">$</span>strength, <span class="cf">function</span>(x) <span class="fu">unname</span>(x[<span class="dv">1</span>]))</span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create list of subject-specific estimates</span></span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>  beta_mlvar <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>n_id, <span class="cf">function</span>(i){</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a>    <span class="fu">t</span>(mlVAR<span class="sc">::</span><span class="fu">getNet</span>(fit_mlvar,</span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subject =</span> i,</span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type =</span> <span class="st">"temporal"</span>,</span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nonsig =</span> <span class="st">"show"</span>))</span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a>  pcor_mlvar <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span>n_id, <span class="cf">function</span>(i){</span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>    mlVAR<span class="sc">::</span><span class="fu">getNet</span>(fit_mlvar,</span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>                  <span class="at">subject =</span> i,</span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a>                  <span class="at">type =</span> <span class="st">"contemporaneous"</span>,</span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a>                  <span class="at">nonsig =</span> <span class="st">"show"</span>)</span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a>  <span class="co"># # Calculate fixed effects adjacency matrix</span></span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a>  adj_mat_beta <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">ifelse</span>(</span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a>    mlVAR<span class="sc">::</span><span class="fu">getNet</span>(fit_mlvar,</span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"temporal"</span>,</span>
<span id="cb8-181"><a href="#cb8-181" aria-hidden="true" tabindex="-1"></a>       <span class="at">nonsig =</span> <span class="st">"hide"</span>) <span class="sc">!=</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>))</span>
<span id="cb8-182"><a href="#cb8-182" aria-hidden="true" tabindex="-1"></a>  adj_mat_pcor <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(</span>
<span id="cb8-183"><a href="#cb8-183" aria-hidden="true" tabindex="-1"></a>    mlVAR<span class="sc">::</span><span class="fu">getNet</span>(fit_mlvar,</span>
<span id="cb8-184"><a href="#cb8-184" aria-hidden="true" tabindex="-1"></a>       <span class="at">type =</span> <span class="st">"contemporaneous"</span>,</span>
<span id="cb8-185"><a href="#cb8-185" aria-hidden="true" tabindex="-1"></a>       <span class="at">nonsig =</span> <span class="st">"hide"</span>) <span class="sc">!=</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb8-186"><a href="#cb8-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-187"><a href="#cb8-187" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set effects to zero</span></span>
<span id="cb8-188"><a href="#cb8-188" aria-hidden="true" tabindex="-1"></a>  beta_mlvar <span class="ot">&lt;-</span> <span class="fu">lapply</span>(beta_mlvar, <span class="cf">function</span>(i){</span>
<span id="cb8-189"><a href="#cb8-189" aria-hidden="true" tabindex="-1"></a>    i <span class="sc">*</span> adj_mat_beta</span>
<span id="cb8-190"><a href="#cb8-190" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-191"><a href="#cb8-191" aria-hidden="true" tabindex="-1"></a>  pcor_mlvar <span class="ot">&lt;-</span> <span class="fu">lapply</span>(pcor_mlvar, <span class="cf">function</span>(i){</span>
<span id="cb8-192"><a href="#cb8-192" aria-hidden="true" tabindex="-1"></a>    i <span class="sc">*</span> adj_mat_pcor</span>
<span id="cb8-193"><a href="#cb8-193" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-194"><a href="#cb8-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-195"><a href="#cb8-195" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Fit regression</span></span>
<span id="cb8-196"><a href="#cb8-196" aria-hidden="true" tabindex="-1"></a>  reg_mlvar_in_strength <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(i) <span class="fu">lm</span>(dat<span class="sc">$</span>covariate_in_strength[, i] <span class="sc">~</span> instrength_mlvar_first))</span>
<span id="cb8-197"><a href="#cb8-197" aria-hidden="true" tabindex="-1"></a>  reg_mlvar_cont_strength <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(i) <span class="fu">lm</span>(dat<span class="sc">$</span>covariate_cont_strength[, i] <span class="sc">~</span> strength_mlvar_first))</span>
<span id="cb8-198"><a href="#cb8-198" aria-hidden="true" tabindex="-1"></a>  reg_mlvar_out_strength <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>, <span class="cf">function</span>(i) <span class="fu">lm</span>(dat<span class="sc">$</span>covariate_out_strength[, i] <span class="sc">~</span> outstrength_mlvar_first))</span>
<span id="cb8-199"><a href="#cb8-199" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-200"><a href="#cb8-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(fit_mlvar)</span>
<span id="cb8-201"><a href="#cb8-201" aria-hidden="true" tabindex="-1"></a>  <span class="co"># </span></span>
<span id="cb8-202"><a href="#cb8-202" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Bayesian mlVAR</span></span>
<span id="cb8-203"><a href="#cb8-203" aria-hidden="true" tabindex="-1"></a>  <span class="co"># indicators for partial correlations</span></span>
<span id="cb8-204"><a href="#cb8-204" aria-hidden="true" tabindex="-1"></a>  idx_rho <span class="ot">&lt;-</span> <span class="fu">upper.tri</span>(<span class="fu">matrix</span>(<span class="dv">1</span>, n_var, n_var, <span class="at">byrow =</span> F)) <span class="sc">|&gt;</span> </span>
<span id="cb8-205"><a href="#cb8-205" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>() <span class="sc">|&gt;</span> </span>
<span id="cb8-206"><a href="#cb8-206" aria-hidden="true" tabindex="-1"></a>      <span class="fu">which</span>()</span>
<span id="cb8-207"><a href="#cb8-207" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-208"><a href="#cb8-208" aria-hidden="true" tabindex="-1"></a>  reg_data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(</span>
<span id="cb8-209"><a href="#cb8-209" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>covariate_in_strength[, <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>],</span>
<span id="cb8-210"><a href="#cb8-210" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>covariate_out_strength[, <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>],</span>
<span id="cb8-211"><a href="#cb8-211" aria-hidden="true" tabindex="-1"></a>    dat<span class="sc">$</span>covariate_cont_strength[, <span class="dv">2</span><span class="sc">:</span><span class="dv">4</span>]</span>
<span id="cb8-212"><a href="#cb8-212" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-213"><a href="#cb8-213" aria-hidden="true" tabindex="-1"></a>  Y <span class="ot">&lt;-</span> df_data <span class="sc">|&gt;</span> </span>
<span id="cb8-214"><a href="#cb8-214" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="st">"ID"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb8-215"><a href="#cb8-215" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.matrix</span>()</span>
<span id="cb8-216"><a href="#cb8-216" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-217"><a href="#cb8-217" aria-hidden="true" tabindex="-1"></a>  n_tp <span class="ot">&lt;-</span> condition<span class="sc">$</span>n_tp</span>
<span id="cb8-218"><a href="#cb8-218" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-219"><a href="#cb8-219" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Prepare stan data</span></span>
<span id="cb8-220"><a href="#cb8-220" aria-hidden="true" tabindex="-1"></a>  stan_data <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-221"><a href="#cb8-221" aria-hidden="true" tabindex="-1"></a>    <span class="at">K =</span> n_var,</span>
<span id="cb8-222"><a href="#cb8-222" aria-hidden="true" tabindex="-1"></a>    <span class="at">I =</span> n_id,</span>
<span id="cb8-223"><a href="#cb8-223" aria-hidden="true" tabindex="-1"></a>    <span class="at">P =</span> <span class="dv">9</span>,   <span class="co"># number of regression outcomes</span></span>
<span id="cb8-224"><a href="#cb8-224" aria-hidden="true" tabindex="-1"></a>    <span class="at">N_total =</span> n_id <span class="sc">*</span> n_tp,</span>
<span id="cb8-225"><a href="#cb8-225" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_t =</span> <span class="fu">rep</span>(n_tp, n_id),</span>
<span id="cb8-226"><a href="#cb8-226" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_pc =</span> n_var <span class="sc">*</span> (n_var <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span>,</span>
<span id="cb8-227"><a href="#cb8-227" aria-hidden="true" tabindex="-1"></a>    <span class="at">idx_rho =</span> <span class="fu">array</span>(idx_rho, <span class="at">dim =</span> <span class="fu">length</span>(idx_rho)),</span>
<span id="cb8-228"><a href="#cb8-228" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> Y,</span>
<span id="cb8-229"><a href="#cb8-229" aria-hidden="true" tabindex="-1"></a>    <span class="at">reg_covariate =</span> reg_data,</span>
<span id="cb8-230"><a href="#cb8-230" aria-hidden="true" tabindex="-1"></a>    <span class="at">sparsity =</span> <span class="dv">2</span>,</span>
<span id="cb8-231"><a href="#cb8-231" aria-hidden="true" tabindex="-1"></a>    <span class="co"># should lagged estimates be mean-centered?</span></span>
<span id="cb8-232"><a href="#cb8-232" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_center =</span> <span class="dv">1</span></span>
<span id="cb8-233"><a href="#cb8-233" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-234"><a href="#cb8-234" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-235"><a href="#cb8-235" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-236"><a href="#cb8-236" aria-hidden="true" tabindex="-1"></a>  fit_bmlvar <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">sampling</span>(</span>
<span id="cb8-237"><a href="#cb8-237" aria-hidden="true" tabindex="-1"></a>  <span class="at">object =</span> fixed_objects<span class="sc">$</span>mlvar_model,</span>
<span id="cb8-238"><a href="#cb8-238" aria-hidden="true" tabindex="-1"></a>  <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"Beta_raw"</span>, <span class="st">"Intercepts_raw"</span>, <span class="st">"L_Theta"</span>, <span class="st">"Rho"</span>, <span class="st">"lp__"</span>),</span>
<span id="cb8-239"><a href="#cb8-239" aria-hidden="true" tabindex="-1"></a>  <span class="at">include =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-240"><a href="#cb8-240" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> stan_data,</span>
<span id="cb8-241"><a href="#cb8-241" aria-hidden="true" tabindex="-1"></a>  <span class="co"># seed = 2023,</span></span>
<span id="cb8-242"><a href="#cb8-242" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb8-243"><a href="#cb8-243" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">1</span>,</span>
<span id="cb8-244"><a href="#cb8-244" aria-hidden="true" tabindex="-1"></a>  <span class="at">warmup =</span> <span class="dv">500</span>,</span>
<span id="cb8-245"><a href="#cb8-245" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">1000</span>,</span>
<span id="cb8-246"><a href="#cb8-246" aria-hidden="true" tabindex="-1"></a>  <span class="at">init =</span> <span class="dv">0</span>,</span>
<span id="cb8-247"><a href="#cb8-247" aria-hidden="true" tabindex="-1"></a>  <span class="at">control =</span> <span class="fu">list</span>(<span class="at">adapt_delta =</span> <span class="fl">0.90</span>),</span>
<span id="cb8-248"><a href="#cb8-248" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">FALSE</span></span>
<span id="cb8-249"><a href="#cb8-249" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-250"><a href="#cb8-250" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-251"><a href="#cb8-251" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">inherits</span>(fit_bmlvar, <span class="st">"stanfit"</span>)){</span>
<span id="cb8-252"><a href="#cb8-252" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"BmlVAR model failed."</span>)</span>
<span id="cb8-253"><a href="#cb8-253" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-254"><a href="#cb8-254" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-255"><a href="#cb8-255" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transpose beta matrices for later summaries</span></span>
<span id="cb8-256"><a href="#cb8-256" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in the DGP, cols represent lagged vars</span></span>
<span id="cb8-257"><a href="#cb8-257" aria-hidden="true" tabindex="-1"></a>  <span class="co"># but in BmlVAR, rows represent lagged vars</span></span>
<span id="cb8-258"><a href="#cb8-258" aria-hidden="true" tabindex="-1"></a>  ests_bmlvar <span class="ot">&lt;-</span> <span class="fu">extract_all_estimates</span>(fit_bmlvar,</span>
<span id="cb8-259"><a href="#cb8-259" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">n_id =</span> n_id, </span>
<span id="cb8-260"><a href="#cb8-260" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">n_var =</span> n_var, </span>
<span id="cb8-261"><a href="#cb8-261" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">transpose_beta =</span> <span class="cn">FALSE</span>,</span>
<span id="cb8-262"><a href="#cb8-262" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">pcor_matrix =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-263"><a href="#cb8-263" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-264"><a href="#cb8-264" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtain centralities</span></span>
<span id="cb8-265"><a href="#cb8-265" aria-hidden="true" tabindex="-1"></a>  dens_temp_bmlvar <span class="ot">&lt;-</span> ests_bmlvar<span class="sc">$</span>tempdens_est<span class="sc">$</span>median</span>
<span id="cb8-266"><a href="#cb8-266" aria-hidden="true" tabindex="-1"></a>  dens_cont_bmlvar <span class="ot">&lt;-</span> ests_bmlvar<span class="sc">$</span>contdens_est<span class="sc">$</span>median</span>
<span id="cb8-267"><a href="#cb8-267" aria-hidden="true" tabindex="-1"></a>  instrength_bmlvar <span class="ot">&lt;-</span> ests_bmlvar<span class="sc">$</span>instrength_est<span class="sc">$</span>median</span>
<span id="cb8-268"><a href="#cb8-268" aria-hidden="true" tabindex="-1"></a>  outstrength_bmlvar <span class="ot">&lt;-</span> ests_bmlvar<span class="sc">$</span>outstrength_est<span class="sc">$</span>median</span>
<span id="cb8-269"><a href="#cb8-269" aria-hidden="true" tabindex="-1"></a>  strength_bmlvar <span class="ot">&lt;-</span> ests_bmlvar<span class="sc">$</span>pcor_centrality_est<span class="sc">$</span>median</span>
<span id="cb8-270"><a href="#cb8-270" aria-hidden="true" tabindex="-1"></a>  outstrength_bmlvar_first <span class="ot">&lt;-</span> <span class="fu">sapply</span>(ests_bmlvar<span class="sc">$</span>outstrength_est<span class="sc">$</span>median, <span class="cf">function</span>(x) <span class="fu">unname</span>(x[<span class="dv">1</span>]))</span>
<span id="cb8-271"><a href="#cb8-271" aria-hidden="true" tabindex="-1"></a>  strength_bmlvar_first <span class="ot">&lt;-</span> <span class="fu">sapply</span>(ests_bmlvar<span class="sc">$</span>pcor_centrality_est<span class="sc">$</span>median, <span class="cf">function</span>(x) <span class="fu">unname</span>(x[<span class="dv">1</span>]))</span>
<span id="cb8-272"><a href="#cb8-272" aria-hidden="true" tabindex="-1"></a>  instrength_bmlvar_first <span class="ot">&lt;-</span> <span class="fu">sapply</span>(ests_bmlvar<span class="sc">$</span>instrength_est<span class="sc">$</span>median, <span class="cf">function</span>(x) <span class="fu">unname</span>(x[<span class="dv">1</span>]))</span>
<span id="cb8-273"><a href="#cb8-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-274"><a href="#cb8-274" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Obtain regression coefficients</span></span>
<span id="cb8-275"><a href="#cb8-275" aria-hidden="true" tabindex="-1"></a>  reg_bmlvar <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-276"><a href="#cb8-276" aria-hidden="true" tabindex="-1"></a>    <span class="at">regression_intercept =</span> ests_bmlvar<span class="sc">$</span>regression_intercept_est, </span>
<span id="cb8-277"><a href="#cb8-277" aria-hidden="true" tabindex="-1"></a>    <span class="at">regression_slope =</span> ests_bmlvar<span class="sc">$</span>regression_slope_est)</span>
<span id="cb8-278"><a href="#cb8-278" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-279"><a href="#cb8-279" aria-hidden="true" tabindex="-1"></a>  <span class="co"># save summary, but not the c_summary of individual chains</span></span>
<span id="cb8-280"><a href="#cb8-280" aria-hidden="true" tabindex="-1"></a>  summary_bmlvar <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">summary</span>(fit_bmlvar,</span>
<span id="cb8-281"><a href="#cb8-281" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">pars =</span> <span class="fu">c</span>(<span class="st">"Beta"</span>,</span>
<span id="cb8-282"><a href="#cb8-282" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"mu_Beta"</span>,</span>
<span id="cb8-283"><a href="#cb8-283" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"sigma_Beta"</span>,</span>
<span id="cb8-284"><a href="#cb8-284" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"mu_Intercepts"</span>,</span>
<span id="cb8-285"><a href="#cb8-285" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"sigma_Intercepts"</span>,</span>
<span id="cb8-286"><a href="#cb8-286" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"reg_intercept"</span>,</span>
<span id="cb8-287"><a href="#cb8-287" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"reg_slope_density"</span>,</span>
<span id="cb8-288"><a href="#cb8-288" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"sigma_residual"</span>,</span>
<span id="cb8-289"><a href="#cb8-289" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"Intercepts"</span>,</span>
<span id="cb8-290"><a href="#cb8-290" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"Sigma"</span>,</span>
<span id="cb8-291"><a href="#cb8-291" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"Rho_vec"</span>,</span>
<span id="cb8-292"><a href="#cb8-292" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"Beta_out_strength"</span>,</span>
<span id="cb8-293"><a href="#cb8-293" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"Beta_in_strength"</span>,</span>
<span id="cb8-294"><a href="#cb8-294" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"Rho_strength"</span>,</span>
<span id="cb8-295"><a href="#cb8-295" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"mu_regression"</span>,</span>
<span id="cb8-296"><a href="#cb8-296" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"reg_slope_density_z"</span>,</span>
<span id="cb8-297"><a href="#cb8-297" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"reg_intercept_z"</span>,</span>
<span id="cb8-298"><a href="#cb8-298" aria-hidden="true" tabindex="-1"></a>                                            <span class="st">"theta_sd"</span>))<span class="sc">$</span>summary</span>
<span id="cb8-299"><a href="#cb8-299" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-300"><a href="#cb8-300" aria-hidden="true" tabindex="-1"></a>  <span class="co"># remove some posterior descriptives</span></span>
<span id="cb8-301"><a href="#cb8-301" aria-hidden="true" tabindex="-1"></a>  summary_bmlvar <span class="ot">&lt;-</span> summary_bmlvar[, <span class="sc">!</span>(<span class="fu">colnames</span>(summary_bmlvar) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"25%"</span>, <span class="st">"75%"</span>))]</span>
<span id="cb8-302"><a href="#cb8-302" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-303"><a href="#cb8-303" aria-hidden="true" tabindex="-1"></a>  <span class="co"># convergence diagnostics</span></span>
<span id="cb8-304"><a href="#cb8-304" aria-hidden="true" tabindex="-1"></a>  rhat_bmlvar_tmp <span class="ot">&lt;-</span> summary_bmlvar <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> <span class="fu">pull</span>(Rhat)</span>
<span id="cb8-305"><a href="#cb8-305" aria-hidden="true" tabindex="-1"></a>  rhat_bmlvar_tmp <span class="ot">&lt;-</span> rhat_bmlvar_tmp[<span class="sc">!</span><span class="fu">is.nan</span>(rhat_bmlvar_tmp)]</span>
<span id="cb8-306"><a href="#cb8-306" aria-hidden="true" tabindex="-1"></a>  rhat_bmlvar_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(rhat_bmlvar_tmp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb8-307"><a href="#cb8-307" aria-hidden="true" tabindex="-1"></a>  rhat_bmlvar_11 <span class="ot">&lt;-</span> <span class="fu">sum</span>(rhat_bmlvar_tmp <span class="sc">&gt;</span> <span class="fl">1.1</span>)<span class="sc">/</span><span class="fu">length</span>(rhat_bmlvar_tmp)</span>
<span id="cb8-308"><a href="#cb8-308" aria-hidden="true" tabindex="-1"></a>  divtrans_bmlvar <span class="ot">&lt;-</span> rstan<span class="sc">::</span><span class="fu">get_num_divergent</span>(fit_bmlvar)</span>
<span id="cb8-309"><a href="#cb8-309" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-310"><a href="#cb8-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rm</span>(fit_bmlvar)</span>
<span id="cb8-311"><a href="#cb8-311" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-312"><a href="#cb8-312" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Return Results</span></span>
<span id="cb8-313"><a href="#cb8-313" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Also return true centralities for comparison later</span></span>
<span id="cb8-314"><a href="#cb8-314" aria-hidden="true" tabindex="-1"></a>  ret_results <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb8-315"><a href="#cb8-315" aria-hidden="true" tabindex="-1"></a>    <span class="at">gvar =</span> <span class="fu">list</span>(</span>
<span id="cb8-316"><a href="#cb8-316" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit_gvar =</span> <span class="fu">list</span>(</span>
<span id="cb8-317"><a href="#cb8-317" aria-hidden="true" tabindex="-1"></a>        <span class="at">beta =</span> beta_gvar,</span>
<span id="cb8-318"><a href="#cb8-318" aria-hidden="true" tabindex="-1"></a>        <span class="at">pcor =</span> pcor_gvar),</span>
<span id="cb8-319"><a href="#cb8-319" aria-hidden="true" tabindex="-1"></a>      <span class="at">dens_temp =</span> dens_temp_gvar,</span>
<span id="cb8-320"><a href="#cb8-320" aria-hidden="true" tabindex="-1"></a>      <span class="at">dens_cont =</span> dens_cont_gvar,</span>
<span id="cb8-321"><a href="#cb8-321" aria-hidden="true" tabindex="-1"></a>      <span class="at">outstrength =</span> outstrength_gvar,</span>
<span id="cb8-322"><a href="#cb8-322" aria-hidden="true" tabindex="-1"></a>      <span class="at">strength =</span> strength_gvar,</span>
<span id="cb8-323"><a href="#cb8-323" aria-hidden="true" tabindex="-1"></a>      <span class="at">instrength =</span> instrength_gvar,</span>
<span id="cb8-324"><a href="#cb8-324" aria-hidden="true" tabindex="-1"></a>      <span class="at">reg_instrength =</span> reg_gvar_in_strength,</span>
<span id="cb8-325"><a href="#cb8-325" aria-hidden="true" tabindex="-1"></a>      <span class="at">reg_strength =</span> reg_gvar_cont_strength,</span>
<span id="cb8-326"><a href="#cb8-326" aria-hidden="true" tabindex="-1"></a>      <span class="at">reg_outstrength =</span> reg_gvar_out_strength</span>
<span id="cb8-327"><a href="#cb8-327" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-328"><a href="#cb8-328" aria-hidden="true" tabindex="-1"></a>    <span class="at">gimme =</span> <span class="fu">list</span>(</span>
<span id="cb8-329"><a href="#cb8-329" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit_gimme =</span> <span class="fu">list</span>(</span>
<span id="cb8-330"><a href="#cb8-330" aria-hidden="true" tabindex="-1"></a>        <span class="at">beta =</span> beta_gimme,</span>
<span id="cb8-331"><a href="#cb8-331" aria-hidden="true" tabindex="-1"></a>        <span class="at">pcor =</span> pcor_gimme</span>
<span id="cb8-332"><a href="#cb8-332" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-333"><a href="#cb8-333" aria-hidden="true" tabindex="-1"></a>      <span class="at">dens_temp =</span> dens_temp_gimme,</span>
<span id="cb8-334"><a href="#cb8-334" aria-hidden="true" tabindex="-1"></a>      <span class="at">dens_cont =</span> dens_cont_gimme,</span>
<span id="cb8-335"><a href="#cb8-335" aria-hidden="true" tabindex="-1"></a>      <span class="at">outstrength =</span> outstrength_gimme,</span>
<span id="cb8-336"><a href="#cb8-336" aria-hidden="true" tabindex="-1"></a>      <span class="at">strength =</span> strength_gimme,</span>
<span id="cb8-337"><a href="#cb8-337" aria-hidden="true" tabindex="-1"></a>      <span class="at">instrength =</span> instrength_gimme,</span>
<span id="cb8-338"><a href="#cb8-338" aria-hidden="true" tabindex="-1"></a>      <span class="at">reg_instrength =</span> reg_gimme_in_strength,</span>
<span id="cb8-339"><a href="#cb8-339" aria-hidden="true" tabindex="-1"></a>      <span class="at">reg_strength =</span> reg_gimme_cont_strength,</span>
<span id="cb8-340"><a href="#cb8-340" aria-hidden="true" tabindex="-1"></a>      <span class="at">reg_outstrength =</span> reg_gimme_out_strength</span>
<span id="cb8-341"><a href="#cb8-341" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-342"><a href="#cb8-342" aria-hidden="true" tabindex="-1"></a>    <span class="at">mlvar =</span> <span class="fu">list</span>(</span>
<span id="cb8-343"><a href="#cb8-343" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit_mlvar =</span> <span class="fu">list</span>(</span>
<span id="cb8-344"><a href="#cb8-344" aria-hidden="true" tabindex="-1"></a>        <span class="at">beta =</span> beta_mlvar,</span>
<span id="cb8-345"><a href="#cb8-345" aria-hidden="true" tabindex="-1"></a>        <span class="at">pcor =</span> pcor_mlvar),</span>
<span id="cb8-346"><a href="#cb8-346" aria-hidden="true" tabindex="-1"></a>      <span class="at">dens_temp =</span> dens_temp_mlvar,</span>
<span id="cb8-347"><a href="#cb8-347" aria-hidden="true" tabindex="-1"></a>      <span class="at">dens_cont =</span> dens_cont_mlvar,</span>
<span id="cb8-348"><a href="#cb8-348" aria-hidden="true" tabindex="-1"></a>      <span class="at">outstrength =</span> outstrength_mlvar,</span>
<span id="cb8-349"><a href="#cb8-349" aria-hidden="true" tabindex="-1"></a>      <span class="at">strength =</span> strength_mlvar,</span>
<span id="cb8-350"><a href="#cb8-350" aria-hidden="true" tabindex="-1"></a>      <span class="at">instrength =</span> instrength_mlvar,</span>
<span id="cb8-351"><a href="#cb8-351" aria-hidden="true" tabindex="-1"></a>      <span class="at">reg_instrength =</span> reg_mlvar_in_strength,</span>
<span id="cb8-352"><a href="#cb8-352" aria-hidden="true" tabindex="-1"></a>      <span class="at">reg_strength =</span> reg_mlvar_cont_strength,</span>
<span id="cb8-353"><a href="#cb8-353" aria-hidden="true" tabindex="-1"></a>      <span class="at">reg_outstrength =</span> reg_mlvar_out_strength</span>
<span id="cb8-354"><a href="#cb8-354" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-355"><a href="#cb8-355" aria-hidden="true" tabindex="-1"></a>    <span class="at">bmlvar =</span> <span class="fu">list</span>(</span>
<span id="cb8-356"><a href="#cb8-356" aria-hidden="true" tabindex="-1"></a>      <span class="at">fit_bmlvar =</span> <span class="fu">list</span>(</span>
<span id="cb8-357"><a href="#cb8-357" aria-hidden="true" tabindex="-1"></a>        <span class="at">beta =</span> ests_bmlvar<span class="sc">$</span>beta_est<span class="sc">$</span>median,</span>
<span id="cb8-358"><a href="#cb8-358" aria-hidden="true" tabindex="-1"></a>        <span class="at">pcor =</span> ests_bmlvar<span class="sc">$</span>pcor_est<span class="sc">$</span>median</span>
<span id="cb8-359"><a href="#cb8-359" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb8-360"><a href="#cb8-360" aria-hidden="true" tabindex="-1"></a>      <span class="at">dens_temp =</span> dens_temp_bmlvar,</span>
<span id="cb8-361"><a href="#cb8-361" aria-hidden="true" tabindex="-1"></a>      <span class="at">dens_cont =</span> dens_cont_bmlvar,</span>
<span id="cb8-362"><a href="#cb8-362" aria-hidden="true" tabindex="-1"></a>      <span class="at">outstrength =</span> outstrength_bmlvar,</span>
<span id="cb8-363"><a href="#cb8-363" aria-hidden="true" tabindex="-1"></a>      <span class="at">strength =</span> strength_bmlvar,</span>
<span id="cb8-364"><a href="#cb8-364" aria-hidden="true" tabindex="-1"></a>      <span class="at">instrength =</span> instrength_bmlvar,</span>
<span id="cb8-365"><a href="#cb8-365" aria-hidden="true" tabindex="-1"></a>      <span class="at">reg_bmlvar =</span> reg_bmlvar,</span>
<span id="cb8-366"><a href="#cb8-366" aria-hidden="true" tabindex="-1"></a>      <span class="at">ests_bmlvar =</span> ests_bmlvar,</span>
<span id="cb8-367"><a href="#cb8-367" aria-hidden="true" tabindex="-1"></a>      <span class="at">summary_bmlvar =</span> summary_bmlvar,</span>
<span id="cb8-368"><a href="#cb8-368" aria-hidden="true" tabindex="-1"></a>      <span class="at">rhat_bmlvar_mean =</span> rhat_bmlvar_mean,</span>
<span id="cb8-369"><a href="#cb8-369" aria-hidden="true" tabindex="-1"></a>      <span class="at">rhat_bmlvar_11 =</span> rhat_bmlvar_11,</span>
<span id="cb8-370"><a href="#cb8-370" aria-hidden="true" tabindex="-1"></a>      <span class="at">divtrans_bmlvar =</span> divtrans_bmlvar</span>
<span id="cb8-371"><a href="#cb8-371" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb8-372"><a href="#cb8-372" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_cent =</span> dat<span class="sc">$</span>true_cent,</span>
<span id="cb8-373"><a href="#cb8-373" aria-hidden="true" tabindex="-1"></a>    <span class="at">covariate_cont_strength =</span> dat<span class="sc">$</span>covariate_cont_strength,</span>
<span id="cb8-374"><a href="#cb8-374" aria-hidden="true" tabindex="-1"></a>    <span class="at">covariate_in_strength =</span> dat<span class="sc">$</span>covariate_in_strength,</span>
<span id="cb8-375"><a href="#cb8-375" aria-hidden="true" tabindex="-1"></a>    <span class="at">covariate_out_strength =</span> dat<span class="sc">$</span>covariate_out_strength,</span>
<span id="cb8-376"><a href="#cb8-376" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> dat<span class="sc">$</span>data,</span>
<span id="cb8-377"><a href="#cb8-377" aria-hidden="true" tabindex="-1"></a>    <span class="at">beta =</span> dat<span class="sc">$</span>beta,</span>
<span id="cb8-378"><a href="#cb8-378" aria-hidden="true" tabindex="-1"></a>    <span class="at">kappa =</span> dat<span class="sc">$</span>kappa,</span>
<span id="cb8-379"><a href="#cb8-379" aria-hidden="true" tabindex="-1"></a>    <span class="at">pcor =</span> dat<span class="sc">$</span>pcor,</span>
<span id="cb8-380"><a href="#cb8-380" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_cor_strength =</span> dat<span class="sc">$</span>cor_strength,</span>
<span id="cb8-381"><a href="#cb8-381" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_cor_instrength =</span> dat<span class="sc">$</span>cor_instrength,</span>
<span id="cb8-382"><a href="#cb8-382" aria-hidden="true" tabindex="-1"></a>    <span class="at">true_cor_outstrength =</span> dat<span class="sc">$</span>cor_outstrength</span>
<span id="cb8-383"><a href="#cb8-383" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-384"><a href="#cb8-384" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-385"><a href="#cb8-385" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-386"><a href="#cb8-386" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ret_results)</span>
<span id="cb8-387"><a href="#cb8-387" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-388"><a href="#cb8-388" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="summary" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Summary</h1>
<p>To note about data structure: - GVAR fit: cols as lagged, also in the DGP - mlVAR fit: rows as lagged, cols as contemp –&gt; now transposed - gimme fit: cols as lagged - bmlVAR fit: different data structure, but uses rows as lagged</p>
<p>However, with the new sim function, we do not transpose anymore! We simulate from <code>graphicalVARsim</code>, so in the true DGP, columns represent the nodes of origin.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>sim_summarise <span class="ot">&lt;-</span> <span class="cf">function</span>(condition, results, <span class="at">fixed_objects =</span> <span class="cn">NULL</span>){</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Preparation</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  SimDesign<span class="sc">::</span><span class="fu">Attach</span>(fixed_objects)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  ret <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  n_id <span class="ot">&lt;-</span> condition<span class="sc">$</span>n_id</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Global settings</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  use_lm_beta <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Parameter recovery  </span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># IMPORTANT: Keep in mind structure of sim object (rows vs. cols)</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="co">#-- RMSE</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  summary_calc <span class="ot">&lt;-</span> <span class="cf">function</span>(results, method, fit, measure, func) {</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="fu">seq_along</span>(results), <span class="cf">function</span>(i){</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(results[[i]][[method]][[fit]])){</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unlist</span>(<span class="fu">func</span>(results[[i]][[method]][[fit]][[measure]], results[[i]][[measure]]))</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  methods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gvar"</span>, <span class="st">"gimme"</span>, <span class="st">"mlvar"</span>, <span class="st">"bmlvar"</span>)</span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  measures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"beta"</span>, <span class="st">"pcor"</span>)</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  funcs <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"rmse"</span> <span class="ot">=</span> rmse_mean_list, </span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>                <span class="st">"mse"</span> <span class="ot">=</span> mse_mean_list, </span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>                <span class="st">"bias"</span> <span class="ot">=</span> bias_mean_list)</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Loop to get summaries and save them into the ret list</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  rmse_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  mse_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (method <span class="cf">in</span> methods) {</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (measure <span class="cf">in</span> measures) {</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (func_name <span class="cf">in</span> <span class="fu">names</span>(funcs)) {</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>          result_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(func_name, measure, method, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>          calc_list <span class="ot">&lt;-</span> <span class="fu">summary_calc</span>(</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>            results, </span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>            method, </span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">"fit_"</span>, method), </span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>            measure, </span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>            funcs[[func_name]])</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>          mean_tmp <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(<span class="fu">apply</span>(<span class="fu">as.matrix</span>(calc_list), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), as.numeric))</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>          ret[[<span class="fu">paste0</span>(result_name, <span class="st">"_mean"</span>)]] <span class="ot">&lt;-</span> <span class="fu">mean</span>(mean_tmp)</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(func_name <span class="sc">==</span> <span class="st">"rmse"</span>){</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>            <span class="co"># calculate MSE, needed for MCSE of RMSE</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>            mse_tmp <span class="ot">&lt;-</span> <span class="fu">summary_calc</span>(</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>            results, </span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>            method, </span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>            <span class="fu">paste0</span>(<span class="st">"fit_"</span>, method), </span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>            measure, </span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>            funcs[[<span class="st">"mse"</span>]])</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>            mse_mean_tmp <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">colMeans</span>(<span class="fu">apply</span>(<span class="fu">as.matrix</span>(mse_tmp), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), as.numeric)))</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>            ret[[<span class="fu">paste0</span>(result_name, <span class="st">"_mcse"</span>)]] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(stats<span class="sc">::</span><span class="fu">var</span>(mean_tmp) <span class="sc">/</span> </span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>                                                          (<span class="dv">4</span> <span class="sc">*</span> n_rep <span class="sc">*</span> mse_mean_tmp))</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>          <span class="cf">else</span> <span class="cf">if</span>(func_name <span class="sc">==</span> <span class="st">"mse"</span>){</span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>            ret[[<span class="fu">paste0</span>(result_name, <span class="st">"_mcse"</span>)]] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(stats<span class="sc">::</span><span class="fu">var</span>(mean_tmp) <span class="sc">/</span> n_rep)</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>          <span class="cf">else</span> <span class="cf">if</span>(func_name <span class="sc">==</span> <span class="st">"bias"</span>){</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>            ret[[<span class="fu">paste0</span>(result_name, <span class="st">"_mcse"</span>)]] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(stats<span class="sc">::</span><span class="fu">var</span>(mean_tmp) <span class="sc">/</span> n_rep)</span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Centrality</span></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>  <span class="co">#-- Rank-Order between individuals</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>  calc_correlation <span class="ot">&lt;-</span> <span class="cf">function</span>(results, method, measure) {</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="fu">seq_along</span>(results), <span class="cf">function</span>(i){</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(results[[i]][[method]][[<span class="fu">paste0</span>(<span class="st">"fit_"</span>, method)]])){</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>      stats<span class="sc">::</span><span class="fu">cor</span>(results[[i]][[method]][[<span class="fu">paste0</span>(<span class="st">"dens_"</span>, measure)]], </span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">unlist</span>(results[[i]]<span class="sc">$</span>true_cent[[<span class="fu">paste0</span>(<span class="st">"dens_"</span>, measure)]]), </span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> <span class="st">"spearman"</span>)</span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Bootstrap the MCSE for the rank correlation</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>  bootstrap_rankcor <span class="ot">&lt;-</span> <span class="cf">function</span>(data, n_boot){</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>    bootstrap_res <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, n_boot)</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_boot){</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>      ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n_boot, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>      bootstrap_res[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(data[ind], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sd</span>(bootstrap_res, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a>  measures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"temp"</span>, <span class="st">"cont"</span>)</span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (method <span class="cf">in</span> methods) {</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (measure <span class="cf">in</span> measures) {</span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a>      result_name <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"rankcor"</span>, measure, method, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a>      calc_list <span class="ot">&lt;-</span> <span class="fu">calc_correlation</span>(</span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a>        <span class="at">results =</span> results,</span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> method,</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a>        <span class="at">measure =</span> measure)</span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>      mean_tmp <span class="ot">&lt;-</span> <span class="fu">mean</span>(calc_list)</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>      sd_tmp <span class="ot">&lt;-</span> <span class="fu">bootstrap_rankcor</span>(calc_list, <span class="dv">1000</span>)</span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a>      ret[[<span class="fu">paste0</span>(result_name, <span class="st">"_mean"</span>)]] <span class="ot">&lt;-</span> mean_tmp</span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a>      ret[[<span class="fu">paste0</span>(result_name, <span class="st">"_mcse"</span>)]] <span class="ot">&lt;-</span> sd_tmp</span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>  <span class="co">#-- Most central within individuals</span></span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>  calc_most_cent_ident <span class="ot">&lt;-</span> <span class="cf">function</span>(results, method, measure) {</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(<span class="fu">seq_along</span>(results), <span class="cf">function</span>(i){</span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">is.null</span>(results[[i]][[method]][<span class="fu">paste0</span>(<span class="st">"fit_"</span>, method)])){</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a>      } </span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>      <span class="cf">else</span>{</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>        mci <span class="ot">&lt;-</span> <span class="fu">most_cent_ident</span>(results[[i]][[method]][[measure]], </span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a>                              results[[i]]<span class="sc">$</span>true_cent[[measure]])</span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a>        <span class="co"># check if calculation worked to prevent error</span></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.vector</span>(mci) <span class="sc">|</span><span class="fu">is.null</span>(mci) <span class="sc">|</span> <span class="fu">is.null</span>(<span class="fu">unlist</span>(mci))){</span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a>          <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colSums</span>(<span class="fu">matrix</span>(<span class="fu">unlist</span>(mci), </span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nrow =</span> n_id, </span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>                      <span class="at">byrow =</span> <span class="cn">FALSE</span>))<span class="sc">/</span>n_id</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>  measures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"instrength"</span>, <span class="st">"outstrength"</span>, <span class="st">"strength"</span>)</span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(method <span class="cf">in</span> methods){</span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(measure <span class="cf">in</span> measures){</span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>      calc_list <span class="ot">&lt;-</span> <span class="fu">calc_most_cent_ident</span>(</span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>        <span class="at">results =</span> results, </span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a>        <span class="at">method =</span> method, </span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a>        <span class="at">measure =</span> measure)</span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a>        mean_tmp <span class="ot">&lt;-</span> <span class="fu">mean</span>(calc_list, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) </span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>        mcse_tmp <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(mean_tmp <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> mean_tmp) <span class="sc">/</span> n_rep)</span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(measure <span class="sc">==</span> <span class="st">"outstrength"</span>){</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a>        ret[[<span class="fu">paste0</span>(<span class="st">"mostcent_beta_"</span>, method, <span class="st">"_mean"</span>)]] <span class="ot">&lt;-</span> mean_tmp</span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a>        ret[[<span class="fu">paste0</span>(<span class="st">"mostcent_beta_"</span>, method, <span class="st">"_mcse"</span>)]] <span class="ot">&lt;-</span> mcse_tmp</span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span>(measure <span class="sc">==</span> <span class="st">"strength"</span>){</span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a>        ret[[<span class="fu">paste0</span>(<span class="st">"mostcent_pcor_"</span>, method, <span class="st">"_mean"</span>)]] <span class="ot">&lt;-</span> mean_tmp</span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>        ret[[<span class="fu">paste0</span>(<span class="st">"mostcent_pcor_"</span>, method, <span class="st">"_mcse"</span>)]] <span class="ot">&lt;-</span> mcse_tmp</span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Regression</span></span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a>  <span class="co">#-- Power</span></span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a>  regression_power <span class="ot">&lt;-</span> <span class="cf">function</span>(results, </span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a>                               method, </span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a>                               measure,</span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a>                               <span class="at">true_coef =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>,.<span class="dv">4</span>),</span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a>                               <span class="at">lm_beta =</span> use_lm_beta) {</span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="fu">seq_along</span>(results), <span class="cf">function</span>(i){</span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(results[[i]][[method]][[<span class="fu">paste0</span>(<span class="st">"reg_"</span>, measure)]])){</span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a>      reg_pvals <span class="ot">&lt;-</span> <span class="fu">sapply</span>(results[[i]][[method]][[<span class="fu">paste0</span>(<span class="st">"reg_"</span>, measure)]],</span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>                          <span class="cf">function</span>(x){</span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span>(<span class="fu">isTRUE</span>(lm_beta)){</span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a>                              res <span class="ot">&lt;-</span> <span class="fu">summary</span>(lm.beta<span class="sc">::</span><span class="fu">lm.beta</span>(x))<span class="sc">$</span>coefficients</span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a>                              res[<span class="dv">2</span>,<span class="dv">5</span>]</span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a>                            } <span class="cf">else</span>{</span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a>                              res <span class="ot">&lt;-</span> <span class="fu">summary</span>(x)<span class="sc">$</span>coefficients</span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a>                              res[<span class="dv">2</span>,<span class="dv">4</span>]</span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a>                            }})</span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate Empirical detection rate/power</span></span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ifelse</span>(reg_pvals <span class="sc">&lt;</span> .<span class="dv">05</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a>  <span class="co">#-- Summary</span></span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a>  true_coef <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">2</span>, .<span class="dv">4</span>)</span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a>  regression_summary <span class="ot">&lt;-</span> <span class="cf">function</span>(results, </span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a>                              method, </span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a>                              measure,</span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a>                              <span class="at">true_coef =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>,.<span class="dv">4</span>),</span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a>                              <span class="at">lm_beta =</span> use_lm_beta,</span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a>                              <span class="at">summary =</span> <span class="st">"rmse"</span>) {</span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="fu">seq_along</span>(results), <span class="cf">function</span>(i){</span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(results[[i]][[method]][[<span class="fu">paste0</span>(<span class="st">"reg_"</span>, measure)]])){</span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a>      reg_coefs <span class="ot">&lt;-</span> <span class="fu">sapply</span>(results[[i]][[method]][[<span class="fu">paste0</span>(<span class="st">"reg_"</span>, measure)]],</span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a>                          <span class="cf">function</span>(x){</span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">if</span>(<span class="fu">isTRUE</span>(lm_beta)){</span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a>                              lm.beta<span class="sc">::</span><span class="fu">lm.beta</span>(x)<span class="sc">$</span>standardized.coefficients</span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a>                            } <span class="cf">else</span>{</span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a>                              x<span class="sc">$</span>coefficients</span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a>                            }})[<span class="dv">2</span>,]   <span class="co"># 2nd row -&gt; beta coef</span></span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate RMSE</span></span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(summary <span class="sc">==</span> <span class="st">"rmse"</span>){</span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sqrt</span>( (reg_coefs <span class="sc">-</span> true_coef )<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span>(summary <span class="sc">==</span> <span class="st">"mse"</span>){</span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a>        (reg_coefs <span class="sc">-</span> true_coef)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span> <span class="cf">if</span>(summary <span class="sc">==</span> <span class="st">"bias"</span>){</span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a>        reg_coefs <span class="sc">-</span> true_coef</span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a>  <span class="co"># exclude bmlvar because of its different data structure</span></span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a>  methods <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"gvar"</span>, <span class="st">"mlvar"</span>, <span class="st">"gimme"</span>)</span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a>  measures <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"instrength"</span>, <span class="st">"outstrength"</span>, <span class="st">"strength"</span>)</span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a>  summaries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"rmse"</span>, <span class="st">"bias"</span>, <span class="st">"mse"</span>)</span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (method <span class="cf">in</span> methods) {</span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (measure <span class="cf">in</span> measures) {</span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (summary <span class="cf">in</span> summaries) {</span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Calculate summary</span></span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a>          result_name_summary <span class="ot">&lt;-</span> <span class="fu">paste</span>(summary, <span class="st">"reg"</span>, measure, method, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a>          calc_list <span class="ot">&lt;-</span> <span class="fu">regression_summary</span>(</span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a>            <span class="at">results =</span> results, </span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> method, </span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a>            <span class="at">measure =</span> measure,</span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a>            <span class="at">summary =</span> summary)</span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a>          mean_tmp <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(calc_list, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a>          <span class="co"># bit of a hack to add the names for the different correlation</span></span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a>          <span class="co"># levels</span></span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a>          <span class="fu">names</span>(mean_tmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(summary, </span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_reg"</span>,</span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_"</span>,</span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a>                                   measure,</span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_"</span>,</span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a>                                   method,</span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_mean"</span>)</span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a>          ret[[<span class="fu">paste0</span>(result_name_summary, <span class="st">"_mean"</span>)]] <span class="ot">&lt;-</span> mean_tmp</span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(summary <span class="sc">==</span> <span class="st">"rmse"</span>){</span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a>            <span class="co"># calculate MSE</span></span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a>            mse_tmp <span class="ot">&lt;-</span> <span class="fu">regression_summary</span>(</span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a>            results, </span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a>            method, </span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a>            measure,</span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a>            <span class="at">summary =</span> <span class="st">"mse"</span>)</span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a>            mse_mean_tmp <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(mse_tmp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a>            mcse_tmp <span class="ot">&lt;-</span> <span class="fu">sqrt</span> (<span class="fu">apply</span>(calc_list, <span class="dv">1</span>, var, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> (<span class="dv">4</span><span class="sc">*</span>n_rep<span class="sc">*</span>mse_mean_tmp))</span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(mcse_tmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(summary, </span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_reg"</span>,</span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_"</span>,</span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a>                                   measure,</span>
<span id="cb9-266"><a href="#cb9-266" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_"</span>,</span>
<span id="cb9-267"><a href="#cb9-267" aria-hidden="true" tabindex="-1"></a>                                   method,</span>
<span id="cb9-268"><a href="#cb9-268" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_mcse"</span>)</span>
<span id="cb9-269"><a href="#cb9-269" aria-hidden="true" tabindex="-1"></a>            ret[[<span class="fu">paste0</span>(result_name_summary, <span class="st">"_mcse"</span>)]] <span class="ot">&lt;-</span> mcse_tmp</span>
<span id="cb9-270"><a href="#cb9-270" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> <span class="cf">if</span>(summary <span class="sc">==</span> <span class="st">"mse"</span>){</span>
<span id="cb9-271"><a href="#cb9-271" aria-hidden="true" tabindex="-1"></a>            mcse_tmp <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(</span>
<span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a>              <span class="fu">apply</span>(calc_list, <span class="dv">1</span>, var, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> n_rep)</span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(mcse_tmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(summary, </span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_reg"</span>,</span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_"</span>,</span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a>                                   measure,</span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_"</span>,</span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a>                                   method,</span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_mcse"</span>)</span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a>            ret[[<span class="fu">paste0</span>(result_name_summary, <span class="st">"_mcse"</span>)]] <span class="ot">&lt;-</span> mcse_tmp</span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> <span class="cf">if</span>(summary <span class="sc">==</span> <span class="st">"bias"</span>){</span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a>            mcse_bias <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(</span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a>              <span class="fu">apply</span>(calc_list, <span class="dv">1</span>, var, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> n_rep</span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a>            <span class="fu">names</span>(mcse_bias) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(summary, </span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_reg"</span>,</span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_"</span>,</span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a>                                   measure,</span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_"</span>,</span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a>                                   method,</span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_mcse"</span>)</span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a>            ret[[<span class="fu">paste0</span>(result_name_summary, <span class="st">"_mcse"</span>)]] <span class="ot">&lt;-</span> mcse_bias</span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Calculate Power</span></span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a>          result_name_power <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"power"</span>, <span class="st">"reg"</span>, measure, method, <span class="at">sep =</span> <span class="st">"_"</span>)</span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a>          calc_list_pwr <span class="ot">&lt;-</span> <span class="fu">regression_power</span>(</span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a>            <span class="at">results =</span> results, </span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> method, </span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a>            <span class="at">measure =</span> measure)</span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a>          pwr_mean <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(calc_list_pwr, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a>          <span class="fu">names</span>(pwr_mean) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"power"</span>, </span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_reg"</span>,</span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_"</span>,</span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a>                                   measure,</span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_"</span>,</span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a>                                   method,</span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_mean"</span>)</span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a>          ret[[<span class="fu">paste0</span>(result_name_power, <span class="st">"_mean"</span>)]] <span class="ot">&lt;-</span> pwr_mean</span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a>          pwr_mcse_tmp <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(</span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a>            pwr_mean <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> pwr_mean) <span class="sc">/</span> n_rep)</span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a>          <span class="fu">names</span>(pwr_mcse_tmp) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"power"</span>, </span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_reg"</span>,</span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a>                                   <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_"</span>,</span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a>                                   measure,</span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_"</span>,</span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a>                                   method,</span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a>                                   <span class="st">"_mcse"</span>)</span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a>          ret[[<span class="fu">paste0</span>(result_name_power, <span class="st">"_mcse"</span>)]] <span class="ot">&lt;-</span> pwr_mcse_tmp</span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Summary for bmlvar</span></span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a>  method <span class="ot">&lt;-</span> <span class="st">"bmlvar"</span></span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a>  regression_rmse_bmlvar <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a>                              results, </span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a>                              <span class="at">method =</span> <span class="st">"bmlvar"</span>, </span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a>                              <span class="at">true_coef =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>,.<span class="dv">4</span>),</span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a>                              <span class="co"># lm_beta = TRUE,</span></span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a>                              <span class="at">rmse =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="fu">seq_along</span>(results), <span class="cf">function</span>(i){</span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(results[[i]][[method]][[<span class="st">"reg_bmlvar"</span>]])){</span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>      reg_coefs <span class="ot">&lt;-</span> results[[i]][[method]][[<span class="st">"reg_bmlvar"</span>]][[<span class="st">"regression_slope"</span>]][[<span class="st">"median"</span>]]</span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Have them all in one vector</span></span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a>      <span class="co"># thus need to repeat the true_coefs </span></span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a>      true_coef_all <span class="ot">&lt;-</span> <span class="fu">rep</span>(true_coef, <span class="dv">3</span>)</span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate RMSE</span></span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isTRUE</span>(rmse)){</span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a>        <span class="fu">sqrt</span>( (reg_coefs <span class="sc">-</span> true_coef )<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a>        (reg_coefs <span class="sc">-</span> true_coef)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-352"><a href="#cb9-352" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-353"><a href="#cb9-353" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-354"><a href="#cb9-354" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-355"><a href="#cb9-355" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-356"><a href="#cb9-356" aria-hidden="true" tabindex="-1"></a>  regression_bias_bmlvar <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb9-357"><a href="#cb9-357" aria-hidden="true" tabindex="-1"></a>                              results, </span>
<span id="cb9-358"><a href="#cb9-358" aria-hidden="true" tabindex="-1"></a>                              <span class="at">method =</span> <span class="st">"bmlvar"</span>, </span>
<span id="cb9-359"><a href="#cb9-359" aria-hidden="true" tabindex="-1"></a>                              <span class="at">true_coef =</span> <span class="fu">c</span>(<span class="dv">0</span>,.<span class="dv">2</span>,.<span class="dv">4</span>)</span>
<span id="cb9-360"><a href="#cb9-360" aria-hidden="true" tabindex="-1"></a>                              <span class="co"># lm_beta = TRUE</span></span>
<span id="cb9-361"><a href="#cb9-361" aria-hidden="true" tabindex="-1"></a>                              )</span>
<span id="cb9-362"><a href="#cb9-362" aria-hidden="true" tabindex="-1"></a>                              {</span>
<span id="cb9-363"><a href="#cb9-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="fu">seq_along</span>(results), <span class="cf">function</span>(i){</span>
<span id="cb9-364"><a href="#cb9-364" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(results[[i]][[method]][[<span class="st">"reg_bmlvar"</span>]])){</span>
<span id="cb9-365"><a href="#cb9-365" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb9-366"><a href="#cb9-366" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb9-367"><a href="#cb9-367" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb9-368"><a href="#cb9-368" aria-hidden="true" tabindex="-1"></a>      reg_coefs <span class="ot">&lt;-</span> results[[i]][[method]][[<span class="st">"reg_bmlvar"</span>]][[<span class="st">"regression_slope"</span>]][[<span class="st">"median"</span>]]</span>
<span id="cb9-369"><a href="#cb9-369" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Have them all in one vector</span></span>
<span id="cb9-370"><a href="#cb9-370" aria-hidden="true" tabindex="-1"></a>      <span class="co"># thus need to repeat the true_coefs </span></span>
<span id="cb9-371"><a href="#cb9-371" aria-hidden="true" tabindex="-1"></a>      true_coef_all <span class="ot">&lt;-</span> <span class="fu">rep</span>(true_coef, <span class="dv">3</span>)</span>
<span id="cb9-372"><a href="#cb9-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-373"><a href="#cb9-373" aria-hidden="true" tabindex="-1"></a>      <span class="co"># Calculate Bias</span></span>
<span id="cb9-374"><a href="#cb9-374" aria-hidden="true" tabindex="-1"></a>      reg_coefs <span class="sc">-</span> true_coef</span>
<span id="cb9-375"><a href="#cb9-375" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-376"><a href="#cb9-376" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-377"><a href="#cb9-377" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-378"><a href="#cb9-378" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-379"><a href="#cb9-379" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-380"><a href="#cb9-380" aria-hidden="true" tabindex="-1"></a>  regression_power_bmlvar <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb9-381"><a href="#cb9-381" aria-hidden="true" tabindex="-1"></a>                              results, </span>
<span id="cb9-382"><a href="#cb9-382" aria-hidden="true" tabindex="-1"></a>                              <span class="at">method =</span> <span class="st">"bmlvar"</span>, </span>
<span id="cb9-383"><a href="#cb9-383" aria-hidden="true" tabindex="-1"></a>                              measure,</span>
<span id="cb9-384"><a href="#cb9-384" aria-hidden="true" tabindex="-1"></a>                              <span class="at">oneside =</span> <span class="cn">TRUE</span>){</span>
<span id="cb9-385"><a href="#cb9-385" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sapply</span>(<span class="fu">seq_along</span>(results), <span class="cf">function</span>(i){</span>
<span id="cb9-386"><a href="#cb9-386" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">is.null</span>(results[[i]][[method]][[<span class="st">"reg_bmlvar"</span>]])){</span>
<span id="cb9-387"><a href="#cb9-387" aria-hidden="true" tabindex="-1"></a>      <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb9-388"><a href="#cb9-388" aria-hidden="true" tabindex="-1"></a>    } </span>
<span id="cb9-389"><a href="#cb9-389" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{</span>
<span id="cb9-390"><a href="#cb9-390" aria-hidden="true" tabindex="-1"></a>      ci_twoside <span class="ot">&lt;-</span> results[[i]][[method]][[<span class="st">"reg_bmlvar"</span>]][[<span class="st">"regression_slope"</span>]][[<span class="st">"ci_95_l"</span>]]</span>
<span id="cb9-391"><a href="#cb9-391" aria-hidden="true" tabindex="-1"></a>      ci_oneside <span class="ot">&lt;-</span> results[[i]][[method]][[<span class="st">"reg_bmlvar"</span>]][[<span class="st">"regression_slope"</span>]][[<span class="st">"ci_oneside"</span>]]</span>
<span id="cb9-392"><a href="#cb9-392" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">isTRUE</span>(oneside)){</span>
<span id="cb9-393"><a href="#cb9-393" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(ci_oneside <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb9-394"><a href="#cb9-394" aria-hidden="true" tabindex="-1"></a>      } <span class="cf">else</span>{</span>
<span id="cb9-395"><a href="#cb9-395" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ifelse</span>(ci_twoside <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb9-396"><a href="#cb9-396" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-397"><a href="#cb9-397" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-398"><a href="#cb9-398" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-399"><a href="#cb9-399" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb9-400"><a href="#cb9-400" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-401"><a href="#cb9-401" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-402"><a href="#cb9-402" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply the functions</span></span>
<span id="cb9-403"><a href="#cb9-403" aria-hidden="true" tabindex="-1"></a>  calc_rmse <span class="ot">&lt;-</span> <span class="fu">regression_rmse_bmlvar</span>(</span>
<span id="cb9-404"><a href="#cb9-404" aria-hidden="true" tabindex="-1"></a>    <span class="at">results =</span> results, </span>
<span id="cb9-405"><a href="#cb9-405" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"bmlvar"</span>, </span>
<span id="cb9-406"><a href="#cb9-406" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmse =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-407"><a href="#cb9-407" aria-hidden="true" tabindex="-1"></a>  calc_bias <span class="ot">&lt;-</span> <span class="fu">regression_bias_bmlvar</span>(</span>
<span id="cb9-408"><a href="#cb9-408" aria-hidden="true" tabindex="-1"></a>    <span class="at">results =</span> results, </span>
<span id="cb9-409"><a href="#cb9-409" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"bmlvar"</span></span>
<span id="cb9-410"><a href="#cb9-410" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-411"><a href="#cb9-411" aria-hidden="true" tabindex="-1"></a>  calc_mse <span class="ot">&lt;-</span> <span class="fu">regression_rmse_bmlvar</span>(</span>
<span id="cb9-412"><a href="#cb9-412" aria-hidden="true" tabindex="-1"></a>    <span class="at">results =</span> results, </span>
<span id="cb9-413"><a href="#cb9-413" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"bmlvar"</span>, </span>
<span id="cb9-414"><a href="#cb9-414" aria-hidden="true" tabindex="-1"></a>    <span class="at">rmse =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-415"><a href="#cb9-415" aria-hidden="true" tabindex="-1"></a>  calc_pwr_oneside <span class="ot">&lt;-</span> <span class="fu">regression_power_bmlvar</span>(</span>
<span id="cb9-416"><a href="#cb9-416" aria-hidden="true" tabindex="-1"></a>    <span class="at">results =</span> results, </span>
<span id="cb9-417"><a href="#cb9-417" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"bmlvar"</span>,</span>
<span id="cb9-418"><a href="#cb9-418" aria-hidden="true" tabindex="-1"></a>    <span class="at">oneside =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-419"><a href="#cb9-419" aria-hidden="true" tabindex="-1"></a>  calc_pwr_twoside <span class="ot">&lt;-</span> <span class="fu">regression_power_bmlvar</span>(</span>
<span id="cb9-420"><a href="#cb9-420" aria-hidden="true" tabindex="-1"></a>    <span class="at">results =</span> results, </span>
<span id="cb9-421"><a href="#cb9-421" aria-hidden="true" tabindex="-1"></a>    <span class="at">method =</span> <span class="st">"bmlvar"</span>,</span>
<span id="cb9-422"><a href="#cb9-422" aria-hidden="true" tabindex="-1"></a>    <span class="at">oneside =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-423"><a href="#cb9-423" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-424"><a href="#cb9-424" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate mean</span></span>
<span id="cb9-425"><a href="#cb9-425" aria-hidden="true" tabindex="-1"></a>  mean_rmse <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(calc_rmse, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-426"><a href="#cb9-426" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(mean_rmse) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"rmse"</span>, </span>
<span id="cb9-427"><a href="#cb9-427" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_reg"</span>,</span>
<span id="cb9-428"><a href="#cb9-428" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-429"><a href="#cb9-429" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-430"><a href="#cb9-430" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">rep</span>(measures, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb9-431"><a href="#cb9-431" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-432"><a href="#cb9-432" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"bmlvar"</span>,</span>
<span id="cb9-433"><a href="#cb9-433" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_mean"</span>)</span>
<span id="cb9-434"><a href="#cb9-434" aria-hidden="true" tabindex="-1"></a>  mean_bias <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(calc_bias, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-435"><a href="#cb9-435" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(mean_bias) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"bias"</span>, </span>
<span id="cb9-436"><a href="#cb9-436" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_reg"</span>,</span>
<span id="cb9-437"><a href="#cb9-437" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-438"><a href="#cb9-438" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-439"><a href="#cb9-439" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">rep</span>(measures, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb9-440"><a href="#cb9-440" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-441"><a href="#cb9-441" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"bmlvar"</span>,</span>
<span id="cb9-442"><a href="#cb9-442" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_mean"</span>)</span>
<span id="cb9-443"><a href="#cb9-443" aria-hidden="true" tabindex="-1"></a>  mean_mse <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(calc_mse, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-444"><a href="#cb9-444" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(mean_mse) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"mse"</span>, </span>
<span id="cb9-445"><a href="#cb9-445" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_reg"</span>,</span>
<span id="cb9-446"><a href="#cb9-446" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-447"><a href="#cb9-447" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-448"><a href="#cb9-448" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">rep</span>(measures, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb9-449"><a href="#cb9-449" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-450"><a href="#cb9-450" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"bmlvar"</span>,</span>
<span id="cb9-451"><a href="#cb9-451" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_mean"</span>)</span>
<span id="cb9-452"><a href="#cb9-452" aria-hidden="true" tabindex="-1"></a>  mean_pwroneside <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(calc_pwr_oneside, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-453"><a href="#cb9-453" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(mean_pwroneside) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"poweroneside"</span>, </span>
<span id="cb9-454"><a href="#cb9-454" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_reg"</span>,</span>
<span id="cb9-455"><a href="#cb9-455" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-456"><a href="#cb9-456" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-457"><a href="#cb9-457" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">rep</span>(measures, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb9-458"><a href="#cb9-458" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-459"><a href="#cb9-459" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"bmlvar"</span>,</span>
<span id="cb9-460"><a href="#cb9-460" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_mean"</span>)</span>
<span id="cb9-461"><a href="#cb9-461" aria-hidden="true" tabindex="-1"></a>  mean_pwrtwoside <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(calc_pwr_twoside, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-462"><a href="#cb9-462" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(mean_pwrtwoside) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"powertwoside"</span>, </span>
<span id="cb9-463"><a href="#cb9-463" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_reg"</span>,</span>
<span id="cb9-464"><a href="#cb9-464" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-465"><a href="#cb9-465" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-466"><a href="#cb9-466" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">rep</span>(measures, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb9-467"><a href="#cb9-467" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-468"><a href="#cb9-468" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"bmlvar"</span>,</span>
<span id="cb9-469"><a href="#cb9-469" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_mean"</span>)</span>
<span id="cb9-470"><a href="#cb9-470" aria-hidden="true" tabindex="-1"></a>  ret[[<span class="st">"mean_rmse"</span>]] <span class="ot">&lt;-</span> mean_rmse</span>
<span id="cb9-471"><a href="#cb9-471" aria-hidden="true" tabindex="-1"></a>  ret[[<span class="st">"mean_bias"</span>]] <span class="ot">&lt;-</span> mean_bias</span>
<span id="cb9-472"><a href="#cb9-472" aria-hidden="true" tabindex="-1"></a>  ret[[<span class="st">"mean_mse"</span>]] <span class="ot">&lt;-</span> mean_mse</span>
<span id="cb9-473"><a href="#cb9-473" aria-hidden="true" tabindex="-1"></a>  ret[[<span class="st">"mean_pwroneside"</span>]] <span class="ot">&lt;-</span> mean_pwroneside</span>
<span id="cb9-474"><a href="#cb9-474" aria-hidden="true" tabindex="-1"></a>  ret[[<span class="st">"mean_pwrtwoside"</span>]] <span class="ot">&lt;-</span> mean_pwrtwoside</span>
<span id="cb9-475"><a href="#cb9-475" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-476"><a href="#cb9-476" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate mcse</span></span>
<span id="cb9-477"><a href="#cb9-477" aria-hidden="true" tabindex="-1"></a>  <span class="co"># mcse_rmse &lt;- sqrt(</span></span>
<span id="cb9-478"><a href="#cb9-478" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   mean_rmse * (1 - mean_rmse) / n_rep)</span></span>
<span id="cb9-479"><a href="#cb9-479" aria-hidden="true" tabindex="-1"></a>  var_rmse <span class="ot">&lt;-</span> <span class="fu">apply</span>(calc_rmse, <span class="dv">1</span>, stats<span class="sc">::</span>var)</span>
<span id="cb9-480"><a href="#cb9-480" aria-hidden="true" tabindex="-1"></a>  mcse_rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(</span>
<span id="cb9-481"><a href="#cb9-481" aria-hidden="true" tabindex="-1"></a>    var_rmse<span class="sc">/</span>(<span class="dv">4</span> <span class="sc">*</span> n_rep <span class="sc">*</span> mean_mse)</span>
<span id="cb9-482"><a href="#cb9-482" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-483"><a href="#cb9-483" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(mcse_rmse) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"rmse"</span>, </span>
<span id="cb9-484"><a href="#cb9-484" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_reg"</span>,</span>
<span id="cb9-485"><a href="#cb9-485" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-486"><a href="#cb9-486" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-487"><a href="#cb9-487" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">rep</span>(measures, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb9-488"><a href="#cb9-488" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-489"><a href="#cb9-489" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"bmlvar"</span>,</span>
<span id="cb9-490"><a href="#cb9-490" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_mcse"</span>)</span>
<span id="cb9-491"><a href="#cb9-491" aria-hidden="true" tabindex="-1"></a>  var_bias <span class="ot">&lt;-</span> <span class="fu">apply</span>(calc_bias, <span class="dv">1</span>, stats<span class="sc">::</span>var)</span>
<span id="cb9-492"><a href="#cb9-492" aria-hidden="true" tabindex="-1"></a>  mcse_bias <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(</span>
<span id="cb9-493"><a href="#cb9-493" aria-hidden="true" tabindex="-1"></a>    var_bias<span class="sc">/</span>n_rep</span>
<span id="cb9-494"><a href="#cb9-494" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-495"><a href="#cb9-495" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(mcse_bias) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"bias"</span>, </span>
<span id="cb9-496"><a href="#cb9-496" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_reg"</span>,</span>
<span id="cb9-497"><a href="#cb9-497" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-498"><a href="#cb9-498" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-499"><a href="#cb9-499" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">rep</span>(measures, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb9-500"><a href="#cb9-500" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-501"><a href="#cb9-501" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"bmlvar"</span>,</span>
<span id="cb9-502"><a href="#cb9-502" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_mcse"</span>)</span>
<span id="cb9-503"><a href="#cb9-503" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-504"><a href="#cb9-504" aria-hidden="true" tabindex="-1"></a>  mcse_mse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(</span>
<span id="cb9-505"><a href="#cb9-505" aria-hidden="true" tabindex="-1"></a>    mean_mse <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> mean_mse) <span class="sc">/</span> n_rep)</span>
<span id="cb9-506"><a href="#cb9-506" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(mcse_mse) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"mse"</span>, </span>
<span id="cb9-507"><a href="#cb9-507" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_reg"</span>,</span>
<span id="cb9-508"><a href="#cb9-508" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-509"><a href="#cb9-509" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-510"><a href="#cb9-510" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">rep</span>(measures, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb9-511"><a href="#cb9-511" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-512"><a href="#cb9-512" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"bmlvar"</span>,</span>
<span id="cb9-513"><a href="#cb9-513" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_mcse"</span>)</span>
<span id="cb9-514"><a href="#cb9-514" aria-hidden="true" tabindex="-1"></a>  mcse_pwroneside <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(</span>
<span id="cb9-515"><a href="#cb9-515" aria-hidden="true" tabindex="-1"></a>    mean_pwroneside <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> mean_pwroneside) <span class="sc">/</span> n_rep)</span>
<span id="cb9-516"><a href="#cb9-516" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(mcse_pwroneside) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"poweroneside"</span>, </span>
<span id="cb9-517"><a href="#cb9-517" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_reg"</span>,</span>
<span id="cb9-518"><a href="#cb9-518" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-519"><a href="#cb9-519" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-520"><a href="#cb9-520" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">rep</span>(measures, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb9-521"><a href="#cb9-521" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-522"><a href="#cb9-522" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"bmlvar"</span>,</span>
<span id="cb9-523"><a href="#cb9-523" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_mcse"</span>)</span>
<span id="cb9-524"><a href="#cb9-524" aria-hidden="true" tabindex="-1"></a>  mcse_pwrtwoside <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(</span>
<span id="cb9-525"><a href="#cb9-525" aria-hidden="true" tabindex="-1"></a>    mean_pwrtwoside <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> mean_pwrtwoside) <span class="sc">/</span> n_rep)</span>
<span id="cb9-526"><a href="#cb9-526" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(mcse_pwrtwoside) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"powertwoside"</span>, </span>
<span id="cb9-527"><a href="#cb9-527" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_reg"</span>,</span>
<span id="cb9-528"><a href="#cb9-528" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">4</span>),</span>
<span id="cb9-529"><a href="#cb9-529" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-530"><a href="#cb9-530" aria-hidden="true" tabindex="-1"></a>                             <span class="fu">rep</span>(measures, <span class="at">each =</span> <span class="dv">3</span>),</span>
<span id="cb9-531"><a href="#cb9-531" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_"</span>,</span>
<span id="cb9-532"><a href="#cb9-532" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"bmlvar"</span>,</span>
<span id="cb9-533"><a href="#cb9-533" aria-hidden="true" tabindex="-1"></a>                             <span class="st">"_mcse"</span>)</span>
<span id="cb9-534"><a href="#cb9-534" aria-hidden="true" tabindex="-1"></a>  ret[[<span class="st">"mcse_rmse"</span>]] <span class="ot">&lt;-</span> mcse_rmse</span>
<span id="cb9-535"><a href="#cb9-535" aria-hidden="true" tabindex="-1"></a>  ret[[<span class="st">"mcse_bias"</span>]] <span class="ot">&lt;-</span> mcse_bias</span>
<span id="cb9-536"><a href="#cb9-536" aria-hidden="true" tabindex="-1"></a>  ret[[<span class="st">"mcse_mse"</span>]] <span class="ot">&lt;-</span> mcse_mse</span>
<span id="cb9-537"><a href="#cb9-537" aria-hidden="true" tabindex="-1"></a>  ret[[<span class="st">"mcse_pwroneside"</span>]] <span class="ot">&lt;-</span> mcse_pwroneside</span>
<span id="cb9-538"><a href="#cb9-538" aria-hidden="true" tabindex="-1"></a>  ret[[<span class="st">"mcse_pwrtwoside"</span>]] <span class="ot">&lt;-</span> mcse_pwrtwoside</span>
<span id="cb9-539"><a href="#cb9-539" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-540"><a href="#cb9-540" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-541"><a href="#cb9-541" aria-hidden="true" tabindex="-1"></a>  <span class="co">#--- Return</span></span>
<span id="cb9-542"><a href="#cb9-542" aria-hidden="true" tabindex="-1"></a>  ret<span class="sc">$</span>bmlvar_diagnostics <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb9-543"><a href="#cb9-543" aria-hidden="true" tabindex="-1"></a>  ret<span class="sc">$</span>bmlvar_diagnostics<span class="sc">$</span>rhat_bmlvar_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">sapply</span>(results, <span class="cf">function</span>(x){</span>
<span id="cb9-544"><a href="#cb9-544" aria-hidden="true" tabindex="-1"></a>     x<span class="sc">$</span>bmlvar<span class="sc">$</span>rhat_bmlvar_mean}))</span>
<span id="cb9-545"><a href="#cb9-545" aria-hidden="true" tabindex="-1"></a>  ret<span class="sc">$</span>bmlvar_diagnostics<span class="sc">$</span>rhat11_bmlvar_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">sapply</span>(results, <span class="cf">function</span>(x){</span>
<span id="cb9-546"><a href="#cb9-546" aria-hidden="true" tabindex="-1"></a>     x<span class="sc">$</span>bmlvar<span class="sc">$</span>rhat_bmlvar_11}))</span>
<span id="cb9-547"><a href="#cb9-547" aria-hidden="true" tabindex="-1"></a>  ret<span class="sc">$</span>bmlvar_diagnostics<span class="sc">$</span>divtrans_bmlvar_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">sapply</span>(results, <span class="cf">function</span>(x){</span>
<span id="cb9-548"><a href="#cb9-548" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>bmlvar<span class="sc">$</span>divtrans_bmlvar}))</span>
<span id="cb9-549"><a href="#cb9-549" aria-hidden="true" tabindex="-1"></a>  ret<span class="sc">$</span>bmlvar_diagnostics<span class="sc">$</span>divtrans_bmlvar_sum <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(results, <span class="cf">function</span>(x){</span>
<span id="cb9-550"><a href="#cb9-550" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>bmlvar<span class="sc">$</span>divtrans_bmlvar}))</span>
<span id="cb9-551"><a href="#cb9-551" aria-hidden="true" tabindex="-1"></a>  ret<span class="sc">$</span>bmlvar_diagnostics<span class="sc">$</span>divtrans_bmlvar_sumnonz <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">sapply</span>(results, <span class="cf">function</span>(x){</span>
<span id="cb9-552"><a href="#cb9-552" aria-hidden="true" tabindex="-1"></a>    x<span class="sc">$</span>bmlvar<span class="sc">$</span>divtrans_bmlvar}) <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb9-553"><a href="#cb9-553" aria-hidden="true" tabindex="-1"></a>  ret_vec <span class="ot">&lt;-</span> <span class="fu">unlist</span>(ret, <span class="at">use.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-554"><a href="#cb9-554" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ret_vec)</span>
<span id="cb9-555"><a href="#cb9-555" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-556"><a href="#cb9-556" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-557"><a href="#cb9-557" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-558"><a href="#cb9-558" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-559"><a href="#cb9-559" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="executing-simulation" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Executing Simulation</h1>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For testing</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># df_design_test &lt;- df_design[3,]</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># df_design_test$n_id &lt;- 200</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># df_design_test$n_var &lt;- 4</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># sim_pars$n_id &lt;- 200</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># sim_pars$n_var &lt;- 4</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># n_var &lt;- 4</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># n_id &lt;- 200</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># sim_pars$graph_sparse$beta &lt;- sim_pars$graph_sparse$beta[1:4,1:4]</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># sim_pars$graph_sparse$pcor &lt;- sim_pars$graph_sparse$pcor[1:4,1:4]</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># sim_pars$graph_sparse$kappa &lt;- sim_pars$graph_sparse$kappa[1:4,1:4]</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co"># sim_pars$graph_nonsparse$beta &lt;- sim_pars$graph_nonsparse$beta[1:4,1:4]</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># sim_pars$graph_nonsparse$pcor &lt;- sim_pars$graph_nonsparse$pcor[1:4,1:4]</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co"># sim_pars$graph_nonsparse$kappa &lt;- sim_pars$graph_nonsparse$kappa[1:4,1:4]</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co"># sim_pars$graph_sparse$sigma &lt;- sim_pars$graph_sparse$sigma[1:4,1:4]</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># sim_pars$graph_nonsparse$sigma &lt;- sim_pars$graph_nonsparse$sigma[1:4,1:4]</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>n_rep <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>n_workers <span class="ot">&lt;-</span> </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>future<span class="sc">::</span><span class="fu">plan</span>(multisession, <span class="at">workers =</span> <span class="dv">60</span>)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="co"># started 2024-08-13 ~08:35</span></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="co"># df_design_test &lt;- df_design[c(4),]</span></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>sim_results <span class="ot">&lt;-</span> SimDesign<span class="sc">::</span><span class="fu">runSimulation</span>(</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">design =</span> df_design, </span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">replications =</span> n_rep, </span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">generate =</span> sim_generate, </span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">analyse =</span> sim_analyse, </span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">summarise =</span> sim_summarise,</span>
<span id="cb10-32"><a href="#cb10-32" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">fixed_objects =</span> sim_pars,</span>
<span id="cb10-33"><a href="#cb10-33" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">parallel =</span> <span class="st">"future"</span>,</span>
<span id="cb10-34"><a href="#cb10-34" aria-hidden="true" tabindex="-1"></a>                                    <span class="co"># parallel = TRUE,</span></span>
<span id="cb10-35"><a href="#cb10-35" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">max_errors =</span> <span class="dv">2</span>,</span>
<span id="cb10-36"><a href="#cb10-36" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">packages =</span> <span class="fu">c</span>(<span class="st">"tidyverse"</span>, </span>
<span id="cb10-37"><a href="#cb10-37" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"gimme"</span>,</span>
<span id="cb10-38"><a href="#cb10-38" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"mlVAR"</span>,</span>
<span id="cb10-39"><a href="#cb10-39" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"graphicalVAR"</span>,</span>
<span id="cb10-40"><a href="#cb10-40" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"lm.beta"</span>,</span>
<span id="cb10-41"><a href="#cb10-41" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"bayestestR"</span>,</span>
<span id="cb10-42"><a href="#cb10-42" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"posterior"</span>,</span>
<span id="cb10-43"><a href="#cb10-43" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"rstan"</span>,</span>
<span id="cb10-44"><a href="#cb10-44" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"corpcor"</span>,</span>
<span id="cb10-45"><a href="#cb10-45" aria-hidden="true" tabindex="-1"></a>                                                 <span class="st">"Rcpp"</span>),</span>
<span id="cb10-46"><a href="#cb10-46" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">save_results =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-47"><a href="#cb10-47" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">filename =</span> <span class="st">"sim_full.rds"</span></span>
<span id="cb10-48"><a href="#cb10-48" aria-hidden="true" tabindex="-1"></a>                                    <span class="co"># save_seeds = TRUE</span></span>
<span id="cb10-49"><a href="#cb10-49" aria-hidden="true" tabindex="-1"></a>                                    )</span>
<span id="cb10-50"><a href="#cb10-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-51"><a href="#cb10-51" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(sequential)</span>
<span id="cb10-52"><a href="#cb10-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-53"><a href="#cb10-53" aria-hidden="true" tabindex="-1"></a><span class="co"># SimClean()</span></span>
<span id="cb10-54"><a href="#cb10-54" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(sim_results, file = here("output/pilot_sim_results_clean_2104.RDS"))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="write-to-standard-r-script" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Write to standard R script</h1>
<p>To run the simulation on the server, it can be easier to just execute an R script.</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">purl</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"scripts"</span>, <span class="st">"01_centrality_simulation.qmd"</span>), </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">output =</span> here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"scripts"</span>, <span class="st">"01_centrality_simulation.R"</span>),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">documentation =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="resummarize-after-fixing-details-in-summary-function" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Resummarize after fixing details in summary function</h1>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>sim_res_resum <span class="ot">&lt;-</span> SimDesign<span class="sc">::</span><span class="fu">reSummarise</span>(<span class="at">summarise =</span> sim_summarise,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">dir =</span> <span class="fu">here</span>(<span class="st">"sim_full.rds-results_pc04798"</span>))</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(<span class="at">object =</span> sim_res_resum, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"output"</span>, <span class="st">"sim_results.RDS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Add the run information (seed, time, etc.) from the previous output to the resummarized results object:</p>
<div class="cell">
<details class="code-fold">
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>sim_res_old <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"output"</span>, <span class="st">"sim_full.RDS"</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>sim_res_resum <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"output"</span>, <span class="st">"sim_results.RDS"</span>))</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>sim_info <span class="ot">&lt;-</span> sim_res_old <span class="sc">|&gt;</span> </span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(REPLICATIONS, SIM_TIME, RAM_USED, SEED, COMPLETED, WARNINGS) </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>sim_res <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(sim_res_resum, sim_info)</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(<span class="at">object =</span> sim_res, here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"output"</span>, <span class="st">"sim_results.RDS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<!-- -->

</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb14" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "Using features of dynamic networks to guide treatment selection and outcome prediction"</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="an">subtitle:</span><span class="co"> "Simulation Code"</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="an">author:</span><span class="co"> </span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"> - name: Björn S. Siepe</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="co">   orcid: 0000-0002-9558-4648</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co">   affiliations: University of Marburg</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="co"> - name: Matthias Kloft</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co">   orcid: 0000-0003-1845-6957</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co">   affiliations: University of Marburg  </span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"> - name: Fridtjof Petersen</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a><span class="co">   orcid: 0000-0002-4913-8532</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co">   affiliations: University of Groningen</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a><span class="co"> - name: Yong Zhang</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co">   orcid: 0000-0002-6313-2575</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co">   affiliations: University of Groningen</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="co"> - name: Laura F. Bringmann</span></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a><span class="co">   orcid: 0000-0002-8091-9935</span></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="co">   affiliations: University of Groningen</span></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a><span class="co"> - name: Daniel W. Heck</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">   orcid: 0000-0002-6302-9252</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co">   affiliations: University of Marburg</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="an">date:</span><span class="co"> "`r Sys.Date()`"</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="an">format:</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co">  html:</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co">    toc: true</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co">    number-sections: true</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co">    theme: cosmo</span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co">    code-fold: true</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co">    code-tools: true</span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co">    code-summary: "Show the code"</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-width: 7</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-height: 4.5</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="co">    fig-align: "center"</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co">    embed-resouces: true</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="an">execute:</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="co">  message: false</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a><span class="co">  warning: false</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a><span class="co">  eval: false # only show code</span></span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a><span class="fu"># Background</span></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>This script contains the <span class="in">`SimDesign`</span> code for the simulation study. The visualization of the results is done in the <span class="in">`05_simulation_viz.qmd`</span> script.</span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>We first load all relevant packages: </span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r packages}</span></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a><span class="in">library(tidyverse)</span></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a><span class="in">library(SimDesign)</span></span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="in">library(mlVAR)</span></span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a><span class="in">library(graphicalVAR)</span></span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a><span class="in">library(gimme)</span></span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a><span class="in">library(here)</span></span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a><span class="in">library(future)</span></span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a><span class="in">library(corpcor)</span></span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a><span class="in">source(here::here("scripts", "00_functions.R"))</span></span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a><span class="fu"># Data Generation</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a><span class="fu">## Data-Generating Processes</span></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>Load DGP based on estimated network structures:  </span>
<span id="cb14-68"><a href="#cb14-68" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb14-69"><a href="#cb14-69" aria-hidden="true" tabindex="-1"></a><span class="co"># non-sparse Graph to simulate from</span></span>
<span id="cb14-70"><a href="#cb14-70" aria-hidden="true" tabindex="-1"></a>graph_nonsparse <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/graph_semisparse_synth.RDS"</span>))</span>
<span id="cb14-71"><a href="#cb14-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-72"><a href="#cb14-72" aria-hidden="true" tabindex="-1"></a><span class="co"># sparse DGP</span></span>
<span id="cb14-73"><a href="#cb14-73" aria-hidden="true" tabindex="-1"></a>graph_sparse <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data/graph_semisparse_synth.RDS"</span>))</span>
<span id="cb14-74"><a href="#cb14-74" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-75"><a href="#cb14-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-76"><a href="#cb14-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-77"><a href="#cb14-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-78"><a href="#cb14-78" aria-hidden="true" tabindex="-1"></a><span class="fu">## Setting parameters</span></span>
<span id="cb14-79"><a href="#cb14-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-80"><a href="#cb14-80" aria-hidden="true" tabindex="-1"></a>We define the conditions and the fixed parameters for the simulation.</span>
<span id="cb14-81"><a href="#cb14-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-82"><a href="#cb14-82" aria-hidden="true" tabindex="-1"></a><span class="in">```{r params}</span></span>
<span id="cb14-83"><a href="#cb14-83" aria-hidden="true" tabindex="-1"></a><span class="in">dgp &lt;- c("sparse")</span></span>
<span id="cb14-84"><a href="#cb14-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-85"><a href="#cb14-85" aria-hidden="true" tabindex="-1"></a><span class="in"># Number of timepoints</span></span>
<span id="cb14-86"><a href="#cb14-86" aria-hidden="true" tabindex="-1"></a><span class="in">n_tp &lt;- c(60, 120)</span></span>
<span id="cb14-87"><a href="#cb14-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-88"><a href="#cb14-88" aria-hidden="true" tabindex="-1"></a><span class="in">heterogeneity &lt;- "high"</span></span>
<span id="cb14-89"><a href="#cb14-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-90"><a href="#cb14-90" aria-hidden="true" tabindex="-1"></a><span class="in"># Simulation parameters</span></span>
<span id="cb14-91"><a href="#cb14-91" aria-hidden="true" tabindex="-1"></a><span class="in"># Number of individuals </span></span>
<span id="cb14-92"><a href="#cb14-92" aria-hidden="true" tabindex="-1"></a><span class="in">n_id &lt;- c(75, 200)</span></span>
<span id="cb14-93"><a href="#cb14-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-94"><a href="#cb14-94" aria-hidden="true" tabindex="-1"></a><span class="in"># Design Conditions</span></span>
<span id="cb14-95"><a href="#cb14-95" aria-hidden="true" tabindex="-1"></a><span class="in">df_design &lt;- SimDesign::createDesign(</span></span>
<span id="cb14-96"><a href="#cb14-96" aria-hidden="true" tabindex="-1"></a><span class="in">  dgp = dgp,</span></span>
<span id="cb14-97"><a href="#cb14-97" aria-hidden="true" tabindex="-1"></a><span class="in">  n_id = n_id,</span></span>
<span id="cb14-98"><a href="#cb14-98" aria-hidden="true" tabindex="-1"></a><span class="in">  heterogeneity = heterogeneity,</span></span>
<span id="cb14-99"><a href="#cb14-99" aria-hidden="true" tabindex="-1"></a><span class="in">  n_tp = n_tp</span></span>
<span id="cb14-100"><a href="#cb14-100" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb14-101"><a href="#cb14-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-102"><a href="#cb14-102" aria-hidden="true" tabindex="-1"></a><span class="in"># Number of variables</span></span>
<span id="cb14-103"><a href="#cb14-103" aria-hidden="true" tabindex="-1"></a><span class="in">n_var &lt;- 6</span></span>
<span id="cb14-104"><a href="#cb14-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-105"><a href="#cb14-105" aria-hidden="true" tabindex="-1"></a><span class="in"># for regression</span></span>
<span id="cb14-106"><a href="#cb14-106" aria-hidden="true" tabindex="-1"></a><span class="in">reg_error_sd = 1</span></span>
<span id="cb14-107"><a href="#cb14-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-108"><a href="#cb14-108" aria-hidden="true" tabindex="-1"></a><span class="in"># Should GIMME use only nondirected contemporaneous effects?</span></span>
<span id="cb14-109"><a href="#cb14-109" aria-hidden="true" tabindex="-1"></a><span class="in">gimme_var_only = TRUE</span></span>
<span id="cb14-110"><a href="#cb14-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-111"><a href="#cb14-111" aria-hidden="true" tabindex="-1"></a><span class="in"># Should GIMME return partial correlations?</span></span>
<span id="cb14-112"><a href="#cb14-112" aria-hidden="true" tabindex="-1"></a><span class="in">gimme_pcor = TRUE</span></span>
<span id="cb14-113"><a href="#cb14-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-114"><a href="#cb14-114" aria-hidden="true" tabindex="-1"></a><span class="in"># Should data for non-Bayesian methods be person-mean centered?</span></span>
<span id="cb14-115"><a href="#cb14-115" aria-hidden="true" tabindex="-1"></a><span class="in">mean_center = TRUE</span></span>
<span id="cb14-116"><a href="#cb14-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-117"><a href="#cb14-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-118"><a href="#cb14-118" aria-hidden="true" tabindex="-1"></a><span class="in"># random effects sds</span></span>
<span id="cb14-119"><a href="#cb14-119" aria-hidden="true" tabindex="-1"></a><span class="in"># beta_sd &lt;- 0.1</span></span>
<span id="cb14-120"><a href="#cb14-120" aria-hidden="true" tabindex="-1"></a><span class="in"># kappa_sd &lt;- 0.1</span></span>
<span id="cb14-121"><a href="#cb14-121" aria-hidden="true" tabindex="-1"></a><span class="in"># # Strength of the correlation</span></span>
<span id="cb14-122"><a href="#cb14-122" aria-hidden="true" tabindex="-1"></a><span class="in"># hard-coded down below</span></span>
<span id="cb14-123"><a href="#cb14-123" aria-hidden="true" tabindex="-1"></a><span class="in"># beta_reg &lt;- c(0, 0.2, 0.4)</span></span>
<span id="cb14-124"><a href="#cb14-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-125"><a href="#cb14-125" aria-hidden="true" tabindex="-1"></a><span class="in">sim_pars &lt;- list(</span></span>
<span id="cb14-126"><a href="#cb14-126" aria-hidden="true" tabindex="-1"></a><span class="in">  n_id = n_id,</span></span>
<span id="cb14-127"><a href="#cb14-127" aria-hidden="true" tabindex="-1"></a><span class="in">  n_var = n_var,</span></span>
<span id="cb14-128"><a href="#cb14-128" aria-hidden="true" tabindex="-1"></a><span class="in">  # n_tp = n_tp,</span></span>
<span id="cb14-129"><a href="#cb14-129" aria-hidden="true" tabindex="-1"></a><span class="in">  reg_error_sd = reg_error_sd,</span></span>
<span id="cb14-130"><a href="#cb14-130" aria-hidden="true" tabindex="-1"></a><span class="in">  # beta_sd = beta_sd,</span></span>
<span id="cb14-131"><a href="#cb14-131" aria-hidden="true" tabindex="-1"></a><span class="in">  # kappa_sd = kappa_sd,</span></span>
<span id="cb14-132"><a href="#cb14-132" aria-hidden="true" tabindex="-1"></a><span class="in">  graph_nonsparse = graph_nonsparse,</span></span>
<span id="cb14-133"><a href="#cb14-133" aria-hidden="true" tabindex="-1"></a><span class="in">  graph_sparse = graph_sparse,</span></span>
<span id="cb14-134"><a href="#cb14-134" aria-hidden="true" tabindex="-1"></a><span class="in">  gimme_var_only = gimme_var_only,</span></span>
<span id="cb14-135"><a href="#cb14-135" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_center = mean_center</span></span>
<span id="cb14-136"><a href="#cb14-136" aria-hidden="true" tabindex="-1"></a><span class="in">)</span></span>
<span id="cb14-137"><a href="#cb14-137" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-138"><a href="#cb14-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-139"><a href="#cb14-139" aria-hidden="true" tabindex="-1"></a>Pre-compiling the Stan model</span>
<span id="cb14-140"><a href="#cb14-140" aria-hidden="true" tabindex="-1"></a><span class="in">```{r precompile}</span></span>
<span id="cb14-141"><a href="#cb14-141" aria-hidden="true" tabindex="-1"></a><span class="in">model_name &lt;- "MLVAR_lkj_only"</span></span>
<span id="cb14-142"><a href="#cb14-142" aria-hidden="true" tabindex="-1"></a><span class="in"># Compile model</span></span>
<span id="cb14-143"><a href="#cb14-143" aria-hidden="true" tabindex="-1"></a><span class="in">sim_pars$mlvar_model &lt;-</span></span>
<span id="cb14-144"><a href="#cb14-144" aria-hidden="true" tabindex="-1"></a><span class="in">  rstan::stan_model(</span></span>
<span id="cb14-145"><a href="#cb14-145" aria-hidden="true" tabindex="-1"></a><span class="in">    file = here::here("scripts", "models", paste0(model_name, ".stan")),</span></span>
<span id="cb14-146"><a href="#cb14-146" aria-hidden="true" tabindex="-1"></a><span class="in">    model_name = model_name</span></span>
<span id="cb14-147"><a href="#cb14-147" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb14-148"><a href="#cb14-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-149"><a href="#cb14-149" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-150"><a href="#cb14-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-151"><a href="#cb14-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-152"><a href="#cb14-152" aria-hidden="true" tabindex="-1"></a>To simulate data with a specific correlation, we need to obtain the true standard deviation of the different centrality measures. For the temporal network, this is easy to compute, as it just follows from the random effects of the VAR matrix. </span>
<span id="cb14-153"><a href="#cb14-153" aria-hidden="true" tabindex="-1"></a>For the partial correlations, this is a bit more complicated, as we simulate from the true covariance matrix, but calculate the centrality based on the partial correlation matrix. Therefore, we just simulate a large number of partial correlation matrices for the data-generating process of each condition and then calculate the implied standard deviation of the centrality measure.</span>
<span id="cb14-154"><a href="#cb14-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-155"><a href="#cb14-155" aria-hidden="true" tabindex="-1"></a><span class="in">```{r true-strength-sd, eval = FALSE}</span></span>
<span id="cb14-156"><a href="#cb14-156" aria-hidden="true" tabindex="-1"></a><span class="in"># number of simulations to obtain sd</span></span>
<span id="cb14-157"><a href="#cb14-157" aria-hidden="true" tabindex="-1"></a><span class="in">n_sim_sd &lt;- 30000</span></span>
<span id="cb14-158"><a href="#cb14-158" aria-hidden="true" tabindex="-1"></a><span class="in">sd_results_strength &lt;- sd_results_outstrength &lt;- sd_results_instrength &lt;- vector("list", length = nrow(df_design))</span></span>
<span id="cb14-159"><a href="#cb14-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-160"><a href="#cb14-160" aria-hidden="true" tabindex="-1"></a><span class="in">for(i in 1:nrow(df_design)){</span></span>
<span id="cb14-161"><a href="#cb14-161" aria-hidden="true" tabindex="-1"></a><span class="in">  condition &lt;- df_design[i,]</span></span>
<span id="cb14-162"><a href="#cb14-162" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-163"><a href="#cb14-163" aria-hidden="true" tabindex="-1"></a><span class="in">  dgp_graph &lt;- ifelse(condition$dgp == "sparse", </span></span>
<span id="cb14-164"><a href="#cb14-164" aria-hidden="true" tabindex="-1"></a><span class="in">                      "graph_sparse", </span></span>
<span id="cb14-165"><a href="#cb14-165" aria-hidden="true" tabindex="-1"></a><span class="in">                      "graph_nonsparse")</span></span>
<span id="cb14-166"><a href="#cb14-166" aria-hidden="true" tabindex="-1"></a><span class="in">  beta_sd &lt;- ifelse(condition$heterogeneity == "low",</span></span>
<span id="cb14-167"><a href="#cb14-167" aria-hidden="true" tabindex="-1"></a><span class="in">                    0.05,</span></span>
<span id="cb14-168"><a href="#cb14-168" aria-hidden="true" tabindex="-1"></a><span class="in">                    0.075)</span></span>
<span id="cb14-169"><a href="#cb14-169" aria-hidden="true" tabindex="-1"></a><span class="in">  sigma_sd &lt;- ifelse(condition$heterogeneity == "low",</span></span>
<span id="cb14-170"><a href="#cb14-170" aria-hidden="true" tabindex="-1"></a><span class="in">                    0.05,</span></span>
<span id="cb14-171"><a href="#cb14-171" aria-hidden="true" tabindex="-1"></a><span class="in">                    0.075)</span></span>
<span id="cb14-172"><a href="#cb14-172" aria-hidden="true" tabindex="-1"></a><span class="in">  ml_sim &lt;- sim_gvar_loop(</span></span>
<span id="cb14-173"><a href="#cb14-173" aria-hidden="true" tabindex="-1"></a><span class="in">                     graph = sim_pars[[dgp_graph]],</span></span>
<span id="cb14-174"><a href="#cb14-174" aria-hidden="true" tabindex="-1"></a><span class="in">                     beta_sd = beta_sd,</span></span>
<span id="cb14-175"><a href="#cb14-175" aria-hidden="true" tabindex="-1"></a><span class="in">                     kappa_sd = kappa_sd,</span></span>
<span id="cb14-176"><a href="#cb14-176" aria-hidden="true" tabindex="-1"></a><span class="in">                     sigma_sd = sigma_sd, </span></span>
<span id="cb14-177"><a href="#cb14-177" aria-hidden="true" tabindex="-1"></a><span class="in">                     n_person = n_sim_sd,</span></span>
<span id="cb14-178"><a href="#cb14-178" aria-hidden="true" tabindex="-1"></a><span class="in">                     n_time = condition$n_tp,</span></span>
<span id="cb14-179"><a href="#cb14-179" aria-hidden="true" tabindex="-1"></a><span class="in">                     n_node = sim_pars$n_var,</span></span>
<span id="cb14-180"><a href="#cb14-180" aria-hidden="true" tabindex="-1"></a><span class="in">                     max_try = 1000,</span></span>
<span id="cb14-181"><a href="#cb14-181" aria-hidden="true" tabindex="-1"></a><span class="in">                     verbose = FALSE,</span></span>
<span id="cb14-182"><a href="#cb14-182" aria-hidden="true" tabindex="-1"></a><span class="in">                     listify = TRUE,</span></span>
<span id="cb14-183"><a href="#cb14-183" aria-hidden="true" tabindex="-1"></a><span class="in">                     sim_pkg = "mlVAR",</span></span>
<span id="cb14-184"><a href="#cb14-184" aria-hidden="true" tabindex="-1"></a><span class="in">                     sparse_sim = TRUE,</span></span>
<span id="cb14-185"><a href="#cb14-185" aria-hidden="true" tabindex="-1"></a><span class="in">                     most_cent_diff_temp = TRUE,</span></span>
<span id="cb14-186"><a href="#cb14-186" aria-hidden="true" tabindex="-1"></a><span class="in">                     most_cent_diff_temp_min = 0.05,</span></span>
<span id="cb14-187"><a href="#cb14-187" aria-hidden="true" tabindex="-1"></a><span class="in">                     most_cent_diff_cont = TRUE,</span></span>
<span id="cb14-188"><a href="#cb14-188" aria-hidden="true" tabindex="-1"></a><span class="in">                     most_cent_diff_cont_min = 0.05,</span></span>
<span id="cb14-189"><a href="#cb14-189" aria-hidden="true" tabindex="-1"></a><span class="in">                     innov_var_fixed_sigma = TRUE)</span></span>
<span id="cb14-190"><a href="#cb14-190" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-191"><a href="#cb14-191" aria-hidden="true" tabindex="-1"></a><span class="in">  # Obtain true centralities</span></span>
<span id="cb14-192"><a href="#cb14-192" aria-hidden="true" tabindex="-1"></a><span class="in">  true_cent &lt;- centrality_mlvar_sim(ml_sim,</span></span>
<span id="cb14-193"><a href="#cb14-193" aria-hidden="true" tabindex="-1"></a><span class="in">                                  sim_fn = "sim_gvar_loop")</span></span>
<span id="cb14-194"><a href="#cb14-194" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-195"><a href="#cb14-195" aria-hidden="true" tabindex="-1"></a><span class="in">  strength &lt;- sapply(true_cent$strength, `[`, 1)</span></span>
<span id="cb14-196"><a href="#cb14-196" aria-hidden="true" tabindex="-1"></a><span class="in">  outstrength &lt;- sapply(true_cent$outstrength, `[`, 1)</span></span>
<span id="cb14-197"><a href="#cb14-197" aria-hidden="true" tabindex="-1"></a><span class="in">  instrength &lt;- sapply(true_cent$instrength, `[`, 1)</span></span>
<span id="cb14-198"><a href="#cb14-198" aria-hidden="true" tabindex="-1"></a><span class="in">  strength_sd &lt;- sd(strength)</span></span>
<span id="cb14-199"><a href="#cb14-199" aria-hidden="true" tabindex="-1"></a><span class="in">  outstrength_sd &lt;- sd(outstrength)</span></span>
<span id="cb14-200"><a href="#cb14-200" aria-hidden="true" tabindex="-1"></a><span class="in">  instrength_sd &lt;- sd(instrength)</span></span>
<span id="cb14-201"><a href="#cb14-201" aria-hidden="true" tabindex="-1"></a><span class="in">  sd_results_strength[[i]] &lt;- strength_sd</span></span>
<span id="cb14-202"><a href="#cb14-202" aria-hidden="true" tabindex="-1"></a><span class="in">  sd_results_outstrength[[i]] &lt;- outstrength_sd</span></span>
<span id="cb14-203"><a href="#cb14-203" aria-hidden="true" tabindex="-1"></a><span class="in">  sd_results_instrength[[i]] &lt;- instrength_sd</span></span>
<span id="cb14-204"><a href="#cb14-204" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb14-205"><a href="#cb14-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-206"><a href="#cb14-206" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-207"><a href="#cb14-207" aria-hidden="true" tabindex="-1"></a><span class="in">sd_results &lt;- list(sd_results_strength, sd_results_outstrength, sd_results_instrength)</span></span>
<span id="cb14-208"><a href="#cb14-208" aria-hidden="true" tabindex="-1"></a><span class="in">names(sd_results) &lt;- c("sd_results_strength", "sd_results_outstrength", "sd_results_instrength")</span></span>
<span id="cb14-209"><a href="#cb14-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-210"><a href="#cb14-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-211"><a href="#cb14-211" aria-hidden="true" tabindex="-1"></a><span class="in">saveRDS(sd_results, here::here("data", "true_sd_semisparse.RDS"))</span></span>
<span id="cb14-212"><a href="#cb14-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-213"><a href="#cb14-213" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-214"><a href="#cb14-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-215"><a href="#cb14-215" aria-hidden="true" tabindex="-1"></a>As we only need to compute the true SD once, we can simply load it from disk to save time: </span>
<span id="cb14-218"><a href="#cb14-218" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb14-219"><a href="#cb14-219" aria-hidden="true" tabindex="-1"></a>true_sd <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"true_sd_semisparse.RDS"</span>))</span>
<span id="cb14-220"><a href="#cb14-220" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(true_sd) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"sd_results_strength"</span>, <span class="st">"sd_results_outstrength"</span>, <span class="st">"sd_results_instrength"</span>)</span>
<span id="cb14-221"><a href="#cb14-221" aria-hidden="true" tabindex="-1"></a>df_design<span class="sc">$</span>strength_sd <span class="ot">&lt;-</span> <span class="fu">unlist</span>(true_sd<span class="sc">$</span>sd_results_strength)</span>
<span id="cb14-222"><a href="#cb14-222" aria-hidden="true" tabindex="-1"></a>df_design<span class="sc">$</span>outstrength_sd <span class="ot">&lt;-</span> <span class="fu">unlist</span>(true_sd<span class="sc">$</span>sd_results_outstrength)</span>
<span id="cb14-223"><a href="#cb14-223" aria-hidden="true" tabindex="-1"></a>df_design<span class="sc">$</span>instrength_sd <span class="ot">&lt;-</span> <span class="fu">unlist</span>(true_sd<span class="sc">$</span>sd_results_instrength)</span>
<span id="cb14-224"><a href="#cb14-224" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-225"><a href="#cb14-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-226"><a href="#cb14-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-227"><a href="#cb14-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-228"><a href="#cb14-228" aria-hidden="true" tabindex="-1"></a><span class="fu">## Simulating Data</span></span>
<span id="cb14-229"><a href="#cb14-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-230"><a href="#cb14-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-231"><a href="#cb14-231" aria-hidden="true" tabindex="-1"></a><span class="in">```{r generate}</span></span>
<span id="cb14-232"><a href="#cb14-232" aria-hidden="true" tabindex="-1"></a><span class="in">sim_generate &lt;- function(condition, fixed_objects = NULL){</span></span>
<span id="cb14-233"><a href="#cb14-233" aria-hidden="true" tabindex="-1"></a><span class="in">  source(here::here("scripts", "00_functions.R"))</span></span>
<span id="cb14-234"><a href="#cb14-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-235"><a href="#cb14-235" aria-hidden="true" tabindex="-1"></a><span class="in">  # obtain fixed params</span></span>
<span id="cb14-236"><a href="#cb14-236" aria-hidden="true" tabindex="-1"></a><span class="in">  SimDesign::Attach(fixed_objects)</span></span>
<span id="cb14-237"><a href="#cb14-237" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-238"><a href="#cb14-238" aria-hidden="true" tabindex="-1"></a><span class="in">  dgp_graph &lt;- ifelse(condition$dgp == "sparse", </span></span>
<span id="cb14-239"><a href="#cb14-239" aria-hidden="true" tabindex="-1"></a><span class="in">                      "graph_sparse", </span></span>
<span id="cb14-240"><a href="#cb14-240" aria-hidden="true" tabindex="-1"></a><span class="in">                      "graph_nonsparse")</span></span>
<span id="cb14-241"><a href="#cb14-241" aria-hidden="true" tabindex="-1"></a><span class="in">  beta_sd &lt;- ifelse(condition$heterogeneity == "low",</span></span>
<span id="cb14-242"><a href="#cb14-242" aria-hidden="true" tabindex="-1"></a><span class="in">                    0.05,</span></span>
<span id="cb14-243"><a href="#cb14-243" aria-hidden="true" tabindex="-1"></a><span class="in">                    0.075)</span></span>
<span id="cb14-244"><a href="#cb14-244" aria-hidden="true" tabindex="-1"></a><span class="in">  sigma_sd &lt;- ifelse(condition$heterogeneity == "low",</span></span>
<span id="cb14-245"><a href="#cb14-245" aria-hidden="true" tabindex="-1"></a><span class="in">                    0.05,</span></span>
<span id="cb14-246"><a href="#cb14-246" aria-hidden="true" tabindex="-1"></a><span class="in">                    0.075)</span></span>
<span id="cb14-247"><a href="#cb14-247" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-248"><a href="#cb14-248" aria-hidden="true" tabindex="-1"></a><span class="in">  # scale kappa random effects w.r.t diagonal elements</span></span>
<span id="cb14-249"><a href="#cb14-249" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_diag_kappa &lt;- mean(diag(fixed_objects[[dgp_graph]]$kappa)) </span></span>
<span id="cb14-250"><a href="#cb14-250" aria-hidden="true" tabindex="-1"></a><span class="in">  kappa_sd_low &lt;- 0.05 * mean_diag_kappa</span></span>
<span id="cb14-251"><a href="#cb14-251" aria-hidden="true" tabindex="-1"></a><span class="in">  kappa_sd_high &lt;- 0.075 * mean_diag_kappa</span></span>
<span id="cb14-252"><a href="#cb14-252" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-253"><a href="#cb14-253" aria-hidden="true" tabindex="-1"></a><span class="in">  kappa_sd &lt;- ifelse(condition$heterogeneity == "low",</span></span>
<span id="cb14-254"><a href="#cb14-254" aria-hidden="true" tabindex="-1"></a><span class="in">                     kappa_sd_low,</span></span>
<span id="cb14-255"><a href="#cb14-255" aria-hidden="true" tabindex="-1"></a><span class="in">                     kappa_sd_high)</span></span>
<span id="cb14-256"><a href="#cb14-256" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-257"><a href="#cb14-257" aria-hidden="true" tabindex="-1"></a><span class="in">  ml_sim &lt;- sim_gvar_loop(</span></span>
<span id="cb14-258"><a href="#cb14-258" aria-hidden="true" tabindex="-1"></a><span class="in">                     graph = fixed_objects[[dgp_graph]],</span></span>
<span id="cb14-259"><a href="#cb14-259" aria-hidden="true" tabindex="-1"></a><span class="in">                     beta_sd = beta_sd,</span></span>
<span id="cb14-260"><a href="#cb14-260" aria-hidden="true" tabindex="-1"></a><span class="in">                     kappa_sd = kappa_sd,</span></span>
<span id="cb14-261"><a href="#cb14-261" aria-hidden="true" tabindex="-1"></a><span class="in">                     sigma_sd = sigma_sd, </span></span>
<span id="cb14-262"><a href="#cb14-262" aria-hidden="true" tabindex="-1"></a><span class="in">                     n_person = condition$n_id,</span></span>
<span id="cb14-263"><a href="#cb14-263" aria-hidden="true" tabindex="-1"></a><span class="in">                     n_time = condition$n_tp,</span></span>
<span id="cb14-264"><a href="#cb14-264" aria-hidden="true" tabindex="-1"></a><span class="in">                     n_node = n_var,</span></span>
<span id="cb14-265"><a href="#cb14-265" aria-hidden="true" tabindex="-1"></a><span class="in">                     max_try = 10000,</span></span>
<span id="cb14-266"><a href="#cb14-266" aria-hidden="true" tabindex="-1"></a><span class="in">                     listify = TRUE,</span></span>
<span id="cb14-267"><a href="#cb14-267" aria-hidden="true" tabindex="-1"></a><span class="in">                     sim_pkg = "mlVAR",</span></span>
<span id="cb14-268"><a href="#cb14-268" aria-hidden="true" tabindex="-1"></a><span class="in">                     sparse_sim = TRUE,</span></span>
<span id="cb14-269"><a href="#cb14-269" aria-hidden="true" tabindex="-1"></a><span class="in">                     most_cent_diff_temp = TRUE,</span></span>
<span id="cb14-270"><a href="#cb14-270" aria-hidden="true" tabindex="-1"></a><span class="in">                     most_cent_diff_temp_min = 0.05,</span></span>
<span id="cb14-271"><a href="#cb14-271" aria-hidden="true" tabindex="-1"></a><span class="in">                     most_cent_diff_cont = TRUE,</span></span>
<span id="cb14-272"><a href="#cb14-272" aria-hidden="true" tabindex="-1"></a><span class="in">                     most_cent_diff_cont_min = 0.05,</span></span>
<span id="cb14-273"><a href="#cb14-273" aria-hidden="true" tabindex="-1"></a><span class="in">                     innov_var_fixed_sigma = TRUE)</span></span>
<span id="cb14-274"><a href="#cb14-274" aria-hidden="true" tabindex="-1"></a><span class="in">  if(any(is.na(ml_sim$beta))){</span></span>
<span id="cb14-275"><a href="#cb14-275" aria-hidden="true" tabindex="-1"></a><span class="in">    stop("Generation of Betas failed")</span></span>
<span id="cb14-276"><a href="#cb14-276" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-277"><a href="#cb14-277" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-278"><a href="#cb14-278" aria-hidden="true" tabindex="-1"></a><span class="in">  if(any(is.na(ml_sim$pcor))){</span></span>
<span id="cb14-279"><a href="#cb14-279" aria-hidden="true" tabindex="-1"></a><span class="in">    stop("Generation of PCORs failed")</span></span>
<span id="cb14-280"><a href="#cb14-280" aria-hidden="true" tabindex="-1"></a><span class="in">  } </span></span>
<span id="cb14-281"><a href="#cb14-281" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-282"><a href="#cb14-282" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-283"><a href="#cb14-283" aria-hidden="true" tabindex="-1"></a><span class="in">  # Obtain true centralities</span></span>
<span id="cb14-284"><a href="#cb14-284" aria-hidden="true" tabindex="-1"></a><span class="in">  true_cent &lt;- centrality_mlvar_sim(ml_sim,</span></span>
<span id="cb14-285"><a href="#cb14-285" aria-hidden="true" tabindex="-1"></a><span class="in">                                    sim_fn = "sim_gvar_loop")</span></span>
<span id="cb14-286"><a href="#cb14-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-287"><a href="#cb14-287" aria-hidden="true" tabindex="-1"></a><span class="in">  # Obtain true centralities</span></span>
<span id="cb14-288"><a href="#cb14-288" aria-hidden="true" tabindex="-1"></a><span class="in">  instrength &lt;- sapply(true_cent$instrength, `[`, 1)</span></span>
<span id="cb14-289"><a href="#cb14-289" aria-hidden="true" tabindex="-1"></a><span class="in">  outstrength &lt;- sapply(true_cent$outstrength, `[`, 1)</span></span>
<span id="cb14-290"><a href="#cb14-290" aria-hidden="true" tabindex="-1"></a><span class="in">  strength &lt;- sapply(true_cent$strength, `[`, 1)</span></span>
<span id="cb14-291"><a href="#cb14-291" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-292"><a href="#cb14-292" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-293"><a href="#cb14-293" aria-hidden="true" tabindex="-1"></a><span class="in">  # Simulate correlated data with true variance of centralities</span></span>
<span id="cb14-294"><a href="#cb14-294" aria-hidden="true" tabindex="-1"></a><span class="in">  # first column is the density to keep track of the density</span></span>
<span id="cb14-295"><a href="#cb14-295" aria-hidden="true" tabindex="-1"></a><span class="in">  # and for compatibility with an old sim function</span></span>
<span id="cb14-296"><a href="#cb14-296" aria-hidden="true" tabindex="-1"></a><span class="in">  sim_correlated &lt;- function(density, </span></span>
<span id="cb14-297"><a href="#cb14-297" aria-hidden="true" tabindex="-1"></a><span class="in">                             r_true, </span></span>
<span id="cb14-298"><a href="#cb14-298" aria-hidden="true" tabindex="-1"></a><span class="in">                             sd_true){</span></span>
<span id="cb14-299"><a href="#cb14-299" aria-hidden="true" tabindex="-1"></a><span class="in">  y_matrix &lt;- matrix(NA, nrow = length(density), ncol = length(r_true) + 1)</span></span>
<span id="cb14-300"><a href="#cb14-300" aria-hidden="true" tabindex="-1"></a><span class="in">  y_matrix[, 1] &lt;- density</span></span>
<span id="cb14-301"><a href="#cb14-301" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-302"><a href="#cb14-302" aria-hidden="true" tabindex="-1"></a><span class="in">  for (i in seq_along(r_true)) {</span></span>
<span id="cb14-303"><a href="#cb14-303" aria-hidden="true" tabindex="-1"></a><span class="in">    sd_error &lt;- sd_true * sqrt(1 - r_true[i]^2)</span></span>
<span id="cb14-304"><a href="#cb14-304" aria-hidden="true" tabindex="-1"></a><span class="in">    y_matrix[, i + 1] &lt;- r_true[i] * density + rnorm(length(density), mean = 0, sd = sd_error)</span></span>
<span id="cb14-305"><a href="#cb14-305" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-306"><a href="#cb14-306" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-307"><a href="#cb14-307" aria-hidden="true" tabindex="-1"></a><span class="in">  return(y_matrix)</span></span>
<span id="cb14-308"><a href="#cb14-308" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-309"><a href="#cb14-309" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-310"><a href="#cb14-310" aria-hidden="true" tabindex="-1"></a><span class="in">  # True density standard deviations would just be the random effects sds</span></span>
<span id="cb14-311"><a href="#cb14-311" aria-hidden="true" tabindex="-1"></a><span class="in">  # divided by the sqrt(n) -&gt; it's just the standard deviation of the average</span></span>
<span id="cb14-312"><a href="#cb14-312" aria-hidden="true" tabindex="-1"></a><span class="in">  # of multiple independent random variables. BUT we convert to partial </span></span>
<span id="cb14-313"><a href="#cb14-313" aria-hidden="true" tabindex="-1"></a><span class="in">  # correlations, and we take the absolute values, so we just approximate</span></span>
<span id="cb14-314"><a href="#cb14-314" aria-hidden="true" tabindex="-1"></a><span class="in">  # the true SD with a monte carlo approach</span></span>
<span id="cb14-315"><a href="#cb14-315" aria-hidden="true" tabindex="-1"></a><span class="in">  covariate_cont_strength &lt;- sim_correlated(density = strength,</span></span>
<span id="cb14-316"><a href="#cb14-316" aria-hidden="true" tabindex="-1"></a><span class="in">                                            r_true = c(0, 0.2, 0.4),</span></span>
<span id="cb14-317"><a href="#cb14-317" aria-hidden="true" tabindex="-1"></a><span class="in">                                            sd_true = condition$strength_sd)</span></span>
<span id="cb14-318"><a href="#cb14-318" aria-hidden="true" tabindex="-1"></a><span class="in">  covariate_in_strength &lt;- sim_correlated(density = instrength, </span></span>
<span id="cb14-319"><a href="#cb14-319" aria-hidden="true" tabindex="-1"></a><span class="in">                                          r_true = c(0, 0.2, 0.4), </span></span>
<span id="cb14-320"><a href="#cb14-320" aria-hidden="true" tabindex="-1"></a><span class="in">                                          sd_true = condition$instrength_sd)</span></span>
<span id="cb14-321"><a href="#cb14-321" aria-hidden="true" tabindex="-1"></a><span class="in">  covariate_out_strength &lt;- sim_correlated(density = outstrength, </span></span>
<span id="cb14-322"><a href="#cb14-322" aria-hidden="true" tabindex="-1"></a><span class="in">                                           r_true = c(0, 0.2, 0.4), </span></span>
<span id="cb14-323"><a href="#cb14-323" aria-hidden="true" tabindex="-1"></a><span class="in">                                           sd_true = condition$outstrength_sd)</span></span>
<span id="cb14-324"><a href="#cb14-324" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-325"><a href="#cb14-325" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-326"><a href="#cb14-326" aria-hidden="true" tabindex="-1"></a><span class="in">  if(sd(instrength) == 0){</span></span>
<span id="cb14-327"><a href="#cb14-327" aria-hidden="true" tabindex="-1"></a><span class="in">    stop("No variation in instrength")</span></span>
<span id="cb14-328"><a href="#cb14-328" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-329"><a href="#cb14-329" aria-hidden="true" tabindex="-1"></a><span class="in">  if(sd(outstrength) == 0){</span></span>
<span id="cb14-330"><a href="#cb14-330" aria-hidden="true" tabindex="-1"></a><span class="in">    stop("No variation in outstrength")</span></span>
<span id="cb14-331"><a href="#cb14-331" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-332"><a href="#cb14-332" aria-hidden="true" tabindex="-1"></a><span class="in">  if(sd(strength) == 0){</span></span>
<span id="cb14-333"><a href="#cb14-333" aria-hidden="true" tabindex="-1"></a><span class="in">    stop("No variation in strength")</span></span>
<span id="cb14-334"><a href="#cb14-334" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-335"><a href="#cb14-335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-336"><a href="#cb14-336" aria-hidden="true" tabindex="-1"></a><span class="in">  # Sanity checks</span></span>
<span id="cb14-337"><a href="#cb14-337" aria-hidden="true" tabindex="-1"></a><span class="in">  cor_strength &lt;- cor(covariate_cont_strength[,1], covariate_cont_strength)</span></span>
<span id="cb14-338"><a href="#cb14-338" aria-hidden="true" tabindex="-1"></a><span class="in">  cor_instrength &lt;- cor(covariate_in_strength[,1], covariate_in_strength)</span></span>
<span id="cb14-339"><a href="#cb14-339" aria-hidden="true" tabindex="-1"></a><span class="in">  cor_outstrength &lt;- cor(covariate_out_strength[,1], covariate_out_strength)</span></span>
<span id="cb14-340"><a href="#cb14-340" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-341"><a href="#cb14-341" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-342"><a href="#cb14-342" aria-hidden="true" tabindex="-1"></a><span class="in">  # Return data and true centralities</span></span>
<span id="cb14-343"><a href="#cb14-343" aria-hidden="true" tabindex="-1"></a><span class="in">  ret_data &lt;- list(</span></span>
<span id="cb14-344"><a href="#cb14-344" aria-hidden="true" tabindex="-1"></a><span class="in">    data = ml_sim$data,</span></span>
<span id="cb14-345"><a href="#cb14-345" aria-hidden="true" tabindex="-1"></a><span class="in">    beta = ml_sim$beta_l,</span></span>
<span id="cb14-346"><a href="#cb14-346" aria-hidden="true" tabindex="-1"></a><span class="in">    kappa = ml_sim$kappa_l,</span></span>
<span id="cb14-347"><a href="#cb14-347" aria-hidden="true" tabindex="-1"></a><span class="in">    pcor = ml_sim$pcor_l,</span></span>
<span id="cb14-348"><a href="#cb14-348" aria-hidden="true" tabindex="-1"></a><span class="in">    covariate_cont_strength = covariate_cont_strength,</span></span>
<span id="cb14-349"><a href="#cb14-349" aria-hidden="true" tabindex="-1"></a><span class="in">    covariate_out_strength = covariate_out_strength,</span></span>
<span id="cb14-350"><a href="#cb14-350" aria-hidden="true" tabindex="-1"></a><span class="in">    covariate_in_strength = covariate_in_strength,</span></span>
<span id="cb14-351"><a href="#cb14-351" aria-hidden="true" tabindex="-1"></a><span class="in">    true_cent = true_cent,</span></span>
<span id="cb14-352"><a href="#cb14-352" aria-hidden="true" tabindex="-1"></a><span class="in">    # TODO delete these</span></span>
<span id="cb14-353"><a href="#cb14-353" aria-hidden="true" tabindex="-1"></a><span class="in">    cor_strength = cor_strength,</span></span>
<span id="cb14-354"><a href="#cb14-354" aria-hidden="true" tabindex="-1"></a><span class="in">    cor_instrength = cor_instrength,</span></span>
<span id="cb14-355"><a href="#cb14-355" aria-hidden="true" tabindex="-1"></a><span class="in">    cor_outstrength = cor_outstrength</span></span>
<span id="cb14-356"><a href="#cb14-356" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb14-357"><a href="#cb14-357" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-358"><a href="#cb14-358" aria-hidden="true" tabindex="-1"></a><span class="in">  return(ret_data)</span></span>
<span id="cb14-359"><a href="#cb14-359" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-360"><a href="#cb14-360" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-361"><a href="#cb14-361" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb14-362"><a href="#cb14-362" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-363"><a href="#cb14-363" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-364"><a href="#cb14-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-365"><a href="#cb14-365" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-366"><a href="#cb14-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-367"><a href="#cb14-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-368"><a href="#cb14-368" aria-hidden="true" tabindex="-1"></a><span class="fu"># Analysis</span></span>
<span id="cb14-369"><a href="#cb14-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-370"><a href="#cb14-370" aria-hidden="true" tabindex="-1"></a><span class="in">```{r data-analysis}</span></span>
<span id="cb14-371"><a href="#cb14-371" aria-hidden="true" tabindex="-1"></a><span class="in">sim_analyse &lt;- function(condition, dat, fixed_objects = NULL){</span></span>
<span id="cb14-372"><a href="#cb14-372" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-373"><a href="#cb14-373" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- Preparation</span></span>
<span id="cb14-374"><a href="#cb14-374" aria-hidden="true" tabindex="-1"></a><span class="in">  SimDesign::Attach(fixed_objects)</span></span>
<span id="cb14-375"><a href="#cb14-375" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-376"><a href="#cb14-376" aria-hidden="true" tabindex="-1"></a><span class="in">  # Check if mean centering option is true, if so, mean center</span></span>
<span id="cb14-377"><a href="#cb14-377" aria-hidden="true" tabindex="-1"></a><span class="in">  if(isTRUE(fixed_objects$mean_center)){</span></span>
<span id="cb14-378"><a href="#cb14-378" aria-hidden="true" tabindex="-1"></a><span class="in">    dat$data_centered &lt;- lapply(dat$data, function(x){</span></span>
<span id="cb14-379"><a href="#cb14-379" aria-hidden="true" tabindex="-1"></a><span class="in">      x |&gt; </span></span>
<span id="cb14-380"><a href="#cb14-380" aria-hidden="true" tabindex="-1"></a><span class="in">        dplyr::as_tibble() |&gt; </span></span>
<span id="cb14-381"><a href="#cb14-381" aria-hidden="true" tabindex="-1"></a><span class="in">        dplyr::mutate(across(everything(), ~ . - mean(.)))</span></span>
<span id="cb14-382"><a href="#cb14-382" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb14-383"><a href="#cb14-383" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb14-384"><a href="#cb14-384" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-385"><a href="#cb14-385" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-386"><a href="#cb14-386" aria-hidden="true" tabindex="-1"></a><span class="in">  # Concatenate list of data into dataframe with id column</span></span>
<span id="cb14-387"><a href="#cb14-387" aria-hidden="true" tabindex="-1"></a><span class="in">  df_data_centered &lt;- dplyr::bind_rows(purrr::map(dat$data_centered, dplyr::as_tibble)</span></span>
<span id="cb14-388"><a href="#cb14-388" aria-hidden="true" tabindex="-1"></a><span class="in">                              , .id = "ID") |&gt; </span></span>
<span id="cb14-389"><a href="#cb14-389" aria-hidden="true" tabindex="-1"></a><span class="in">    dplyr::mutate(ID = as.factor(ID))</span></span>
<span id="cb14-390"><a href="#cb14-390" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-391"><a href="#cb14-391" aria-hidden="true" tabindex="-1"></a><span class="in">  df_data &lt;- dplyr::bind_rows(purrr::map(dat$data, dplyr::as_tibble)</span></span>
<span id="cb14-392"><a href="#cb14-392" aria-hidden="true" tabindex="-1"></a><span class="in">                              , .id = "ID") |&gt; </span></span>
<span id="cb14-393"><a href="#cb14-393" aria-hidden="true" tabindex="-1"></a><span class="in">    dplyr::mutate(ID = as.factor(ID))</span></span>
<span id="cb14-394"><a href="#cb14-394" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-395"><a href="#cb14-395" aria-hidden="true" tabindex="-1"></a><span class="in">  n_id &lt;- condition$n_id</span></span>
<span id="cb14-396"><a href="#cb14-396" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-397"><a href="#cb14-397" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- graphicalVAR</span></span>
<span id="cb14-398"><a href="#cb14-398" aria-hidden="true" tabindex="-1"></a><span class="in">  # Fit models</span></span>
<span id="cb14-399"><a href="#cb14-399" aria-hidden="true" tabindex="-1"></a><span class="in">  fit_gvar &lt;- lapply(dat$data_centered, function(x){</span></span>
<span id="cb14-400"><a href="#cb14-400" aria-hidden="true" tabindex="-1"></a><span class="in">    tryCatch({suppressMessages(graphicalVAR::graphicalVAR(x, </span></span>
<span id="cb14-401"><a href="#cb14-401" aria-hidden="true" tabindex="-1"></a><span class="in">                               nLambda = 50,</span></span>
<span id="cb14-402"><a href="#cb14-402" aria-hidden="true" tabindex="-1"></a><span class="in">                               verbose = FALSE,</span></span>
<span id="cb14-403"><a href="#cb14-403" aria-hidden="true" tabindex="-1"></a><span class="in">                               gamma = 0, </span></span>
<span id="cb14-404"><a href="#cb14-404" aria-hidden="true" tabindex="-1"></a><span class="in">                               scale = FALSE))}, error = function(e) NA)</span></span>
<span id="cb14-405"><a href="#cb14-405" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-406"><a href="#cb14-406" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-407"><a href="#cb14-407" aria-hidden="true" tabindex="-1"></a><span class="in">  if(any(is.na(fit_gvar))){</span></span>
<span id="cb14-408"><a href="#cb14-408" aria-hidden="true" tabindex="-1"></a><span class="in">    stop("Not all GVAR models converged.")</span></span>
<span id="cb14-409"><a href="#cb14-409" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-410"><a href="#cb14-410" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-411"><a href="#cb14-411" aria-hidden="true" tabindex="-1"></a><span class="in">  # Obtain centralities, IDs nested in list</span></span>
<span id="cb14-412"><a href="#cb14-412" aria-hidden="true" tabindex="-1"></a><span class="in">  cent_gvar &lt;- purrr::transpose(lapply(fit_gvar, function(x){</span></span>
<span id="cb14-413"><a href="#cb14-413" aria-hidden="true" tabindex="-1"></a><span class="in">    centrality_gvar(x)</span></span>
<span id="cb14-414"><a href="#cb14-414" aria-hidden="true" tabindex="-1"></a><span class="in">  }))</span></span>
<span id="cb14-415"><a href="#cb14-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-416"><a href="#cb14-416" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-417"><a href="#cb14-417" aria-hidden="true" tabindex="-1"></a><span class="in">  dens_temp_gvar &lt;- unlist(cent_gvar$dens_temp)</span></span>
<span id="cb14-418"><a href="#cb14-418" aria-hidden="true" tabindex="-1"></a><span class="in">  dens_cont_gvar &lt;- unlist(cent_gvar$dens_cont)</span></span>
<span id="cb14-419"><a href="#cb14-419" aria-hidden="true" tabindex="-1"></a><span class="in">  outstrength_gvar &lt;- lapply(cent_gvar$outstrength, function(x) unname(x))</span></span>
<span id="cb14-420"><a href="#cb14-420" aria-hidden="true" tabindex="-1"></a><span class="in">  instrength_gvar &lt;- lapply(cent_gvar$instrength, function(x) unname(x))</span></span>
<span id="cb14-421"><a href="#cb14-421" aria-hidden="true" tabindex="-1"></a><span class="in">  strength_gvar &lt;- lapply(cent_gvar$strength, function(x) unname(x))</span></span>
<span id="cb14-422"><a href="#cb14-422" aria-hidden="true" tabindex="-1"></a><span class="in">  instrength_gvar_first &lt;- sapply(cent_gvar$instrength, function(x) unname(x[1]))</span></span>
<span id="cb14-423"><a href="#cb14-423" aria-hidden="true" tabindex="-1"></a><span class="in">  strength_gvar_first &lt;- sapply(cent_gvar$strength, function(x) unname(x[1]))</span></span>
<span id="cb14-424"><a href="#cb14-424" aria-hidden="true" tabindex="-1"></a><span class="in">  outstrength_gvar_first &lt;- sapply(cent_gvar$outstrength, function(x) unname(x[1]))</span></span>
<span id="cb14-425"><a href="#cb14-425" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-426"><a href="#cb14-426" aria-hidden="true" tabindex="-1"></a><span class="in">  # Create list of subject-specific estimates</span></span>
<span id="cb14-427"><a href="#cb14-427" aria-hidden="true" tabindex="-1"></a><span class="in">  beta_gvar &lt;- lapply(fit_gvar, function(x){</span></span>
<span id="cb14-428"><a href="#cb14-428" aria-hidden="true" tabindex="-1"></a><span class="in">    x$beta[,-1]</span></span>
<span id="cb14-429"><a href="#cb14-429" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-430"><a href="#cb14-430" aria-hidden="true" tabindex="-1"></a><span class="in">  pcor_gvar &lt;- lapply(fit_gvar, function(x){</span></span>
<span id="cb14-431"><a href="#cb14-431" aria-hidden="true" tabindex="-1"></a><span class="in">    x$PCC</span></span>
<span id="cb14-432"><a href="#cb14-432" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-433"><a href="#cb14-433" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-434"><a href="#cb14-434" aria-hidden="true" tabindex="-1"></a><span class="in">  # Fit regression</span></span>
<span id="cb14-435"><a href="#cb14-435" aria-hidden="true" tabindex="-1"></a><span class="in">  reg_gvar_in_strength &lt;- lapply(2:4, function(i) lm(dat$covariate_in_strength[, i] ~ instrength_gvar_first))</span></span>
<span id="cb14-436"><a href="#cb14-436" aria-hidden="true" tabindex="-1"></a><span class="in">  reg_gvar_cont_strength &lt;- lapply(2:4, function(i) lm(dat$covariate_cont_strength[, i] ~ strength_gvar_first))</span></span>
<span id="cb14-437"><a href="#cb14-437" aria-hidden="true" tabindex="-1"></a><span class="in">  reg_gvar_out_strength &lt;- lapply(2:4, function(i) lm(dat$covariate_out_strength[, i] ~ outstrength_gvar_first))</span></span>
<span id="cb14-438"><a href="#cb14-438" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-439"><a href="#cb14-439" aria-hidden="true" tabindex="-1"></a><span class="in">  # remove fit object to save memory</span></span>
<span id="cb14-440"><a href="#cb14-440" aria-hidden="true" tabindex="-1"></a><span class="in">  rm(fit_gvar)</span></span>
<span id="cb14-441"><a href="#cb14-441" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-442"><a href="#cb14-442" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- GIMME</span></span>
<span id="cb14-443"><a href="#cb14-443" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-444"><a href="#cb14-444" aria-hidden="true" tabindex="-1"></a><span class="in">  # Fit model</span></span>
<span id="cb14-445"><a href="#cb14-445" aria-hidden="true" tabindex="-1"></a><span class="in">  fit_gimme &lt;- tryCatch({gimme::gimme(dat$data_centered,</span></span>
<span id="cb14-446"><a href="#cb14-446" aria-hidden="true" tabindex="-1"></a><span class="in">                            ar = TRUE,</span></span>
<span id="cb14-447"><a href="#cb14-447" aria-hidden="true" tabindex="-1"></a><span class="in">                            subgroup = TRUE,</span></span>
<span id="cb14-448"><a href="#cb14-448" aria-hidden="true" tabindex="-1"></a><span class="in">                            plot = FALSE,</span></span>
<span id="cb14-449"><a href="#cb14-449" aria-hidden="true" tabindex="-1"></a><span class="in">                            hybrid = FALSE,</span></span>
<span id="cb14-450"><a href="#cb14-450" aria-hidden="true" tabindex="-1"></a><span class="in">                            groupcutoff = .75,</span></span>
<span id="cb14-451"><a href="#cb14-451" aria-hidden="true" tabindex="-1"></a><span class="in">                            subcutoff = .75,</span></span>
<span id="cb14-452"><a href="#cb14-452" aria-hidden="true" tabindex="-1"></a><span class="in">                            VAR = gimme_var_only)}, error = function(e) NA)</span></span>
<span id="cb14-453"><a href="#cb14-453" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-454"><a href="#cb14-454" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-455"><a href="#cb14-455" aria-hidden="true" tabindex="-1"></a><span class="in">  if(any(is.na(fit_gimme))){</span></span>
<span id="cb14-456"><a href="#cb14-456" aria-hidden="true" tabindex="-1"></a><span class="in">    stop("GIMME did not converge.")</span></span>
<span id="cb14-457"><a href="#cb14-457" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-458"><a href="#cb14-458" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-459"><a href="#cb14-459" aria-hidden="true" tabindex="-1"></a><span class="in">  # for var_only, we need to first extract the contemporaneous matrices</span></span>
<span id="cb14-460"><a href="#cb14-460" aria-hidden="true" tabindex="-1"></a><span class="in">  if(isTRUE(gimme_var_only)){</span></span>
<span id="cb14-461"><a href="#cb14-461" aria-hidden="true" tabindex="-1"></a><span class="in">    fit_gimme$contemp_mat &lt;- lapply(1:length(fit_gimme$path_est_mats), function(i){</span></span>
<span id="cb14-462"><a href="#cb14-462" aria-hidden="true" tabindex="-1"></a><span class="in">      gimme_cor_mat(fit_gimme, id = i, n_vars = n_var, pcor = fixed_objects$gimme_pcor)</span></span>
<span id="cb14-463"><a href="#cb14-463" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb14-464"><a href="#cb14-464" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb14-465"><a href="#cb14-465" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-466"><a href="#cb14-466" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-467"><a href="#cb14-467" aria-hidden="true" tabindex="-1"></a><span class="in">  cent_gimme &lt;- centrality_gimme(fit_gimme,</span></span>
<span id="cb14-468"><a href="#cb14-468" aria-hidden="true" tabindex="-1"></a><span class="in">                                 var_only = gimme_var_only)</span></span>
<span id="cb14-469"><a href="#cb14-469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-470"><a href="#cb14-470" aria-hidden="true" tabindex="-1"></a><span class="in">  # Obtain centralities</span></span>
<span id="cb14-471"><a href="#cb14-471" aria-hidden="true" tabindex="-1"></a><span class="in">  dens_temp_gimme &lt;- unlist(cent_gimme$dens_temp)</span></span>
<span id="cb14-472"><a href="#cb14-472" aria-hidden="true" tabindex="-1"></a><span class="in">  dens_cont_gimme &lt;- unlist(cent_gimme$dens_cont)</span></span>
<span id="cb14-473"><a href="#cb14-473" aria-hidden="true" tabindex="-1"></a><span class="in">  outstrength_gimme &lt;- lapply(cent_gimme$outstrength, function(x) unname(x))</span></span>
<span id="cb14-474"><a href="#cb14-474" aria-hidden="true" tabindex="-1"></a><span class="in">  instrength_gimme &lt;- lapply(cent_gimme$instrength, function(x) unname(x))</span></span>
<span id="cb14-475"><a href="#cb14-475" aria-hidden="true" tabindex="-1"></a><span class="in">  strength_gimme &lt;- lapply(cent_gimme$strength, function(x) unname(x))</span></span>
<span id="cb14-476"><a href="#cb14-476" aria-hidden="true" tabindex="-1"></a><span class="in">  outstrength_gimme_first &lt;- sapply(cent_gimme$outstrength, function(x) unname(x[1]))</span></span>
<span id="cb14-477"><a href="#cb14-477" aria-hidden="true" tabindex="-1"></a><span class="in">  instrength_gimme_first &lt;- sapply(cent_gimme$instrength, function(x) unname(x[1]))</span></span>
<span id="cb14-478"><a href="#cb14-478" aria-hidden="true" tabindex="-1"></a><span class="in">  strength_gimme_first &lt;- sapply(cent_gimme$strength, function(x) unname(x[1]))</span></span>
<span id="cb14-479"><a href="#cb14-479" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-480"><a href="#cb14-480" aria-hidden="true" tabindex="-1"></a><span class="in">  # Create list of subject-specific estimates</span></span>
<span id="cb14-481"><a href="#cb14-481" aria-hidden="true" tabindex="-1"></a><span class="in">  beta_gimme &lt;- lapply(fit_gimme$path_est_mats, function(x){</span></span>
<span id="cb14-482"><a href="#cb14-482" aria-hidden="true" tabindex="-1"></a><span class="in">    x[,1:n_var]</span></span>
<span id="cb14-483"><a href="#cb14-483" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-484"><a href="#cb14-484" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-485"><a href="#cb14-485" aria-hidden="true" tabindex="-1"></a><span class="in">  if(isFALSE(gimme_var_only)){</span></span>
<span id="cb14-486"><a href="#cb14-486" aria-hidden="true" tabindex="-1"></a><span class="in">      pcor_gimme &lt;- lapply(fit_gimme$path_est_mats, function(x){</span></span>
<span id="cb14-487"><a href="#cb14-487" aria-hidden="true" tabindex="-1"></a><span class="in">    x[, (n_var+1):(n_var*2)]</span></span>
<span id="cb14-488"><a href="#cb14-488" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-489"><a href="#cb14-489" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-490"><a href="#cb14-490" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-491"><a href="#cb14-491" aria-hidden="true" tabindex="-1"></a><span class="in">  if(isTRUE(gimme_var_only)){</span></span>
<span id="cb14-492"><a href="#cb14-492" aria-hidden="true" tabindex="-1"></a><span class="in">    pcor_gimme &lt;- lapply(fit_gimme$contemp_mat, function(x){</span></span>
<span id="cb14-493"><a href="#cb14-493" aria-hidden="true" tabindex="-1"></a><span class="in">      x</span></span>
<span id="cb14-494"><a href="#cb14-494" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb14-495"><a href="#cb14-495" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-496"><a href="#cb14-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-497"><a href="#cb14-497" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-498"><a href="#cb14-498" aria-hidden="true" tabindex="-1"></a><span class="in">  # Fit regression</span></span>
<span id="cb14-499"><a href="#cb14-499" aria-hidden="true" tabindex="-1"></a><span class="in">  reg_gimme_in_strength &lt;- lapply(2:4, function(i) lm(dat$covariate_in_strength[, i] ~ instrength_gimme_first))</span></span>
<span id="cb14-500"><a href="#cb14-500" aria-hidden="true" tabindex="-1"></a><span class="in">  reg_gimme_cont_strength &lt;- lapply(2:4, function(i) lm(dat$covariate_cont_strength[, i] ~ strength_gimme_first))</span></span>
<span id="cb14-501"><a href="#cb14-501" aria-hidden="true" tabindex="-1"></a><span class="in">  reg_gimme_out_strength &lt;- lapply(2:4, function(i) lm(dat$covariate_out_strength[, i] ~ outstrength_gimme_first))</span></span>
<span id="cb14-502"><a href="#cb14-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-503"><a href="#cb14-503" aria-hidden="true" tabindex="-1"></a><span class="in">  rm(fit_gimme)</span></span>
<span id="cb14-504"><a href="#cb14-504" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-505"><a href="#cb14-505" aria-hidden="true" tabindex="-1"></a><span class="in">  # #--- frequentist mlVAR</span></span>
<span id="cb14-506"><a href="#cb14-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-507"><a href="#cb14-507" aria-hidden="true" tabindex="-1"></a><span class="in">  # Fit model</span></span>
<span id="cb14-508"><a href="#cb14-508" aria-hidden="true" tabindex="-1"></a><span class="in">  fit_mlvar &lt;- tryCatch({suppressWarnings(mlVAR::mlVAR(df_data_centered,</span></span>
<span id="cb14-509"><a href="#cb14-509" aria-hidden="true" tabindex="-1"></a><span class="in">                            vars = paste0("V", seq(1:n_var)),</span></span>
<span id="cb14-510"><a href="#cb14-510" aria-hidden="true" tabindex="-1"></a><span class="in">                            idvar = "ID",</span></span>
<span id="cb14-511"><a href="#cb14-511" aria-hidden="true" tabindex="-1"></a><span class="in">                            estimator = "lmer",</span></span>
<span id="cb14-512"><a href="#cb14-512" aria-hidden="true" tabindex="-1"></a><span class="in">                            contemporaneous = "correlated",</span></span>
<span id="cb14-513"><a href="#cb14-513" aria-hidden="true" tabindex="-1"></a><span class="in">                            temporal = "correlated",</span></span>
<span id="cb14-514"><a href="#cb14-514" aria-hidden="true" tabindex="-1"></a><span class="in">                            nCores = 1,</span></span>
<span id="cb14-515"><a href="#cb14-515" aria-hidden="true" tabindex="-1"></a><span class="in">                            scale = FALSE))}, error = function(e) NA)</span></span>
<span id="cb14-516"><a href="#cb14-516" aria-hidden="true" tabindex="-1"></a><span class="in">  if(any(is.na(fit_mlvar))){</span></span>
<span id="cb14-517"><a href="#cb14-517" aria-hidden="true" tabindex="-1"></a><span class="in">    stop("mlVAR did not converge.")</span></span>
<span id="cb14-518"><a href="#cb14-518" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-519"><a href="#cb14-519" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-520"><a href="#cb14-520" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-521"><a href="#cb14-521" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-522"><a href="#cb14-522" aria-hidden="true" tabindex="-1"></a><span class="in">  # Obtain centralities</span></span>
<span id="cb14-523"><a href="#cb14-523" aria-hidden="true" tabindex="-1"></a><span class="in">  cent_mlvar &lt;- centrality_mlvar(fit_mlvar)</span></span>
<span id="cb14-524"><a href="#cb14-524" aria-hidden="true" tabindex="-1"></a><span class="in">  dens_temp_mlvar &lt;- unlist(cent_mlvar$dens_temp)</span></span>
<span id="cb14-525"><a href="#cb14-525" aria-hidden="true" tabindex="-1"></a><span class="in">  dens_cont_mlvar &lt;- unlist(cent_mlvar$dens_cont)</span></span>
<span id="cb14-526"><a href="#cb14-526" aria-hidden="true" tabindex="-1"></a><span class="in">  outstrength_mlvar &lt;- lapply(cent_mlvar$outstrength, function(x) unname(x))</span></span>
<span id="cb14-527"><a href="#cb14-527" aria-hidden="true" tabindex="-1"></a><span class="in">  strength_mlvar &lt;- lapply(cent_mlvar$strength, function(x) unname(x))</span></span>
<span id="cb14-528"><a href="#cb14-528" aria-hidden="true" tabindex="-1"></a><span class="in">  instrength_mlvar &lt;- lapply(cent_mlvar$instrength, function(x) unname(x))</span></span>
<span id="cb14-529"><a href="#cb14-529" aria-hidden="true" tabindex="-1"></a><span class="in">  outstrength_mlvar_first &lt;- sapply(cent_mlvar$outstrength, function(x) unname(x[1]))</span></span>
<span id="cb14-530"><a href="#cb14-530" aria-hidden="true" tabindex="-1"></a><span class="in">  instrength_mlvar_first &lt;- sapply(cent_mlvar$instrength, function(x) unname(x[1]))</span></span>
<span id="cb14-531"><a href="#cb14-531" aria-hidden="true" tabindex="-1"></a><span class="in">  strength_mlvar_first &lt;- sapply(cent_mlvar$strength, function(x) unname(x[1]))</span></span>
<span id="cb14-532"><a href="#cb14-532" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-533"><a href="#cb14-533" aria-hidden="true" tabindex="-1"></a><span class="in">  # Create list of subject-specific estimates</span></span>
<span id="cb14-534"><a href="#cb14-534" aria-hidden="true" tabindex="-1"></a><span class="in">  beta_mlvar &lt;- lapply(1:n_id, function(i){</span></span>
<span id="cb14-535"><a href="#cb14-535" aria-hidden="true" tabindex="-1"></a><span class="in">    t(mlVAR::getNet(fit_mlvar,</span></span>
<span id="cb14-536"><a href="#cb14-536" aria-hidden="true" tabindex="-1"></a><span class="in">                  subject = i,</span></span>
<span id="cb14-537"><a href="#cb14-537" aria-hidden="true" tabindex="-1"></a><span class="in">                  type = "temporal",</span></span>
<span id="cb14-538"><a href="#cb14-538" aria-hidden="true" tabindex="-1"></a><span class="in">                  nonsig = "show"))</span></span>
<span id="cb14-539"><a href="#cb14-539" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-540"><a href="#cb14-540" aria-hidden="true" tabindex="-1"></a><span class="in">  pcor_mlvar &lt;- lapply(1:n_id, function(i){</span></span>
<span id="cb14-541"><a href="#cb14-541" aria-hidden="true" tabindex="-1"></a><span class="in">    mlVAR::getNet(fit_mlvar,</span></span>
<span id="cb14-542"><a href="#cb14-542" aria-hidden="true" tabindex="-1"></a><span class="in">                  subject = i,</span></span>
<span id="cb14-543"><a href="#cb14-543" aria-hidden="true" tabindex="-1"></a><span class="in">                  type = "contemporaneous",</span></span>
<span id="cb14-544"><a href="#cb14-544" aria-hidden="true" tabindex="-1"></a><span class="in">                  nonsig = "show")</span></span>
<span id="cb14-545"><a href="#cb14-545" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-546"><a href="#cb14-546" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-547"><a href="#cb14-547" aria-hidden="true" tabindex="-1"></a><span class="in">  # # Calculate fixed effects adjacency matrix</span></span>
<span id="cb14-548"><a href="#cb14-548" aria-hidden="true" tabindex="-1"></a><span class="in">  adj_mat_beta &lt;- t(ifelse(</span></span>
<span id="cb14-549"><a href="#cb14-549" aria-hidden="true" tabindex="-1"></a><span class="in">    mlVAR::getNet(fit_mlvar,</span></span>
<span id="cb14-550"><a href="#cb14-550" aria-hidden="true" tabindex="-1"></a><span class="in">       type = "temporal",</span></span>
<span id="cb14-551"><a href="#cb14-551" aria-hidden="true" tabindex="-1"></a><span class="in">       nonsig = "hide") != 0, 1, 0))</span></span>
<span id="cb14-552"><a href="#cb14-552" aria-hidden="true" tabindex="-1"></a><span class="in">  adj_mat_pcor &lt;- ifelse(</span></span>
<span id="cb14-553"><a href="#cb14-553" aria-hidden="true" tabindex="-1"></a><span class="in">    mlVAR::getNet(fit_mlvar,</span></span>
<span id="cb14-554"><a href="#cb14-554" aria-hidden="true" tabindex="-1"></a><span class="in">       type = "contemporaneous",</span></span>
<span id="cb14-555"><a href="#cb14-555" aria-hidden="true" tabindex="-1"></a><span class="in">       nonsig = "hide") != 0, 1, 0)</span></span>
<span id="cb14-556"><a href="#cb14-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-557"><a href="#cb14-557" aria-hidden="true" tabindex="-1"></a><span class="in">  # set effects to zero</span></span>
<span id="cb14-558"><a href="#cb14-558" aria-hidden="true" tabindex="-1"></a><span class="in">  beta_mlvar &lt;- lapply(beta_mlvar, function(i){</span></span>
<span id="cb14-559"><a href="#cb14-559" aria-hidden="true" tabindex="-1"></a><span class="in">    i * adj_mat_beta</span></span>
<span id="cb14-560"><a href="#cb14-560" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-561"><a href="#cb14-561" aria-hidden="true" tabindex="-1"></a><span class="in">  pcor_mlvar &lt;- lapply(pcor_mlvar, function(i){</span></span>
<span id="cb14-562"><a href="#cb14-562" aria-hidden="true" tabindex="-1"></a><span class="in">    i * adj_mat_pcor</span></span>
<span id="cb14-563"><a href="#cb14-563" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-564"><a href="#cb14-564" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-565"><a href="#cb14-565" aria-hidden="true" tabindex="-1"></a><span class="in">  # Fit regression</span></span>
<span id="cb14-566"><a href="#cb14-566" aria-hidden="true" tabindex="-1"></a><span class="in">  reg_mlvar_in_strength &lt;- lapply(2:4, function(i) lm(dat$covariate_in_strength[, i] ~ instrength_mlvar_first))</span></span>
<span id="cb14-567"><a href="#cb14-567" aria-hidden="true" tabindex="-1"></a><span class="in">  reg_mlvar_cont_strength &lt;- lapply(2:4, function(i) lm(dat$covariate_cont_strength[, i] ~ strength_mlvar_first))</span></span>
<span id="cb14-568"><a href="#cb14-568" aria-hidden="true" tabindex="-1"></a><span class="in">  reg_mlvar_out_strength &lt;- lapply(2:4, function(i) lm(dat$covariate_out_strength[, i] ~ outstrength_mlvar_first))</span></span>
<span id="cb14-569"><a href="#cb14-569" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-570"><a href="#cb14-570" aria-hidden="true" tabindex="-1"></a><span class="in">  rm(fit_mlvar)</span></span>
<span id="cb14-571"><a href="#cb14-571" aria-hidden="true" tabindex="-1"></a><span class="in">  # </span></span>
<span id="cb14-572"><a href="#cb14-572" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- Bayesian mlVAR</span></span>
<span id="cb14-573"><a href="#cb14-573" aria-hidden="true" tabindex="-1"></a><span class="in">  # indicators for partial correlations</span></span>
<span id="cb14-574"><a href="#cb14-574" aria-hidden="true" tabindex="-1"></a><span class="in">  idx_rho &lt;- upper.tri(matrix(1, n_var, n_var, byrow = F)) |&gt; </span></span>
<span id="cb14-575"><a href="#cb14-575" aria-hidden="true" tabindex="-1"></a><span class="in">      c() |&gt; </span></span>
<span id="cb14-576"><a href="#cb14-576" aria-hidden="true" tabindex="-1"></a><span class="in">      which()</span></span>
<span id="cb14-577"><a href="#cb14-577" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-578"><a href="#cb14-578" aria-hidden="true" tabindex="-1"></a><span class="in">  reg_data &lt;- cbind(</span></span>
<span id="cb14-579"><a href="#cb14-579" aria-hidden="true" tabindex="-1"></a><span class="in">    dat$covariate_in_strength[, 2:4],</span></span>
<span id="cb14-580"><a href="#cb14-580" aria-hidden="true" tabindex="-1"></a><span class="in">    dat$covariate_out_strength[, 2:4],</span></span>
<span id="cb14-581"><a href="#cb14-581" aria-hidden="true" tabindex="-1"></a><span class="in">    dat$covariate_cont_strength[, 2:4]</span></span>
<span id="cb14-582"><a href="#cb14-582" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb14-583"><a href="#cb14-583" aria-hidden="true" tabindex="-1"></a><span class="in">  Y &lt;- df_data |&gt; </span></span>
<span id="cb14-584"><a href="#cb14-584" aria-hidden="true" tabindex="-1"></a><span class="in">    dplyr::select(-"ID") |&gt; </span></span>
<span id="cb14-585"><a href="#cb14-585" aria-hidden="true" tabindex="-1"></a><span class="in">    as.matrix()</span></span>
<span id="cb14-586"><a href="#cb14-586" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-587"><a href="#cb14-587" aria-hidden="true" tabindex="-1"></a><span class="in">  n_tp &lt;- condition$n_tp</span></span>
<span id="cb14-588"><a href="#cb14-588" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-589"><a href="#cb14-589" aria-hidden="true" tabindex="-1"></a><span class="in">  # Prepare stan data</span></span>
<span id="cb14-590"><a href="#cb14-590" aria-hidden="true" tabindex="-1"></a><span class="in">  stan_data &lt;- list(</span></span>
<span id="cb14-591"><a href="#cb14-591" aria-hidden="true" tabindex="-1"></a><span class="in">    K = n_var,</span></span>
<span id="cb14-592"><a href="#cb14-592" aria-hidden="true" tabindex="-1"></a><span class="in">    I = n_id,</span></span>
<span id="cb14-593"><a href="#cb14-593" aria-hidden="true" tabindex="-1"></a><span class="in">    P = 9,   # number of regression outcomes</span></span>
<span id="cb14-594"><a href="#cb14-594" aria-hidden="true" tabindex="-1"></a><span class="in">    N_total = n_id * n_tp,</span></span>
<span id="cb14-595"><a href="#cb14-595" aria-hidden="true" tabindex="-1"></a><span class="in">    n_t = rep(n_tp, n_id),</span></span>
<span id="cb14-596"><a href="#cb14-596" aria-hidden="true" tabindex="-1"></a><span class="in">    n_pc = n_var * (n_var - 1) / 2,</span></span>
<span id="cb14-597"><a href="#cb14-597" aria-hidden="true" tabindex="-1"></a><span class="in">    idx_rho = array(idx_rho, dim = length(idx_rho)),</span></span>
<span id="cb14-598"><a href="#cb14-598" aria-hidden="true" tabindex="-1"></a><span class="in">    Y = Y,</span></span>
<span id="cb14-599"><a href="#cb14-599" aria-hidden="true" tabindex="-1"></a><span class="in">    reg_covariate = reg_data,</span></span>
<span id="cb14-600"><a href="#cb14-600" aria-hidden="true" tabindex="-1"></a><span class="in">    sparsity = 2,</span></span>
<span id="cb14-601"><a href="#cb14-601" aria-hidden="true" tabindex="-1"></a><span class="in">    # should lagged estimates be mean-centered?</span></span>
<span id="cb14-602"><a href="#cb14-602" aria-hidden="true" tabindex="-1"></a><span class="in">    mean_center = 1</span></span>
<span id="cb14-603"><a href="#cb14-603" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb14-604"><a href="#cb14-604" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-605"><a href="#cb14-605" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-606"><a href="#cb14-606" aria-hidden="true" tabindex="-1"></a><span class="in">  fit_bmlvar &lt;- rstan::sampling(</span></span>
<span id="cb14-607"><a href="#cb14-607" aria-hidden="true" tabindex="-1"></a><span class="in">  object = fixed_objects$mlvar_model,</span></span>
<span id="cb14-608"><a href="#cb14-608" aria-hidden="true" tabindex="-1"></a><span class="in">  pars = c("Beta_raw", "Intercepts_raw", "L_Theta", "Rho", "lp__"),</span></span>
<span id="cb14-609"><a href="#cb14-609" aria-hidden="true" tabindex="-1"></a><span class="in">  include = FALSE,</span></span>
<span id="cb14-610"><a href="#cb14-610" aria-hidden="true" tabindex="-1"></a><span class="in">  data = stan_data,</span></span>
<span id="cb14-611"><a href="#cb14-611" aria-hidden="true" tabindex="-1"></a><span class="in">  # seed = 2023,</span></span>
<span id="cb14-612"><a href="#cb14-612" aria-hidden="true" tabindex="-1"></a><span class="in">  chains = 4,</span></span>
<span id="cb14-613"><a href="#cb14-613" aria-hidden="true" tabindex="-1"></a><span class="in">  cores = 1,</span></span>
<span id="cb14-614"><a href="#cb14-614" aria-hidden="true" tabindex="-1"></a><span class="in">  warmup = 500,</span></span>
<span id="cb14-615"><a href="#cb14-615" aria-hidden="true" tabindex="-1"></a><span class="in">  iter = 1000,</span></span>
<span id="cb14-616"><a href="#cb14-616" aria-hidden="true" tabindex="-1"></a><span class="in">  init = 0,</span></span>
<span id="cb14-617"><a href="#cb14-617" aria-hidden="true" tabindex="-1"></a><span class="in">  control = list(adapt_delta = 0.90),</span></span>
<span id="cb14-618"><a href="#cb14-618" aria-hidden="true" tabindex="-1"></a><span class="in">  verbose = FALSE</span></span>
<span id="cb14-619"><a href="#cb14-619" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb14-620"><a href="#cb14-620" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-621"><a href="#cb14-621" aria-hidden="true" tabindex="-1"></a><span class="in">  if(!inherits(fit_bmlvar, "stanfit")){</span></span>
<span id="cb14-622"><a href="#cb14-622" aria-hidden="true" tabindex="-1"></a><span class="in">    stop("BmlVAR model failed.")</span></span>
<span id="cb14-623"><a href="#cb14-623" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-624"><a href="#cb14-624" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-625"><a href="#cb14-625" aria-hidden="true" tabindex="-1"></a><span class="in">  # Transpose beta matrices for later summaries</span></span>
<span id="cb14-626"><a href="#cb14-626" aria-hidden="true" tabindex="-1"></a><span class="in">  # in the DGP, cols represent lagged vars</span></span>
<span id="cb14-627"><a href="#cb14-627" aria-hidden="true" tabindex="-1"></a><span class="in">  # but in BmlVAR, rows represent lagged vars</span></span>
<span id="cb14-628"><a href="#cb14-628" aria-hidden="true" tabindex="-1"></a><span class="in">  ests_bmlvar &lt;- extract_all_estimates(fit_bmlvar,</span></span>
<span id="cb14-629"><a href="#cb14-629" aria-hidden="true" tabindex="-1"></a><span class="in">                                       n_id = n_id, </span></span>
<span id="cb14-630"><a href="#cb14-630" aria-hidden="true" tabindex="-1"></a><span class="in">                                       n_var = n_var, </span></span>
<span id="cb14-631"><a href="#cb14-631" aria-hidden="true" tabindex="-1"></a><span class="in">                                       transpose_beta = FALSE,</span></span>
<span id="cb14-632"><a href="#cb14-632" aria-hidden="true" tabindex="-1"></a><span class="in">                                       pcor_matrix = TRUE)</span></span>
<span id="cb14-633"><a href="#cb14-633" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-634"><a href="#cb14-634" aria-hidden="true" tabindex="-1"></a><span class="in">  # Obtain centralities</span></span>
<span id="cb14-635"><a href="#cb14-635" aria-hidden="true" tabindex="-1"></a><span class="in">  dens_temp_bmlvar &lt;- ests_bmlvar$tempdens_est$median</span></span>
<span id="cb14-636"><a href="#cb14-636" aria-hidden="true" tabindex="-1"></a><span class="in">  dens_cont_bmlvar &lt;- ests_bmlvar$contdens_est$median</span></span>
<span id="cb14-637"><a href="#cb14-637" aria-hidden="true" tabindex="-1"></a><span class="in">  instrength_bmlvar &lt;- ests_bmlvar$instrength_est$median</span></span>
<span id="cb14-638"><a href="#cb14-638" aria-hidden="true" tabindex="-1"></a><span class="in">  outstrength_bmlvar &lt;- ests_bmlvar$outstrength_est$median</span></span>
<span id="cb14-639"><a href="#cb14-639" aria-hidden="true" tabindex="-1"></a><span class="in">  strength_bmlvar &lt;- ests_bmlvar$pcor_centrality_est$median</span></span>
<span id="cb14-640"><a href="#cb14-640" aria-hidden="true" tabindex="-1"></a><span class="in">  outstrength_bmlvar_first &lt;- sapply(ests_bmlvar$outstrength_est$median, function(x) unname(x[1]))</span></span>
<span id="cb14-641"><a href="#cb14-641" aria-hidden="true" tabindex="-1"></a><span class="in">  strength_bmlvar_first &lt;- sapply(ests_bmlvar$pcor_centrality_est$median, function(x) unname(x[1]))</span></span>
<span id="cb14-642"><a href="#cb14-642" aria-hidden="true" tabindex="-1"></a><span class="in">  instrength_bmlvar_first &lt;- sapply(ests_bmlvar$instrength_est$median, function(x) unname(x[1]))</span></span>
<span id="cb14-643"><a href="#cb14-643" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-644"><a href="#cb14-644" aria-hidden="true" tabindex="-1"></a><span class="in">  # Obtain regression coefficients</span></span>
<span id="cb14-645"><a href="#cb14-645" aria-hidden="true" tabindex="-1"></a><span class="in">  reg_bmlvar &lt;- list(</span></span>
<span id="cb14-646"><a href="#cb14-646" aria-hidden="true" tabindex="-1"></a><span class="in">    regression_intercept = ests_bmlvar$regression_intercept_est, </span></span>
<span id="cb14-647"><a href="#cb14-647" aria-hidden="true" tabindex="-1"></a><span class="in">    regression_slope = ests_bmlvar$regression_slope_est)</span></span>
<span id="cb14-648"><a href="#cb14-648" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-649"><a href="#cb14-649" aria-hidden="true" tabindex="-1"></a><span class="in">  # save summary, but not the c_summary of individual chains</span></span>
<span id="cb14-650"><a href="#cb14-650" aria-hidden="true" tabindex="-1"></a><span class="in">  summary_bmlvar &lt;- rstan::summary(fit_bmlvar,</span></span>
<span id="cb14-651"><a href="#cb14-651" aria-hidden="true" tabindex="-1"></a><span class="in">                                   pars = c("Beta",</span></span>
<span id="cb14-652"><a href="#cb14-652" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "mu_Beta",</span></span>
<span id="cb14-653"><a href="#cb14-653" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "sigma_Beta",</span></span>
<span id="cb14-654"><a href="#cb14-654" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "mu_Intercepts",</span></span>
<span id="cb14-655"><a href="#cb14-655" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "sigma_Intercepts",</span></span>
<span id="cb14-656"><a href="#cb14-656" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "reg_intercept",</span></span>
<span id="cb14-657"><a href="#cb14-657" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "reg_slope_density",</span></span>
<span id="cb14-658"><a href="#cb14-658" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "sigma_residual",</span></span>
<span id="cb14-659"><a href="#cb14-659" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "Intercepts",</span></span>
<span id="cb14-660"><a href="#cb14-660" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "Sigma",</span></span>
<span id="cb14-661"><a href="#cb14-661" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "Rho_vec",</span></span>
<span id="cb14-662"><a href="#cb14-662" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "Beta_out_strength",</span></span>
<span id="cb14-663"><a href="#cb14-663" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "Beta_in_strength",</span></span>
<span id="cb14-664"><a href="#cb14-664" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "Rho_strength",</span></span>
<span id="cb14-665"><a href="#cb14-665" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "mu_regression",</span></span>
<span id="cb14-666"><a href="#cb14-666" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "reg_slope_density_z",</span></span>
<span id="cb14-667"><a href="#cb14-667" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "reg_intercept_z",</span></span>
<span id="cb14-668"><a href="#cb14-668" aria-hidden="true" tabindex="-1"></a><span class="in">                                            "theta_sd"))$summary</span></span>
<span id="cb14-669"><a href="#cb14-669" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-670"><a href="#cb14-670" aria-hidden="true" tabindex="-1"></a><span class="in">  # remove some posterior descriptives</span></span>
<span id="cb14-671"><a href="#cb14-671" aria-hidden="true" tabindex="-1"></a><span class="in">  summary_bmlvar &lt;- summary_bmlvar[, !(colnames(summary_bmlvar) %in% c("25%", "75%"))]</span></span>
<span id="cb14-672"><a href="#cb14-672" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-673"><a href="#cb14-673" aria-hidden="true" tabindex="-1"></a><span class="in">  # convergence diagnostics</span></span>
<span id="cb14-674"><a href="#cb14-674" aria-hidden="true" tabindex="-1"></a><span class="in">  rhat_bmlvar_tmp &lt;- summary_bmlvar |&gt; as.data.frame() |&gt; pull(Rhat)</span></span>
<span id="cb14-675"><a href="#cb14-675" aria-hidden="true" tabindex="-1"></a><span class="in">  rhat_bmlvar_tmp &lt;- rhat_bmlvar_tmp[!is.nan(rhat_bmlvar_tmp)]</span></span>
<span id="cb14-676"><a href="#cb14-676" aria-hidden="true" tabindex="-1"></a><span class="in">  rhat_bmlvar_mean &lt;- mean(rhat_bmlvar_tmp, na.rm = TRUE)</span></span>
<span id="cb14-677"><a href="#cb14-677" aria-hidden="true" tabindex="-1"></a><span class="in">  rhat_bmlvar_11 &lt;- sum(rhat_bmlvar_tmp &gt; 1.1)/length(rhat_bmlvar_tmp)</span></span>
<span id="cb14-678"><a href="#cb14-678" aria-hidden="true" tabindex="-1"></a><span class="in">  divtrans_bmlvar &lt;- rstan::get_num_divergent(fit_bmlvar)</span></span>
<span id="cb14-679"><a href="#cb14-679" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-680"><a href="#cb14-680" aria-hidden="true" tabindex="-1"></a><span class="in">  rm(fit_bmlvar)</span></span>
<span id="cb14-681"><a href="#cb14-681" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-682"><a href="#cb14-682" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- Return Results</span></span>
<span id="cb14-683"><a href="#cb14-683" aria-hidden="true" tabindex="-1"></a><span class="in">  # Also return true centralities for comparison later</span></span>
<span id="cb14-684"><a href="#cb14-684" aria-hidden="true" tabindex="-1"></a><span class="in">  ret_results &lt;- list(</span></span>
<span id="cb14-685"><a href="#cb14-685" aria-hidden="true" tabindex="-1"></a><span class="in">    gvar = list(</span></span>
<span id="cb14-686"><a href="#cb14-686" aria-hidden="true" tabindex="-1"></a><span class="in">      fit_gvar = list(</span></span>
<span id="cb14-687"><a href="#cb14-687" aria-hidden="true" tabindex="-1"></a><span class="in">        beta = beta_gvar,</span></span>
<span id="cb14-688"><a href="#cb14-688" aria-hidden="true" tabindex="-1"></a><span class="in">        pcor = pcor_gvar),</span></span>
<span id="cb14-689"><a href="#cb14-689" aria-hidden="true" tabindex="-1"></a><span class="in">      dens_temp = dens_temp_gvar,</span></span>
<span id="cb14-690"><a href="#cb14-690" aria-hidden="true" tabindex="-1"></a><span class="in">      dens_cont = dens_cont_gvar,</span></span>
<span id="cb14-691"><a href="#cb14-691" aria-hidden="true" tabindex="-1"></a><span class="in">      outstrength = outstrength_gvar,</span></span>
<span id="cb14-692"><a href="#cb14-692" aria-hidden="true" tabindex="-1"></a><span class="in">      strength = strength_gvar,</span></span>
<span id="cb14-693"><a href="#cb14-693" aria-hidden="true" tabindex="-1"></a><span class="in">      instrength = instrength_gvar,</span></span>
<span id="cb14-694"><a href="#cb14-694" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_instrength = reg_gvar_in_strength,</span></span>
<span id="cb14-695"><a href="#cb14-695" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_strength = reg_gvar_cont_strength,</span></span>
<span id="cb14-696"><a href="#cb14-696" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_outstrength = reg_gvar_out_strength</span></span>
<span id="cb14-697"><a href="#cb14-697" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb14-698"><a href="#cb14-698" aria-hidden="true" tabindex="-1"></a><span class="in">    gimme = list(</span></span>
<span id="cb14-699"><a href="#cb14-699" aria-hidden="true" tabindex="-1"></a><span class="in">      fit_gimme = list(</span></span>
<span id="cb14-700"><a href="#cb14-700" aria-hidden="true" tabindex="-1"></a><span class="in">        beta = beta_gimme,</span></span>
<span id="cb14-701"><a href="#cb14-701" aria-hidden="true" tabindex="-1"></a><span class="in">        pcor = pcor_gimme</span></span>
<span id="cb14-702"><a href="#cb14-702" aria-hidden="true" tabindex="-1"></a><span class="in">      ),</span></span>
<span id="cb14-703"><a href="#cb14-703" aria-hidden="true" tabindex="-1"></a><span class="in">      dens_temp = dens_temp_gimme,</span></span>
<span id="cb14-704"><a href="#cb14-704" aria-hidden="true" tabindex="-1"></a><span class="in">      dens_cont = dens_cont_gimme,</span></span>
<span id="cb14-705"><a href="#cb14-705" aria-hidden="true" tabindex="-1"></a><span class="in">      outstrength = outstrength_gimme,</span></span>
<span id="cb14-706"><a href="#cb14-706" aria-hidden="true" tabindex="-1"></a><span class="in">      strength = strength_gimme,</span></span>
<span id="cb14-707"><a href="#cb14-707" aria-hidden="true" tabindex="-1"></a><span class="in">      instrength = instrength_gimme,</span></span>
<span id="cb14-708"><a href="#cb14-708" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_instrength = reg_gimme_in_strength,</span></span>
<span id="cb14-709"><a href="#cb14-709" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_strength = reg_gimme_cont_strength,</span></span>
<span id="cb14-710"><a href="#cb14-710" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_outstrength = reg_gimme_out_strength</span></span>
<span id="cb14-711"><a href="#cb14-711" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb14-712"><a href="#cb14-712" aria-hidden="true" tabindex="-1"></a><span class="in">    mlvar = list(</span></span>
<span id="cb14-713"><a href="#cb14-713" aria-hidden="true" tabindex="-1"></a><span class="in">      fit_mlvar = list(</span></span>
<span id="cb14-714"><a href="#cb14-714" aria-hidden="true" tabindex="-1"></a><span class="in">        beta = beta_mlvar,</span></span>
<span id="cb14-715"><a href="#cb14-715" aria-hidden="true" tabindex="-1"></a><span class="in">        pcor = pcor_mlvar),</span></span>
<span id="cb14-716"><a href="#cb14-716" aria-hidden="true" tabindex="-1"></a><span class="in">      dens_temp = dens_temp_mlvar,</span></span>
<span id="cb14-717"><a href="#cb14-717" aria-hidden="true" tabindex="-1"></a><span class="in">      dens_cont = dens_cont_mlvar,</span></span>
<span id="cb14-718"><a href="#cb14-718" aria-hidden="true" tabindex="-1"></a><span class="in">      outstrength = outstrength_mlvar,</span></span>
<span id="cb14-719"><a href="#cb14-719" aria-hidden="true" tabindex="-1"></a><span class="in">      strength = strength_mlvar,</span></span>
<span id="cb14-720"><a href="#cb14-720" aria-hidden="true" tabindex="-1"></a><span class="in">      instrength = instrength_mlvar,</span></span>
<span id="cb14-721"><a href="#cb14-721" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_instrength = reg_mlvar_in_strength,</span></span>
<span id="cb14-722"><a href="#cb14-722" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_strength = reg_mlvar_cont_strength,</span></span>
<span id="cb14-723"><a href="#cb14-723" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_outstrength = reg_mlvar_out_strength</span></span>
<span id="cb14-724"><a href="#cb14-724" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb14-725"><a href="#cb14-725" aria-hidden="true" tabindex="-1"></a><span class="in">    bmlvar = list(</span></span>
<span id="cb14-726"><a href="#cb14-726" aria-hidden="true" tabindex="-1"></a><span class="in">      fit_bmlvar = list(</span></span>
<span id="cb14-727"><a href="#cb14-727" aria-hidden="true" tabindex="-1"></a><span class="in">        beta = ests_bmlvar$beta_est$median,</span></span>
<span id="cb14-728"><a href="#cb14-728" aria-hidden="true" tabindex="-1"></a><span class="in">        pcor = ests_bmlvar$pcor_est$median</span></span>
<span id="cb14-729"><a href="#cb14-729" aria-hidden="true" tabindex="-1"></a><span class="in">      ),</span></span>
<span id="cb14-730"><a href="#cb14-730" aria-hidden="true" tabindex="-1"></a><span class="in">      dens_temp = dens_temp_bmlvar,</span></span>
<span id="cb14-731"><a href="#cb14-731" aria-hidden="true" tabindex="-1"></a><span class="in">      dens_cont = dens_cont_bmlvar,</span></span>
<span id="cb14-732"><a href="#cb14-732" aria-hidden="true" tabindex="-1"></a><span class="in">      outstrength = outstrength_bmlvar,</span></span>
<span id="cb14-733"><a href="#cb14-733" aria-hidden="true" tabindex="-1"></a><span class="in">      strength = strength_bmlvar,</span></span>
<span id="cb14-734"><a href="#cb14-734" aria-hidden="true" tabindex="-1"></a><span class="in">      instrength = instrength_bmlvar,</span></span>
<span id="cb14-735"><a href="#cb14-735" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_bmlvar = reg_bmlvar,</span></span>
<span id="cb14-736"><a href="#cb14-736" aria-hidden="true" tabindex="-1"></a><span class="in">      ests_bmlvar = ests_bmlvar,</span></span>
<span id="cb14-737"><a href="#cb14-737" aria-hidden="true" tabindex="-1"></a><span class="in">      summary_bmlvar = summary_bmlvar,</span></span>
<span id="cb14-738"><a href="#cb14-738" aria-hidden="true" tabindex="-1"></a><span class="in">      rhat_bmlvar_mean = rhat_bmlvar_mean,</span></span>
<span id="cb14-739"><a href="#cb14-739" aria-hidden="true" tabindex="-1"></a><span class="in">      rhat_bmlvar_11 = rhat_bmlvar_11,</span></span>
<span id="cb14-740"><a href="#cb14-740" aria-hidden="true" tabindex="-1"></a><span class="in">      divtrans_bmlvar = divtrans_bmlvar</span></span>
<span id="cb14-741"><a href="#cb14-741" aria-hidden="true" tabindex="-1"></a><span class="in">    ),</span></span>
<span id="cb14-742"><a href="#cb14-742" aria-hidden="true" tabindex="-1"></a><span class="in">    true_cent = dat$true_cent,</span></span>
<span id="cb14-743"><a href="#cb14-743" aria-hidden="true" tabindex="-1"></a><span class="in">    covariate_cont_strength = dat$covariate_cont_strength,</span></span>
<span id="cb14-744"><a href="#cb14-744" aria-hidden="true" tabindex="-1"></a><span class="in">    covariate_in_strength = dat$covariate_in_strength,</span></span>
<span id="cb14-745"><a href="#cb14-745" aria-hidden="true" tabindex="-1"></a><span class="in">    covariate_out_strength = dat$covariate_out_strength,</span></span>
<span id="cb14-746"><a href="#cb14-746" aria-hidden="true" tabindex="-1"></a><span class="in">    data = dat$data,</span></span>
<span id="cb14-747"><a href="#cb14-747" aria-hidden="true" tabindex="-1"></a><span class="in">    beta = dat$beta,</span></span>
<span id="cb14-748"><a href="#cb14-748" aria-hidden="true" tabindex="-1"></a><span class="in">    kappa = dat$kappa,</span></span>
<span id="cb14-749"><a href="#cb14-749" aria-hidden="true" tabindex="-1"></a><span class="in">    pcor = dat$pcor,</span></span>
<span id="cb14-750"><a href="#cb14-750" aria-hidden="true" tabindex="-1"></a><span class="in">    true_cor_strength = dat$cor_strength,</span></span>
<span id="cb14-751"><a href="#cb14-751" aria-hidden="true" tabindex="-1"></a><span class="in">    true_cor_instrength = dat$cor_instrength,</span></span>
<span id="cb14-752"><a href="#cb14-752" aria-hidden="true" tabindex="-1"></a><span class="in">    true_cor_outstrength = dat$cor_outstrength</span></span>
<span id="cb14-753"><a href="#cb14-753" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb14-754"><a href="#cb14-754" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-755"><a href="#cb14-755" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-756"><a href="#cb14-756" aria-hidden="true" tabindex="-1"></a><span class="in">  return(ret_results)</span></span>
<span id="cb14-757"><a href="#cb14-757" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-758"><a href="#cb14-758" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb14-759"><a href="#cb14-759" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-760"><a href="#cb14-760" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-761"><a href="#cb14-761" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-762"><a href="#cb14-762" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-763"><a href="#cb14-763" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-764"><a href="#cb14-764" aria-hidden="true" tabindex="-1"></a><span class="fu"># Summary</span></span>
<span id="cb14-765"><a href="#cb14-765" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-766"><a href="#cb14-766" aria-hidden="true" tabindex="-1"></a>To note about data structure:</span>
<span id="cb14-767"><a href="#cb14-767" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>GVAR fit: cols as lagged, also in the DGP</span>
<span id="cb14-768"><a href="#cb14-768" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>mlVAR fit: rows as lagged, cols as contemp --&gt; now transposed</span>
<span id="cb14-769"><a href="#cb14-769" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>gimme fit: cols as lagged</span>
<span id="cb14-770"><a href="#cb14-770" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>bmlVAR fit: different data structure, but uses rows as lagged</span>
<span id="cb14-771"><a href="#cb14-771" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-772"><a href="#cb14-772" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-773"><a href="#cb14-773" aria-hidden="true" tabindex="-1"></a>However, with the new sim function, we do not transpose anymore! We simulate from <span class="in">`graphicalVARsim`</span>, so in the true DGP, columns represent the nodes of origin. </span>
<span id="cb14-774"><a href="#cb14-774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-775"><a href="#cb14-775" aria-hidden="true" tabindex="-1"></a><span class="in">```{r summarize}</span></span>
<span id="cb14-776"><a href="#cb14-776" aria-hidden="true" tabindex="-1"></a><span class="in">sim_summarise &lt;- function(condition, results, fixed_objects = NULL){</span></span>
<span id="cb14-777"><a href="#cb14-777" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-778"><a href="#cb14-778" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- Preparation</span></span>
<span id="cb14-779"><a href="#cb14-779" aria-hidden="true" tabindex="-1"></a><span class="in">  SimDesign::Attach(fixed_objects)</span></span>
<span id="cb14-780"><a href="#cb14-780" aria-hidden="true" tabindex="-1"></a><span class="in">  ret &lt;- list()</span></span>
<span id="cb14-781"><a href="#cb14-781" aria-hidden="true" tabindex="-1"></a><span class="in">  n_id &lt;- condition$n_id</span></span>
<span id="cb14-782"><a href="#cb14-782" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-783"><a href="#cb14-783" aria-hidden="true" tabindex="-1"></a><span class="in">  # Global settings</span></span>
<span id="cb14-784"><a href="#cb14-784" aria-hidden="true" tabindex="-1"></a><span class="in">  use_lm_beta &lt;- FALSE</span></span>
<span id="cb14-785"><a href="#cb14-785" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-786"><a href="#cb14-786" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-787"><a href="#cb14-787" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- Parameter recovery  </span></span>
<span id="cb14-788"><a href="#cb14-788" aria-hidden="true" tabindex="-1"></a><span class="in">  # IMPORTANT: Keep in mind structure of sim object (rows vs. cols)</span></span>
<span id="cb14-789"><a href="#cb14-789" aria-hidden="true" tabindex="-1"></a><span class="in">  #-- RMSE</span></span>
<span id="cb14-790"><a href="#cb14-790" aria-hidden="true" tabindex="-1"></a><span class="in">  summary_calc &lt;- function(results, method, fit, measure, func) {</span></span>
<span id="cb14-791"><a href="#cb14-791" aria-hidden="true" tabindex="-1"></a><span class="in">  sapply(seq_along(results), function(i){</span></span>
<span id="cb14-792"><a href="#cb14-792" aria-hidden="true" tabindex="-1"></a><span class="in">    if(is.null(results[[i]][[method]][[fit]])){</span></span>
<span id="cb14-793"><a href="#cb14-793" aria-hidden="true" tabindex="-1"></a><span class="in">      return(NA)</span></span>
<span id="cb14-794"><a href="#cb14-794" aria-hidden="true" tabindex="-1"></a><span class="in">    } </span></span>
<span id="cb14-795"><a href="#cb14-795" aria-hidden="true" tabindex="-1"></a><span class="in">    else{</span></span>
<span id="cb14-796"><a href="#cb14-796" aria-hidden="true" tabindex="-1"></a><span class="in">      unlist(func(results[[i]][[method]][[fit]][[measure]], results[[i]][[measure]]))</span></span>
<span id="cb14-797"><a href="#cb14-797" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb14-798"><a href="#cb14-798" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-799"><a href="#cb14-799" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb14-800"><a href="#cb14-800" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-801"><a href="#cb14-801" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-802"><a href="#cb14-802" aria-hidden="true" tabindex="-1"></a><span class="in">  methods &lt;- c("gvar", "gimme", "mlvar", "bmlvar")</span></span>
<span id="cb14-803"><a href="#cb14-803" aria-hidden="true" tabindex="-1"></a><span class="in">  measures &lt;- c("beta", "pcor")</span></span>
<span id="cb14-804"><a href="#cb14-804" aria-hidden="true" tabindex="-1"></a><span class="in">  funcs &lt;- list("rmse" = rmse_mean_list, </span></span>
<span id="cb14-805"><a href="#cb14-805" aria-hidden="true" tabindex="-1"></a><span class="in">                "mse" = mse_mean_list, </span></span>
<span id="cb14-806"><a href="#cb14-806" aria-hidden="true" tabindex="-1"></a><span class="in">                "bias" = bias_mean_list)</span></span>
<span id="cb14-807"><a href="#cb14-807" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-808"><a href="#cb14-808" aria-hidden="true" tabindex="-1"></a><span class="in">  # Loop to get summaries and save them into the ret list</span></span>
<span id="cb14-809"><a href="#cb14-809" aria-hidden="true" tabindex="-1"></a><span class="in">  rmse_list &lt;- list()</span></span>
<span id="cb14-810"><a href="#cb14-810" aria-hidden="true" tabindex="-1"></a><span class="in">  mse_list &lt;- list()</span></span>
<span id="cb14-811"><a href="#cb14-811" aria-hidden="true" tabindex="-1"></a><span class="in">  for (method in methods) {</span></span>
<span id="cb14-812"><a href="#cb14-812" aria-hidden="true" tabindex="-1"></a><span class="in">      for (measure in measures) {</span></span>
<span id="cb14-813"><a href="#cb14-813" aria-hidden="true" tabindex="-1"></a><span class="in">        for (func_name in names(funcs)) {</span></span>
<span id="cb14-814"><a href="#cb14-814" aria-hidden="true" tabindex="-1"></a><span class="in">          result_name &lt;- paste(func_name, measure, method, sep = "_")</span></span>
<span id="cb14-815"><a href="#cb14-815" aria-hidden="true" tabindex="-1"></a><span class="in">          calc_list &lt;- summary_calc(</span></span>
<span id="cb14-816"><a href="#cb14-816" aria-hidden="true" tabindex="-1"></a><span class="in">            results, </span></span>
<span id="cb14-817"><a href="#cb14-817" aria-hidden="true" tabindex="-1"></a><span class="in">            method, </span></span>
<span id="cb14-818"><a href="#cb14-818" aria-hidden="true" tabindex="-1"></a><span class="in">            paste0("fit_", method), </span></span>
<span id="cb14-819"><a href="#cb14-819" aria-hidden="true" tabindex="-1"></a><span class="in">            measure, </span></span>
<span id="cb14-820"><a href="#cb14-820" aria-hidden="true" tabindex="-1"></a><span class="in">            funcs[[func_name]])</span></span>
<span id="cb14-821"><a href="#cb14-821" aria-hidden="true" tabindex="-1"></a><span class="in">          mean_tmp &lt;- colMeans(apply(as.matrix(calc_list), c(1,2), as.numeric))</span></span>
<span id="cb14-822"><a href="#cb14-822" aria-hidden="true" tabindex="-1"></a><span class="in">          ret[[paste0(result_name, "_mean")]] &lt;- mean(mean_tmp)</span></span>
<span id="cb14-823"><a href="#cb14-823" aria-hidden="true" tabindex="-1"></a><span class="in">          if(func_name == "rmse"){</span></span>
<span id="cb14-824"><a href="#cb14-824" aria-hidden="true" tabindex="-1"></a><span class="in">            # calculate MSE, needed for MCSE of RMSE</span></span>
<span id="cb14-825"><a href="#cb14-825" aria-hidden="true" tabindex="-1"></a><span class="in">            mse_tmp &lt;- summary_calc(</span></span>
<span id="cb14-826"><a href="#cb14-826" aria-hidden="true" tabindex="-1"></a><span class="in">            results, </span></span>
<span id="cb14-827"><a href="#cb14-827" aria-hidden="true" tabindex="-1"></a><span class="in">            method, </span></span>
<span id="cb14-828"><a href="#cb14-828" aria-hidden="true" tabindex="-1"></a><span class="in">            paste0("fit_", method), </span></span>
<span id="cb14-829"><a href="#cb14-829" aria-hidden="true" tabindex="-1"></a><span class="in">            measure, </span></span>
<span id="cb14-830"><a href="#cb14-830" aria-hidden="true" tabindex="-1"></a><span class="in">            funcs[["mse"]])</span></span>
<span id="cb14-831"><a href="#cb14-831" aria-hidden="true" tabindex="-1"></a><span class="in">            mse_mean_tmp &lt;- mean(colMeans(apply(as.matrix(mse_tmp), c(1,2), as.numeric)))</span></span>
<span id="cb14-832"><a href="#cb14-832" aria-hidden="true" tabindex="-1"></a><span class="in">            ret[[paste0(result_name, "_mcse")]] &lt;- sqrt(stats::var(mean_tmp) / </span></span>
<span id="cb14-833"><a href="#cb14-833" aria-hidden="true" tabindex="-1"></a><span class="in">                                                          (4 * n_rep * mse_mean_tmp))</span></span>
<span id="cb14-834"><a href="#cb14-834" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb14-835"><a href="#cb14-835" aria-hidden="true" tabindex="-1"></a><span class="in">          else if(func_name == "mse"){</span></span>
<span id="cb14-836"><a href="#cb14-836" aria-hidden="true" tabindex="-1"></a><span class="in">            ret[[paste0(result_name, "_mcse")]] &lt;- sqrt(stats::var(mean_tmp) / n_rep)</span></span>
<span id="cb14-837"><a href="#cb14-837" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb14-838"><a href="#cb14-838" aria-hidden="true" tabindex="-1"></a><span class="in">          else if(func_name == "bias"){</span></span>
<span id="cb14-839"><a href="#cb14-839" aria-hidden="true" tabindex="-1"></a><span class="in">            ret[[paste0(result_name, "_mcse")]] &lt;- sqrt(stats::var(mean_tmp) / n_rep)</span></span>
<span id="cb14-840"><a href="#cb14-840" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb14-841"><a href="#cb14-841" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb14-842"><a href="#cb14-842" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb14-843"><a href="#cb14-843" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-844"><a href="#cb14-844" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-845"><a href="#cb14-845" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-846"><a href="#cb14-846" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb14-847"><a href="#cb14-847" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- Centrality</span></span>
<span id="cb14-848"><a href="#cb14-848" aria-hidden="true" tabindex="-1"></a><span class="in">  #-- Rank-Order between individuals</span></span>
<span id="cb14-849"><a href="#cb14-849" aria-hidden="true" tabindex="-1"></a><span class="in">  calc_correlation &lt;- function(results, method, measure) {</span></span>
<span id="cb14-850"><a href="#cb14-850" aria-hidden="true" tabindex="-1"></a><span class="in">  sapply(seq_along(results), function(i){</span></span>
<span id="cb14-851"><a href="#cb14-851" aria-hidden="true" tabindex="-1"></a><span class="in">    if(is.null(results[[i]][[method]][[paste0("fit_", method)]])){</span></span>
<span id="cb14-852"><a href="#cb14-852" aria-hidden="true" tabindex="-1"></a><span class="in">      return(NA)</span></span>
<span id="cb14-853"><a href="#cb14-853" aria-hidden="true" tabindex="-1"></a><span class="in">    } </span></span>
<span id="cb14-854"><a href="#cb14-854" aria-hidden="true" tabindex="-1"></a><span class="in">    else{</span></span>
<span id="cb14-855"><a href="#cb14-855" aria-hidden="true" tabindex="-1"></a><span class="in">      stats::cor(results[[i]][[method]][[paste0("dens_", measure)]], </span></span>
<span id="cb14-856"><a href="#cb14-856" aria-hidden="true" tabindex="-1"></a><span class="in">                 unlist(results[[i]]$true_cent[[paste0("dens_", measure)]]), </span></span>
<span id="cb14-857"><a href="#cb14-857" aria-hidden="true" tabindex="-1"></a><span class="in">                 method = "spearman")</span></span>
<span id="cb14-858"><a href="#cb14-858" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb14-859"><a href="#cb14-859" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-860"><a href="#cb14-860" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-861"><a href="#cb14-861" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-862"><a href="#cb14-862" aria-hidden="true" tabindex="-1"></a><span class="in">  # Bootstrap the MCSE for the rank correlation</span></span>
<span id="cb14-863"><a href="#cb14-863" aria-hidden="true" tabindex="-1"></a><span class="in">  bootstrap_rankcor &lt;- function(data, n_boot){</span></span>
<span id="cb14-864"><a href="#cb14-864" aria-hidden="true" tabindex="-1"></a><span class="in">    bootstrap_res &lt;- vector("numeric", n_boot)</span></span>
<span id="cb14-865"><a href="#cb14-865" aria-hidden="true" tabindex="-1"></a><span class="in">    for(i in 1:n_boot){</span></span>
<span id="cb14-866"><a href="#cb14-866" aria-hidden="true" tabindex="-1"></a><span class="in">      ind &lt;- sample(1:n_boot, replace = TRUE)</span></span>
<span id="cb14-867"><a href="#cb14-867" aria-hidden="true" tabindex="-1"></a><span class="in">      bootstrap_res[i] &lt;- mean(data[ind], na.rm = TRUE)</span></span>
<span id="cb14-868"><a href="#cb14-868" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb14-869"><a href="#cb14-869" aria-hidden="true" tabindex="-1"></a><span class="in">      sd(bootstrap_res, na.rm = TRUE)</span></span>
<span id="cb14-870"><a href="#cb14-870" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-871"><a href="#cb14-871" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-872"><a href="#cb14-872" aria-hidden="true" tabindex="-1"></a><span class="in">  measures &lt;- c("temp", "cont")</span></span>
<span id="cb14-873"><a href="#cb14-873" aria-hidden="true" tabindex="-1"></a><span class="in">  for (method in methods) {</span></span>
<span id="cb14-874"><a href="#cb14-874" aria-hidden="true" tabindex="-1"></a><span class="in">    for (measure in measures) {</span></span>
<span id="cb14-875"><a href="#cb14-875" aria-hidden="true" tabindex="-1"></a><span class="in">      result_name &lt;- paste("rankcor", measure, method, sep = "_")</span></span>
<span id="cb14-876"><a href="#cb14-876" aria-hidden="true" tabindex="-1"></a><span class="in">      calc_list &lt;- calc_correlation(</span></span>
<span id="cb14-877"><a href="#cb14-877" aria-hidden="true" tabindex="-1"></a><span class="in">        results = results,</span></span>
<span id="cb14-878"><a href="#cb14-878" aria-hidden="true" tabindex="-1"></a><span class="in">        method = method,</span></span>
<span id="cb14-879"><a href="#cb14-879" aria-hidden="true" tabindex="-1"></a><span class="in">        measure = measure)</span></span>
<span id="cb14-880"><a href="#cb14-880" aria-hidden="true" tabindex="-1"></a><span class="in">      mean_tmp &lt;- mean(calc_list)</span></span>
<span id="cb14-881"><a href="#cb14-881" aria-hidden="true" tabindex="-1"></a><span class="in">      sd_tmp &lt;- bootstrap_rankcor(calc_list, 1000)</span></span>
<span id="cb14-882"><a href="#cb14-882" aria-hidden="true" tabindex="-1"></a><span class="in">      ret[[paste0(result_name, "_mean")]] &lt;- mean_tmp</span></span>
<span id="cb14-883"><a href="#cb14-883" aria-hidden="true" tabindex="-1"></a><span class="in">      ret[[paste0(result_name, "_mcse")]] &lt;- sd_tmp</span></span>
<span id="cb14-884"><a href="#cb14-884" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb14-885"><a href="#cb14-885" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-886"><a href="#cb14-886" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-887"><a href="#cb14-887" aria-hidden="true" tabindex="-1"></a><span class="in">    </span></span>
<span id="cb14-888"><a href="#cb14-888" aria-hidden="true" tabindex="-1"></a><span class="in">  #-- Most central within individuals</span></span>
<span id="cb14-889"><a href="#cb14-889" aria-hidden="true" tabindex="-1"></a><span class="in">  calc_most_cent_ident &lt;- function(results, method, measure) {</span></span>
<span id="cb14-890"><a href="#cb14-890" aria-hidden="true" tabindex="-1"></a><span class="in">    sapply(seq_along(results), function(i){</span></span>
<span id="cb14-891"><a href="#cb14-891" aria-hidden="true" tabindex="-1"></a><span class="in">      if(is.null(results[[i]][[method]][paste0("fit_", method)])){</span></span>
<span id="cb14-892"><a href="#cb14-892" aria-hidden="true" tabindex="-1"></a><span class="in">        return(NA)</span></span>
<span id="cb14-893"><a href="#cb14-893" aria-hidden="true" tabindex="-1"></a><span class="in">      } </span></span>
<span id="cb14-894"><a href="#cb14-894" aria-hidden="true" tabindex="-1"></a><span class="in">      else{</span></span>
<span id="cb14-895"><a href="#cb14-895" aria-hidden="true" tabindex="-1"></a><span class="in">        mci &lt;- most_cent_ident(results[[i]][[method]][[measure]], </span></span>
<span id="cb14-896"><a href="#cb14-896" aria-hidden="true" tabindex="-1"></a><span class="in">                              results[[i]]$true_cent[[measure]])</span></span>
<span id="cb14-897"><a href="#cb14-897" aria-hidden="true" tabindex="-1"></a><span class="in">        # check if calculation worked to prevent error</span></span>
<span id="cb14-898"><a href="#cb14-898" aria-hidden="true" tabindex="-1"></a><span class="in">        if(!is.vector(mci) |is.null(mci) | is.null(unlist(mci))){</span></span>
<span id="cb14-899"><a href="#cb14-899" aria-hidden="true" tabindex="-1"></a><span class="in">          return(NA)</span></span>
<span id="cb14-900"><a href="#cb14-900" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb14-901"><a href="#cb14-901" aria-hidden="true" tabindex="-1"></a><span class="in">        colSums(matrix(unlist(mci), </span></span>
<span id="cb14-902"><a href="#cb14-902" aria-hidden="true" tabindex="-1"></a><span class="in">                      nrow = n_id, </span></span>
<span id="cb14-903"><a href="#cb14-903" aria-hidden="true" tabindex="-1"></a><span class="in">                      byrow = FALSE))/n_id</span></span>
<span id="cb14-904"><a href="#cb14-904" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb14-905"><a href="#cb14-905" aria-hidden="true" tabindex="-1"></a><span class="in">    })</span></span>
<span id="cb14-906"><a href="#cb14-906" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-907"><a href="#cb14-907" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-908"><a href="#cb14-908" aria-hidden="true" tabindex="-1"></a><span class="in">  measures &lt;- c("instrength", "outstrength", "strength")</span></span>
<span id="cb14-909"><a href="#cb14-909" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-910"><a href="#cb14-910" aria-hidden="true" tabindex="-1"></a><span class="in">  for(method in methods){</span></span>
<span id="cb14-911"><a href="#cb14-911" aria-hidden="true" tabindex="-1"></a><span class="in">    for(measure in measures){</span></span>
<span id="cb14-912"><a href="#cb14-912" aria-hidden="true" tabindex="-1"></a><span class="in">      calc_list &lt;- calc_most_cent_ident(</span></span>
<span id="cb14-913"><a href="#cb14-913" aria-hidden="true" tabindex="-1"></a><span class="in">        results = results, </span></span>
<span id="cb14-914"><a href="#cb14-914" aria-hidden="true" tabindex="-1"></a><span class="in">        method = method, </span></span>
<span id="cb14-915"><a href="#cb14-915" aria-hidden="true" tabindex="-1"></a><span class="in">        measure = measure)</span></span>
<span id="cb14-916"><a href="#cb14-916" aria-hidden="true" tabindex="-1"></a><span class="in">        mean_tmp &lt;- mean(calc_list, na.rm = TRUE) </span></span>
<span id="cb14-917"><a href="#cb14-917" aria-hidden="true" tabindex="-1"></a><span class="in">        mcse_tmp &lt;- sqrt(mean_tmp * (1 - mean_tmp) / n_rep)</span></span>
<span id="cb14-918"><a href="#cb14-918" aria-hidden="true" tabindex="-1"></a><span class="in">      if(measure == "outstrength"){</span></span>
<span id="cb14-919"><a href="#cb14-919" aria-hidden="true" tabindex="-1"></a><span class="in">        ret[[paste0("mostcent_beta_", method, "_mean")]] &lt;- mean_tmp</span></span>
<span id="cb14-920"><a href="#cb14-920" aria-hidden="true" tabindex="-1"></a><span class="in">        ret[[paste0("mostcent_beta_", method, "_mcse")]] &lt;- mcse_tmp</span></span>
<span id="cb14-921"><a href="#cb14-921" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb14-922"><a href="#cb14-922" aria-hidden="true" tabindex="-1"></a><span class="in">      } else if(measure == "strength"){</span></span>
<span id="cb14-923"><a href="#cb14-923" aria-hidden="true" tabindex="-1"></a><span class="in">        ret[[paste0("mostcent_pcor_", method, "_mean")]] &lt;- mean_tmp</span></span>
<span id="cb14-924"><a href="#cb14-924" aria-hidden="true" tabindex="-1"></a><span class="in">        ret[[paste0("mostcent_pcor_", method, "_mcse")]] &lt;- mcse_tmp</span></span>
<span id="cb14-925"><a href="#cb14-925" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb14-926"><a href="#cb14-926" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb14-927"><a href="#cb14-927" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-928"><a href="#cb14-928" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-929"><a href="#cb14-929" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-930"><a href="#cb14-930" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-931"><a href="#cb14-931" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-932"><a href="#cb14-932" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-933"><a href="#cb14-933" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- Regression</span></span>
<span id="cb14-934"><a href="#cb14-934" aria-hidden="true" tabindex="-1"></a><span class="in">  #-- Power</span></span>
<span id="cb14-935"><a href="#cb14-935" aria-hidden="true" tabindex="-1"></a><span class="in">  regression_power &lt;- function(results, </span></span>
<span id="cb14-936"><a href="#cb14-936" aria-hidden="true" tabindex="-1"></a><span class="in">                               method, </span></span>
<span id="cb14-937"><a href="#cb14-937" aria-hidden="true" tabindex="-1"></a><span class="in">                               measure,</span></span>
<span id="cb14-938"><a href="#cb14-938" aria-hidden="true" tabindex="-1"></a><span class="in">                               true_coef = c(0,.2,.4),</span></span>
<span id="cb14-939"><a href="#cb14-939" aria-hidden="true" tabindex="-1"></a><span class="in">                               lm_beta = use_lm_beta) {</span></span>
<span id="cb14-940"><a href="#cb14-940" aria-hidden="true" tabindex="-1"></a><span class="in">  sapply(seq_along(results), function(i){</span></span>
<span id="cb14-941"><a href="#cb14-941" aria-hidden="true" tabindex="-1"></a><span class="in">    if(is.null(results[[i]][[method]][[paste0("reg_", measure)]])){</span></span>
<span id="cb14-942"><a href="#cb14-942" aria-hidden="true" tabindex="-1"></a><span class="in">      return(NA)</span></span>
<span id="cb14-943"><a href="#cb14-943" aria-hidden="true" tabindex="-1"></a><span class="in">    } </span></span>
<span id="cb14-944"><a href="#cb14-944" aria-hidden="true" tabindex="-1"></a><span class="in">    else{</span></span>
<span id="cb14-945"><a href="#cb14-945" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_pvals &lt;- sapply(results[[i]][[method]][[paste0("reg_", measure)]],</span></span>
<span id="cb14-946"><a href="#cb14-946" aria-hidden="true" tabindex="-1"></a><span class="in">                          function(x){</span></span>
<span id="cb14-947"><a href="#cb14-947" aria-hidden="true" tabindex="-1"></a><span class="in">                            if(isTRUE(lm_beta)){</span></span>
<span id="cb14-948"><a href="#cb14-948" aria-hidden="true" tabindex="-1"></a><span class="in">                              res &lt;- summary(lm.beta::lm.beta(x))$coefficients</span></span>
<span id="cb14-949"><a href="#cb14-949" aria-hidden="true" tabindex="-1"></a><span class="in">                              res[2,5]</span></span>
<span id="cb14-950"><a href="#cb14-950" aria-hidden="true" tabindex="-1"></a><span class="in">                            } else{</span></span>
<span id="cb14-951"><a href="#cb14-951" aria-hidden="true" tabindex="-1"></a><span class="in">                              res &lt;- summary(x)$coefficients</span></span>
<span id="cb14-952"><a href="#cb14-952" aria-hidden="true" tabindex="-1"></a><span class="in">                              res[2,4]</span></span>
<span id="cb14-953"><a href="#cb14-953" aria-hidden="true" tabindex="-1"></a><span class="in">                            }})</span></span>
<span id="cb14-954"><a href="#cb14-954" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-955"><a href="#cb14-955" aria-hidden="true" tabindex="-1"></a><span class="in">      # Calculate Empirical detection rate/power</span></span>
<span id="cb14-956"><a href="#cb14-956" aria-hidden="true" tabindex="-1"></a><span class="in">      ifelse(reg_pvals &lt; .05, 1, 0)</span></span>
<span id="cb14-957"><a href="#cb14-957" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb14-958"><a href="#cb14-958" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-959"><a href="#cb14-959" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-960"><a href="#cb14-960" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-961"><a href="#cb14-961" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-962"><a href="#cb14-962" aria-hidden="true" tabindex="-1"></a><span class="in">  #-- Summary</span></span>
<span id="cb14-963"><a href="#cb14-963" aria-hidden="true" tabindex="-1"></a><span class="in">  true_coef &lt;- c(0, .2, .4)</span></span>
<span id="cb14-964"><a href="#cb14-964" aria-hidden="true" tabindex="-1"></a><span class="in">  regression_summary &lt;- function(results, </span></span>
<span id="cb14-965"><a href="#cb14-965" aria-hidden="true" tabindex="-1"></a><span class="in">                              method, </span></span>
<span id="cb14-966"><a href="#cb14-966" aria-hidden="true" tabindex="-1"></a><span class="in">                              measure,</span></span>
<span id="cb14-967"><a href="#cb14-967" aria-hidden="true" tabindex="-1"></a><span class="in">                              true_coef = c(0,.2,.4),</span></span>
<span id="cb14-968"><a href="#cb14-968" aria-hidden="true" tabindex="-1"></a><span class="in">                              lm_beta = use_lm_beta,</span></span>
<span id="cb14-969"><a href="#cb14-969" aria-hidden="true" tabindex="-1"></a><span class="in">                              summary = "rmse") {</span></span>
<span id="cb14-970"><a href="#cb14-970" aria-hidden="true" tabindex="-1"></a><span class="in">  sapply(seq_along(results), function(i){</span></span>
<span id="cb14-971"><a href="#cb14-971" aria-hidden="true" tabindex="-1"></a><span class="in">    if(is.null(results[[i]][[method]][[paste0("reg_", measure)]])){</span></span>
<span id="cb14-972"><a href="#cb14-972" aria-hidden="true" tabindex="-1"></a><span class="in">      return(NA)</span></span>
<span id="cb14-973"><a href="#cb14-973" aria-hidden="true" tabindex="-1"></a><span class="in">    } </span></span>
<span id="cb14-974"><a href="#cb14-974" aria-hidden="true" tabindex="-1"></a><span class="in">    else{</span></span>
<span id="cb14-975"><a href="#cb14-975" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_coefs &lt;- sapply(results[[i]][[method]][[paste0("reg_", measure)]],</span></span>
<span id="cb14-976"><a href="#cb14-976" aria-hidden="true" tabindex="-1"></a><span class="in">                          function(x){</span></span>
<span id="cb14-977"><a href="#cb14-977" aria-hidden="true" tabindex="-1"></a><span class="in">                            if(isTRUE(lm_beta)){</span></span>
<span id="cb14-978"><a href="#cb14-978" aria-hidden="true" tabindex="-1"></a><span class="in">                              lm.beta::lm.beta(x)$standardized.coefficients</span></span>
<span id="cb14-979"><a href="#cb14-979" aria-hidden="true" tabindex="-1"></a><span class="in">                            } else{</span></span>
<span id="cb14-980"><a href="#cb14-980" aria-hidden="true" tabindex="-1"></a><span class="in">                              x$coefficients</span></span>
<span id="cb14-981"><a href="#cb14-981" aria-hidden="true" tabindex="-1"></a><span class="in">                            }})[2,]   # 2nd row -&gt; beta coef</span></span>
<span id="cb14-982"><a href="#cb14-982" aria-hidden="true" tabindex="-1"></a><span class="in">      # Calculate RMSE</span></span>
<span id="cb14-983"><a href="#cb14-983" aria-hidden="true" tabindex="-1"></a><span class="in">      if(summary == "rmse"){</span></span>
<span id="cb14-984"><a href="#cb14-984" aria-hidden="true" tabindex="-1"></a><span class="in">        sqrt( (reg_coefs - true_coef )^2 )</span></span>
<span id="cb14-985"><a href="#cb14-985" aria-hidden="true" tabindex="-1"></a><span class="in">      } else if(summary == "mse"){</span></span>
<span id="cb14-986"><a href="#cb14-986" aria-hidden="true" tabindex="-1"></a><span class="in">        (reg_coefs - true_coef)^2</span></span>
<span id="cb14-987"><a href="#cb14-987" aria-hidden="true" tabindex="-1"></a><span class="in">      } else if(summary == "bias"){</span></span>
<span id="cb14-988"><a href="#cb14-988" aria-hidden="true" tabindex="-1"></a><span class="in">        reg_coefs - true_coef</span></span>
<span id="cb14-989"><a href="#cb14-989" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb14-990"><a href="#cb14-990" aria-hidden="true" tabindex="-1"></a><span class="in">        </span></span>
<span id="cb14-991"><a href="#cb14-991" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb14-992"><a href="#cb14-992" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb14-993"><a href="#cb14-993" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-994"><a href="#cb14-994" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-995"><a href="#cb14-995" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-996"><a href="#cb14-996" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-997"><a href="#cb14-997" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-998"><a href="#cb14-998" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-999"><a href="#cb14-999" aria-hidden="true" tabindex="-1"></a><span class="in">  # exclude bmlvar because of its different data structure</span></span>
<span id="cb14-1000"><a href="#cb14-1000" aria-hidden="true" tabindex="-1"></a><span class="in">  methods &lt;- c("gvar", "mlvar", "gimme")</span></span>
<span id="cb14-1001"><a href="#cb14-1001" aria-hidden="true" tabindex="-1"></a><span class="in">  measures &lt;- c("instrength", "outstrength", "strength")</span></span>
<span id="cb14-1002"><a href="#cb14-1002" aria-hidden="true" tabindex="-1"></a><span class="in">  summaries &lt;- c("rmse", "bias", "mse")</span></span>
<span id="cb14-1003"><a href="#cb14-1003" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1004"><a href="#cb14-1004" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1005"><a href="#cb14-1005" aria-hidden="true" tabindex="-1"></a><span class="in">  for (method in methods) {</span></span>
<span id="cb14-1006"><a href="#cb14-1006" aria-hidden="true" tabindex="-1"></a><span class="in">      for (measure in measures) {</span></span>
<span id="cb14-1007"><a href="#cb14-1007" aria-hidden="true" tabindex="-1"></a><span class="in">        for (summary in summaries) {</span></span>
<span id="cb14-1008"><a href="#cb14-1008" aria-hidden="true" tabindex="-1"></a><span class="in">          # Calculate summary</span></span>
<span id="cb14-1009"><a href="#cb14-1009" aria-hidden="true" tabindex="-1"></a><span class="in">          result_name_summary &lt;- paste(summary, "reg", measure, method, sep = "_")</span></span>
<span id="cb14-1010"><a href="#cb14-1010" aria-hidden="true" tabindex="-1"></a><span class="in">          calc_list &lt;- regression_summary(</span></span>
<span id="cb14-1011"><a href="#cb14-1011" aria-hidden="true" tabindex="-1"></a><span class="in">            results = results, </span></span>
<span id="cb14-1012"><a href="#cb14-1012" aria-hidden="true" tabindex="-1"></a><span class="in">            method = method, </span></span>
<span id="cb14-1013"><a href="#cb14-1013" aria-hidden="true" tabindex="-1"></a><span class="in">            measure = measure,</span></span>
<span id="cb14-1014"><a href="#cb14-1014" aria-hidden="true" tabindex="-1"></a><span class="in">            summary = summary)</span></span>
<span id="cb14-1015"><a href="#cb14-1015" aria-hidden="true" tabindex="-1"></a><span class="in">          mean_tmp &lt;- rowMeans(calc_list, na.rm = TRUE)</span></span>
<span id="cb14-1016"><a href="#cb14-1016" aria-hidden="true" tabindex="-1"></a><span class="in">          # bit of a hack to add the names for the different correlation</span></span>
<span id="cb14-1017"><a href="#cb14-1017" aria-hidden="true" tabindex="-1"></a><span class="in">          # levels</span></span>
<span id="cb14-1018"><a href="#cb14-1018" aria-hidden="true" tabindex="-1"></a><span class="in">          names(mean_tmp) &lt;- paste0(summary, </span></span>
<span id="cb14-1019"><a href="#cb14-1019" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_reg",</span></span>
<span id="cb14-1020"><a href="#cb14-1020" aria-hidden="true" tabindex="-1"></a><span class="in">                                   c(0, 2, 4),</span></span>
<span id="cb14-1021"><a href="#cb14-1021" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_",</span></span>
<span id="cb14-1022"><a href="#cb14-1022" aria-hidden="true" tabindex="-1"></a><span class="in">                                   measure,</span></span>
<span id="cb14-1023"><a href="#cb14-1023" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_",</span></span>
<span id="cb14-1024"><a href="#cb14-1024" aria-hidden="true" tabindex="-1"></a><span class="in">                                   method,</span></span>
<span id="cb14-1025"><a href="#cb14-1025" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_mean")</span></span>
<span id="cb14-1026"><a href="#cb14-1026" aria-hidden="true" tabindex="-1"></a><span class="in">          ret[[paste0(result_name_summary, "_mean")]] &lt;- mean_tmp</span></span>
<span id="cb14-1027"><a href="#cb14-1027" aria-hidden="true" tabindex="-1"></a><span class="in">          if(summary == "rmse"){</span></span>
<span id="cb14-1028"><a href="#cb14-1028" aria-hidden="true" tabindex="-1"></a><span class="in">            # calculate MSE</span></span>
<span id="cb14-1029"><a href="#cb14-1029" aria-hidden="true" tabindex="-1"></a><span class="in">            mse_tmp &lt;- regression_summary(</span></span>
<span id="cb14-1030"><a href="#cb14-1030" aria-hidden="true" tabindex="-1"></a><span class="in">            results, </span></span>
<span id="cb14-1031"><a href="#cb14-1031" aria-hidden="true" tabindex="-1"></a><span class="in">            method, </span></span>
<span id="cb14-1032"><a href="#cb14-1032" aria-hidden="true" tabindex="-1"></a><span class="in">            measure,</span></span>
<span id="cb14-1033"><a href="#cb14-1033" aria-hidden="true" tabindex="-1"></a><span class="in">            summary = "mse")</span></span>
<span id="cb14-1034"><a href="#cb14-1034" aria-hidden="true" tabindex="-1"></a><span class="in">            mse_mean_tmp &lt;- rowMeans(mse_tmp, na.rm = TRUE)</span></span>
<span id="cb14-1035"><a href="#cb14-1035" aria-hidden="true" tabindex="-1"></a><span class="in">            mcse_tmp &lt;- sqrt (apply(calc_list, 1, var, na.rm = TRUE) / (4*n_rep*mse_mean_tmp))</span></span>
<span id="cb14-1036"><a href="#cb14-1036" aria-hidden="true" tabindex="-1"></a><span class="in">            names(mcse_tmp) &lt;- paste0(summary, </span></span>
<span id="cb14-1037"><a href="#cb14-1037" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_reg",</span></span>
<span id="cb14-1038"><a href="#cb14-1038" aria-hidden="true" tabindex="-1"></a><span class="in">                                   c(0, 2, 4),</span></span>
<span id="cb14-1039"><a href="#cb14-1039" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_",</span></span>
<span id="cb14-1040"><a href="#cb14-1040" aria-hidden="true" tabindex="-1"></a><span class="in">                                   measure,</span></span>
<span id="cb14-1041"><a href="#cb14-1041" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_",</span></span>
<span id="cb14-1042"><a href="#cb14-1042" aria-hidden="true" tabindex="-1"></a><span class="in">                                   method,</span></span>
<span id="cb14-1043"><a href="#cb14-1043" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_mcse")</span></span>
<span id="cb14-1044"><a href="#cb14-1044" aria-hidden="true" tabindex="-1"></a><span class="in">            ret[[paste0(result_name_summary, "_mcse")]] &lt;- mcse_tmp</span></span>
<span id="cb14-1045"><a href="#cb14-1045" aria-hidden="true" tabindex="-1"></a><span class="in">          } else if(summary == "mse"){</span></span>
<span id="cb14-1046"><a href="#cb14-1046" aria-hidden="true" tabindex="-1"></a><span class="in">            mcse_tmp &lt;- sqrt(</span></span>
<span id="cb14-1047"><a href="#cb14-1047" aria-hidden="true" tabindex="-1"></a><span class="in">              apply(calc_list, 1, var, na.rm = TRUE) / n_rep)</span></span>
<span id="cb14-1048"><a href="#cb14-1048" aria-hidden="true" tabindex="-1"></a><span class="in">            names(mcse_tmp) &lt;- paste0(summary, </span></span>
<span id="cb14-1049"><a href="#cb14-1049" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_reg",</span></span>
<span id="cb14-1050"><a href="#cb14-1050" aria-hidden="true" tabindex="-1"></a><span class="in">                                   c(0, 2, 4),</span></span>
<span id="cb14-1051"><a href="#cb14-1051" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_",</span></span>
<span id="cb14-1052"><a href="#cb14-1052" aria-hidden="true" tabindex="-1"></a><span class="in">                                   measure,</span></span>
<span id="cb14-1053"><a href="#cb14-1053" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_",</span></span>
<span id="cb14-1054"><a href="#cb14-1054" aria-hidden="true" tabindex="-1"></a><span class="in">                                   method,</span></span>
<span id="cb14-1055"><a href="#cb14-1055" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_mcse")</span></span>
<span id="cb14-1056"><a href="#cb14-1056" aria-hidden="true" tabindex="-1"></a><span class="in">            ret[[paste0(result_name_summary, "_mcse")]] &lt;- mcse_tmp</span></span>
<span id="cb14-1057"><a href="#cb14-1057" aria-hidden="true" tabindex="-1"></a><span class="in">          } else if(summary == "bias"){</span></span>
<span id="cb14-1058"><a href="#cb14-1058" aria-hidden="true" tabindex="-1"></a><span class="in">            mcse_bias &lt;- sqrt(</span></span>
<span id="cb14-1059"><a href="#cb14-1059" aria-hidden="true" tabindex="-1"></a><span class="in">              apply(calc_list, 1, var, na.rm = TRUE) / n_rep</span></span>
<span id="cb14-1060"><a href="#cb14-1060" aria-hidden="true" tabindex="-1"></a><span class="in">            )</span></span>
<span id="cb14-1061"><a href="#cb14-1061" aria-hidden="true" tabindex="-1"></a><span class="in">            names(mcse_bias) &lt;- paste0(summary, </span></span>
<span id="cb14-1062"><a href="#cb14-1062" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_reg",</span></span>
<span id="cb14-1063"><a href="#cb14-1063" aria-hidden="true" tabindex="-1"></a><span class="in">                                   c(0, 2, 4),</span></span>
<span id="cb14-1064"><a href="#cb14-1064" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_",</span></span>
<span id="cb14-1065"><a href="#cb14-1065" aria-hidden="true" tabindex="-1"></a><span class="in">                                   measure,</span></span>
<span id="cb14-1066"><a href="#cb14-1066" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_",</span></span>
<span id="cb14-1067"><a href="#cb14-1067" aria-hidden="true" tabindex="-1"></a><span class="in">                                   method,</span></span>
<span id="cb14-1068"><a href="#cb14-1068" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_mcse")</span></span>
<span id="cb14-1069"><a href="#cb14-1069" aria-hidden="true" tabindex="-1"></a><span class="in">            ret[[paste0(result_name_summary, "_mcse")]] &lt;- mcse_bias</span></span>
<span id="cb14-1070"><a href="#cb14-1070" aria-hidden="true" tabindex="-1"></a><span class="in">          }</span></span>
<span id="cb14-1071"><a href="#cb14-1071" aria-hidden="true" tabindex="-1"></a><span class="in">          # Calculate Power</span></span>
<span id="cb14-1072"><a href="#cb14-1072" aria-hidden="true" tabindex="-1"></a><span class="in">          result_name_power &lt;- paste("power", "reg", measure, method, sep = "_")</span></span>
<span id="cb14-1073"><a href="#cb14-1073" aria-hidden="true" tabindex="-1"></a><span class="in">          calc_list_pwr &lt;- regression_power(</span></span>
<span id="cb14-1074"><a href="#cb14-1074" aria-hidden="true" tabindex="-1"></a><span class="in">            results = results, </span></span>
<span id="cb14-1075"><a href="#cb14-1075" aria-hidden="true" tabindex="-1"></a><span class="in">            method = method, </span></span>
<span id="cb14-1076"><a href="#cb14-1076" aria-hidden="true" tabindex="-1"></a><span class="in">            measure = measure)</span></span>
<span id="cb14-1077"><a href="#cb14-1077" aria-hidden="true" tabindex="-1"></a><span class="in">          pwr_mean &lt;- rowMeans(calc_list_pwr, na.rm = TRUE)</span></span>
<span id="cb14-1078"><a href="#cb14-1078" aria-hidden="true" tabindex="-1"></a><span class="in">          names(pwr_mean) &lt;- paste0("power", </span></span>
<span id="cb14-1079"><a href="#cb14-1079" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_reg",</span></span>
<span id="cb14-1080"><a href="#cb14-1080" aria-hidden="true" tabindex="-1"></a><span class="in">                                   c(0, 2, 4),</span></span>
<span id="cb14-1081"><a href="#cb14-1081" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_",</span></span>
<span id="cb14-1082"><a href="#cb14-1082" aria-hidden="true" tabindex="-1"></a><span class="in">                                   measure,</span></span>
<span id="cb14-1083"><a href="#cb14-1083" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_",</span></span>
<span id="cb14-1084"><a href="#cb14-1084" aria-hidden="true" tabindex="-1"></a><span class="in">                                   method,</span></span>
<span id="cb14-1085"><a href="#cb14-1085" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_mean")</span></span>
<span id="cb14-1086"><a href="#cb14-1086" aria-hidden="true" tabindex="-1"></a><span class="in">          ret[[paste0(result_name_power, "_mean")]] &lt;- pwr_mean</span></span>
<span id="cb14-1087"><a href="#cb14-1087" aria-hidden="true" tabindex="-1"></a><span class="in">          pwr_mcse_tmp &lt;- sqrt(</span></span>
<span id="cb14-1088"><a href="#cb14-1088" aria-hidden="true" tabindex="-1"></a><span class="in">            pwr_mean * (1 - pwr_mean) / n_rep)</span></span>
<span id="cb14-1089"><a href="#cb14-1089" aria-hidden="true" tabindex="-1"></a><span class="in">          names(pwr_mcse_tmp) &lt;- paste0("power", </span></span>
<span id="cb14-1090"><a href="#cb14-1090" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_reg",</span></span>
<span id="cb14-1091"><a href="#cb14-1091" aria-hidden="true" tabindex="-1"></a><span class="in">                                   c(0, 2, 4),</span></span>
<span id="cb14-1092"><a href="#cb14-1092" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_",</span></span>
<span id="cb14-1093"><a href="#cb14-1093" aria-hidden="true" tabindex="-1"></a><span class="in">                                   measure,</span></span>
<span id="cb14-1094"><a href="#cb14-1094" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_",</span></span>
<span id="cb14-1095"><a href="#cb14-1095" aria-hidden="true" tabindex="-1"></a><span class="in">                                   method,</span></span>
<span id="cb14-1096"><a href="#cb14-1096" aria-hidden="true" tabindex="-1"></a><span class="in">                                   "_mcse")</span></span>
<span id="cb14-1097"><a href="#cb14-1097" aria-hidden="true" tabindex="-1"></a><span class="in">          ret[[paste0(result_name_power, "_mcse")]] &lt;- pwr_mcse_tmp</span></span>
<span id="cb14-1098"><a href="#cb14-1098" aria-hidden="true" tabindex="-1"></a><span class="in">        }</span></span>
<span id="cb14-1099"><a href="#cb14-1099" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb14-1100"><a href="#cb14-1100" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-1101"><a href="#cb14-1101" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1102"><a href="#cb14-1102" aria-hidden="true" tabindex="-1"></a><span class="in">  # Summary for bmlvar</span></span>
<span id="cb14-1103"><a href="#cb14-1103" aria-hidden="true" tabindex="-1"></a><span class="in">  method &lt;- "bmlvar"</span></span>
<span id="cb14-1104"><a href="#cb14-1104" aria-hidden="true" tabindex="-1"></a><span class="in">  regression_rmse_bmlvar &lt;- function(</span></span>
<span id="cb14-1105"><a href="#cb14-1105" aria-hidden="true" tabindex="-1"></a><span class="in">                              results, </span></span>
<span id="cb14-1106"><a href="#cb14-1106" aria-hidden="true" tabindex="-1"></a><span class="in">                              method = "bmlvar", </span></span>
<span id="cb14-1107"><a href="#cb14-1107" aria-hidden="true" tabindex="-1"></a><span class="in">                              true_coef = c(0,.2,.4),</span></span>
<span id="cb14-1108"><a href="#cb14-1108" aria-hidden="true" tabindex="-1"></a><span class="in">                              # lm_beta = TRUE,</span></span>
<span id="cb14-1109"><a href="#cb14-1109" aria-hidden="true" tabindex="-1"></a><span class="in">                              rmse = TRUE) {</span></span>
<span id="cb14-1110"><a href="#cb14-1110" aria-hidden="true" tabindex="-1"></a><span class="in">  sapply(seq_along(results), function(i){</span></span>
<span id="cb14-1111"><a href="#cb14-1111" aria-hidden="true" tabindex="-1"></a><span class="in">    if(is.null(results[[i]][[method]][["reg_bmlvar"]])){</span></span>
<span id="cb14-1112"><a href="#cb14-1112" aria-hidden="true" tabindex="-1"></a><span class="in">      return(NA)</span></span>
<span id="cb14-1113"><a href="#cb14-1113" aria-hidden="true" tabindex="-1"></a><span class="in">    } </span></span>
<span id="cb14-1114"><a href="#cb14-1114" aria-hidden="true" tabindex="-1"></a><span class="in">    else{</span></span>
<span id="cb14-1115"><a href="#cb14-1115" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_coefs &lt;- results[[i]][[method]][["reg_bmlvar"]][["regression_slope"]][["median"]]</span></span>
<span id="cb14-1116"><a href="#cb14-1116" aria-hidden="true" tabindex="-1"></a><span class="in">      # Have them all in one vector</span></span>
<span id="cb14-1117"><a href="#cb14-1117" aria-hidden="true" tabindex="-1"></a><span class="in">      # thus need to repeat the true_coefs </span></span>
<span id="cb14-1118"><a href="#cb14-1118" aria-hidden="true" tabindex="-1"></a><span class="in">      true_coef_all &lt;- rep(true_coef, 3)</span></span>
<span id="cb14-1119"><a href="#cb14-1119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1120"><a href="#cb14-1120" aria-hidden="true" tabindex="-1"></a><span class="in">      # Calculate RMSE</span></span>
<span id="cb14-1121"><a href="#cb14-1121" aria-hidden="true" tabindex="-1"></a><span class="in">      if(isTRUE(rmse)){</span></span>
<span id="cb14-1122"><a href="#cb14-1122" aria-hidden="true" tabindex="-1"></a><span class="in">        sqrt( (reg_coefs - true_coef )^2 )</span></span>
<span id="cb14-1123"><a href="#cb14-1123" aria-hidden="true" tabindex="-1"></a><span class="in">      } else{</span></span>
<span id="cb14-1124"><a href="#cb14-1124" aria-hidden="true" tabindex="-1"></a><span class="in">        (reg_coefs - true_coef)^2</span></span>
<span id="cb14-1125"><a href="#cb14-1125" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb14-1126"><a href="#cb14-1126" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb14-1127"><a href="#cb14-1127" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb14-1128"><a href="#cb14-1128" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-1129"><a href="#cb14-1129" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-1130"><a href="#cb14-1130" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1131"><a href="#cb14-1131" aria-hidden="true" tabindex="-1"></a><span class="in">  regression_bias_bmlvar &lt;- function(</span></span>
<span id="cb14-1132"><a href="#cb14-1132" aria-hidden="true" tabindex="-1"></a><span class="in">                              results, </span></span>
<span id="cb14-1133"><a href="#cb14-1133" aria-hidden="true" tabindex="-1"></a><span class="in">                              method = "bmlvar", </span></span>
<span id="cb14-1134"><a href="#cb14-1134" aria-hidden="true" tabindex="-1"></a><span class="in">                              true_coef = c(0,.2,.4)</span></span>
<span id="cb14-1135"><a href="#cb14-1135" aria-hidden="true" tabindex="-1"></a><span class="in">                              # lm_beta = TRUE</span></span>
<span id="cb14-1136"><a href="#cb14-1136" aria-hidden="true" tabindex="-1"></a><span class="in">                              )</span></span>
<span id="cb14-1137"><a href="#cb14-1137" aria-hidden="true" tabindex="-1"></a><span class="in">                              {</span></span>
<span id="cb14-1138"><a href="#cb14-1138" aria-hidden="true" tabindex="-1"></a><span class="in">  sapply(seq_along(results), function(i){</span></span>
<span id="cb14-1139"><a href="#cb14-1139" aria-hidden="true" tabindex="-1"></a><span class="in">    if(is.null(results[[i]][[method]][["reg_bmlvar"]])){</span></span>
<span id="cb14-1140"><a href="#cb14-1140" aria-hidden="true" tabindex="-1"></a><span class="in">      return(NA)</span></span>
<span id="cb14-1141"><a href="#cb14-1141" aria-hidden="true" tabindex="-1"></a><span class="in">    } </span></span>
<span id="cb14-1142"><a href="#cb14-1142" aria-hidden="true" tabindex="-1"></a><span class="in">    else{</span></span>
<span id="cb14-1143"><a href="#cb14-1143" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_coefs &lt;- results[[i]][[method]][["reg_bmlvar"]][["regression_slope"]][["median"]]</span></span>
<span id="cb14-1144"><a href="#cb14-1144" aria-hidden="true" tabindex="-1"></a><span class="in">      # Have them all in one vector</span></span>
<span id="cb14-1145"><a href="#cb14-1145" aria-hidden="true" tabindex="-1"></a><span class="in">      # thus need to repeat the true_coefs </span></span>
<span id="cb14-1146"><a href="#cb14-1146" aria-hidden="true" tabindex="-1"></a><span class="in">      true_coef_all &lt;- rep(true_coef, 3)</span></span>
<span id="cb14-1147"><a href="#cb14-1147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1148"><a href="#cb14-1148" aria-hidden="true" tabindex="-1"></a><span class="in">      # Calculate Bias</span></span>
<span id="cb14-1149"><a href="#cb14-1149" aria-hidden="true" tabindex="-1"></a><span class="in">      reg_coefs - true_coef</span></span>
<span id="cb14-1150"><a href="#cb14-1150" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb14-1151"><a href="#cb14-1151" aria-hidden="true" tabindex="-1"></a><span class="in">      }</span></span>
<span id="cb14-1152"><a href="#cb14-1152" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-1153"><a href="#cb14-1153" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-1154"><a href="#cb14-1154" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1155"><a href="#cb14-1155" aria-hidden="true" tabindex="-1"></a><span class="in">  regression_power_bmlvar &lt;- function(</span></span>
<span id="cb14-1156"><a href="#cb14-1156" aria-hidden="true" tabindex="-1"></a><span class="in">                              results, </span></span>
<span id="cb14-1157"><a href="#cb14-1157" aria-hidden="true" tabindex="-1"></a><span class="in">                              method = "bmlvar", </span></span>
<span id="cb14-1158"><a href="#cb14-1158" aria-hidden="true" tabindex="-1"></a><span class="in">                              measure,</span></span>
<span id="cb14-1159"><a href="#cb14-1159" aria-hidden="true" tabindex="-1"></a><span class="in">                              oneside = TRUE){</span></span>
<span id="cb14-1160"><a href="#cb14-1160" aria-hidden="true" tabindex="-1"></a><span class="in">  sapply(seq_along(results), function(i){</span></span>
<span id="cb14-1161"><a href="#cb14-1161" aria-hidden="true" tabindex="-1"></a><span class="in">    if(is.null(results[[i]][[method]][["reg_bmlvar"]])){</span></span>
<span id="cb14-1162"><a href="#cb14-1162" aria-hidden="true" tabindex="-1"></a><span class="in">      return(NA)</span></span>
<span id="cb14-1163"><a href="#cb14-1163" aria-hidden="true" tabindex="-1"></a><span class="in">    } </span></span>
<span id="cb14-1164"><a href="#cb14-1164" aria-hidden="true" tabindex="-1"></a><span class="in">    else{</span></span>
<span id="cb14-1165"><a href="#cb14-1165" aria-hidden="true" tabindex="-1"></a><span class="in">      ci_twoside &lt;- results[[i]][[method]][["reg_bmlvar"]][["regression_slope"]][["ci_95_l"]]</span></span>
<span id="cb14-1166"><a href="#cb14-1166" aria-hidden="true" tabindex="-1"></a><span class="in">      ci_oneside &lt;- results[[i]][[method]][["reg_bmlvar"]][["regression_slope"]][["ci_oneside"]]</span></span>
<span id="cb14-1167"><a href="#cb14-1167" aria-hidden="true" tabindex="-1"></a><span class="in">      if(isTRUE(oneside)){</span></span>
<span id="cb14-1168"><a href="#cb14-1168" aria-hidden="true" tabindex="-1"></a><span class="in">        ifelse(ci_oneside &gt; 0, 1, 0)</span></span>
<span id="cb14-1169"><a href="#cb14-1169" aria-hidden="true" tabindex="-1"></a><span class="in">      } else{</span></span>
<span id="cb14-1170"><a href="#cb14-1170" aria-hidden="true" tabindex="-1"></a><span class="in">        ifelse(ci_twoside &gt; 0, 1, 0)</span></span>
<span id="cb14-1171"><a href="#cb14-1171" aria-hidden="true" tabindex="-1"></a><span class="in">      </span></span>
<span id="cb14-1172"><a href="#cb14-1172" aria-hidden="true" tabindex="-1"></a><span class="in">    }</span></span>
<span id="cb14-1173"><a href="#cb14-1173" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-1174"><a href="#cb14-1174" aria-hidden="true" tabindex="-1"></a><span class="in">  })</span></span>
<span id="cb14-1175"><a href="#cb14-1175" aria-hidden="true" tabindex="-1"></a><span class="in">  }</span></span>
<span id="cb14-1176"><a href="#cb14-1176" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1177"><a href="#cb14-1177" aria-hidden="true" tabindex="-1"></a><span class="in">  # Apply the functions</span></span>
<span id="cb14-1178"><a href="#cb14-1178" aria-hidden="true" tabindex="-1"></a><span class="in">  calc_rmse &lt;- regression_rmse_bmlvar(</span></span>
<span id="cb14-1179"><a href="#cb14-1179" aria-hidden="true" tabindex="-1"></a><span class="in">    results = results, </span></span>
<span id="cb14-1180"><a href="#cb14-1180" aria-hidden="true" tabindex="-1"></a><span class="in">    method = "bmlvar", </span></span>
<span id="cb14-1181"><a href="#cb14-1181" aria-hidden="true" tabindex="-1"></a><span class="in">    rmse = TRUE)</span></span>
<span id="cb14-1182"><a href="#cb14-1182" aria-hidden="true" tabindex="-1"></a><span class="in">  calc_bias &lt;- regression_bias_bmlvar(</span></span>
<span id="cb14-1183"><a href="#cb14-1183" aria-hidden="true" tabindex="-1"></a><span class="in">    results = results, </span></span>
<span id="cb14-1184"><a href="#cb14-1184" aria-hidden="true" tabindex="-1"></a><span class="in">    method = "bmlvar"</span></span>
<span id="cb14-1185"><a href="#cb14-1185" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb14-1186"><a href="#cb14-1186" aria-hidden="true" tabindex="-1"></a><span class="in">  calc_mse &lt;- regression_rmse_bmlvar(</span></span>
<span id="cb14-1187"><a href="#cb14-1187" aria-hidden="true" tabindex="-1"></a><span class="in">    results = results, </span></span>
<span id="cb14-1188"><a href="#cb14-1188" aria-hidden="true" tabindex="-1"></a><span class="in">    method = "bmlvar", </span></span>
<span id="cb14-1189"><a href="#cb14-1189" aria-hidden="true" tabindex="-1"></a><span class="in">    rmse = FALSE)</span></span>
<span id="cb14-1190"><a href="#cb14-1190" aria-hidden="true" tabindex="-1"></a><span class="in">  calc_pwr_oneside &lt;- regression_power_bmlvar(</span></span>
<span id="cb14-1191"><a href="#cb14-1191" aria-hidden="true" tabindex="-1"></a><span class="in">    results = results, </span></span>
<span id="cb14-1192"><a href="#cb14-1192" aria-hidden="true" tabindex="-1"></a><span class="in">    method = "bmlvar",</span></span>
<span id="cb14-1193"><a href="#cb14-1193" aria-hidden="true" tabindex="-1"></a><span class="in">    oneside = TRUE)</span></span>
<span id="cb14-1194"><a href="#cb14-1194" aria-hidden="true" tabindex="-1"></a><span class="in">  calc_pwr_twoside &lt;- regression_power_bmlvar(</span></span>
<span id="cb14-1195"><a href="#cb14-1195" aria-hidden="true" tabindex="-1"></a><span class="in">    results = results, </span></span>
<span id="cb14-1196"><a href="#cb14-1196" aria-hidden="true" tabindex="-1"></a><span class="in">    method = "bmlvar",</span></span>
<span id="cb14-1197"><a href="#cb14-1197" aria-hidden="true" tabindex="-1"></a><span class="in">    oneside = FALSE)</span></span>
<span id="cb14-1198"><a href="#cb14-1198" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1199"><a href="#cb14-1199" aria-hidden="true" tabindex="-1"></a><span class="in">  # Calculate mean</span></span>
<span id="cb14-1200"><a href="#cb14-1200" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_rmse &lt;- rowMeans(calc_rmse, na.rm = TRUE)</span></span>
<span id="cb14-1201"><a href="#cb14-1201" aria-hidden="true" tabindex="-1"></a><span class="in">  names(mean_rmse) &lt;- paste0("rmse", </span></span>
<span id="cb14-1202"><a href="#cb14-1202" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_reg",</span></span>
<span id="cb14-1203"><a href="#cb14-1203" aria-hidden="true" tabindex="-1"></a><span class="in">                             c(0, 2, 4),</span></span>
<span id="cb14-1204"><a href="#cb14-1204" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1205"><a href="#cb14-1205" aria-hidden="true" tabindex="-1"></a><span class="in">                             rep(measures, each = 3),</span></span>
<span id="cb14-1206"><a href="#cb14-1206" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1207"><a href="#cb14-1207" aria-hidden="true" tabindex="-1"></a><span class="in">                             "bmlvar",</span></span>
<span id="cb14-1208"><a href="#cb14-1208" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_mean")</span></span>
<span id="cb14-1209"><a href="#cb14-1209" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_bias &lt;- rowMeans(calc_bias, na.rm = TRUE)</span></span>
<span id="cb14-1210"><a href="#cb14-1210" aria-hidden="true" tabindex="-1"></a><span class="in">  names(mean_bias) &lt;- paste0("bias", </span></span>
<span id="cb14-1211"><a href="#cb14-1211" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_reg",</span></span>
<span id="cb14-1212"><a href="#cb14-1212" aria-hidden="true" tabindex="-1"></a><span class="in">                             c(0, 2, 4),</span></span>
<span id="cb14-1213"><a href="#cb14-1213" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1214"><a href="#cb14-1214" aria-hidden="true" tabindex="-1"></a><span class="in">                             rep(measures, each = 3),</span></span>
<span id="cb14-1215"><a href="#cb14-1215" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1216"><a href="#cb14-1216" aria-hidden="true" tabindex="-1"></a><span class="in">                             "bmlvar",</span></span>
<span id="cb14-1217"><a href="#cb14-1217" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_mean")</span></span>
<span id="cb14-1218"><a href="#cb14-1218" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_mse &lt;- rowMeans(calc_mse, na.rm = TRUE)</span></span>
<span id="cb14-1219"><a href="#cb14-1219" aria-hidden="true" tabindex="-1"></a><span class="in">  names(mean_mse) &lt;- paste0("mse", </span></span>
<span id="cb14-1220"><a href="#cb14-1220" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_reg",</span></span>
<span id="cb14-1221"><a href="#cb14-1221" aria-hidden="true" tabindex="-1"></a><span class="in">                             c(0, 2, 4),</span></span>
<span id="cb14-1222"><a href="#cb14-1222" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1223"><a href="#cb14-1223" aria-hidden="true" tabindex="-1"></a><span class="in">                             rep(measures, each = 3),</span></span>
<span id="cb14-1224"><a href="#cb14-1224" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1225"><a href="#cb14-1225" aria-hidden="true" tabindex="-1"></a><span class="in">                             "bmlvar",</span></span>
<span id="cb14-1226"><a href="#cb14-1226" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_mean")</span></span>
<span id="cb14-1227"><a href="#cb14-1227" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_pwroneside &lt;- rowMeans(calc_pwr_oneside, na.rm = TRUE)</span></span>
<span id="cb14-1228"><a href="#cb14-1228" aria-hidden="true" tabindex="-1"></a><span class="in">  names(mean_pwroneside) &lt;- paste0("poweroneside", </span></span>
<span id="cb14-1229"><a href="#cb14-1229" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_reg",</span></span>
<span id="cb14-1230"><a href="#cb14-1230" aria-hidden="true" tabindex="-1"></a><span class="in">                             c(0, 2, 4),</span></span>
<span id="cb14-1231"><a href="#cb14-1231" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1232"><a href="#cb14-1232" aria-hidden="true" tabindex="-1"></a><span class="in">                             rep(measures, each = 3),</span></span>
<span id="cb14-1233"><a href="#cb14-1233" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1234"><a href="#cb14-1234" aria-hidden="true" tabindex="-1"></a><span class="in">                             "bmlvar",</span></span>
<span id="cb14-1235"><a href="#cb14-1235" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_mean")</span></span>
<span id="cb14-1236"><a href="#cb14-1236" aria-hidden="true" tabindex="-1"></a><span class="in">  mean_pwrtwoside &lt;- rowMeans(calc_pwr_twoside, na.rm = TRUE)</span></span>
<span id="cb14-1237"><a href="#cb14-1237" aria-hidden="true" tabindex="-1"></a><span class="in">  names(mean_pwrtwoside) &lt;- paste0("powertwoside", </span></span>
<span id="cb14-1238"><a href="#cb14-1238" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_reg",</span></span>
<span id="cb14-1239"><a href="#cb14-1239" aria-hidden="true" tabindex="-1"></a><span class="in">                             c(0, 2, 4),</span></span>
<span id="cb14-1240"><a href="#cb14-1240" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1241"><a href="#cb14-1241" aria-hidden="true" tabindex="-1"></a><span class="in">                             rep(measures, each = 3),</span></span>
<span id="cb14-1242"><a href="#cb14-1242" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1243"><a href="#cb14-1243" aria-hidden="true" tabindex="-1"></a><span class="in">                             "bmlvar",</span></span>
<span id="cb14-1244"><a href="#cb14-1244" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_mean")</span></span>
<span id="cb14-1245"><a href="#cb14-1245" aria-hidden="true" tabindex="-1"></a><span class="in">  ret[["mean_rmse"]] &lt;- mean_rmse</span></span>
<span id="cb14-1246"><a href="#cb14-1246" aria-hidden="true" tabindex="-1"></a><span class="in">  ret[["mean_bias"]] &lt;- mean_bias</span></span>
<span id="cb14-1247"><a href="#cb14-1247" aria-hidden="true" tabindex="-1"></a><span class="in">  ret[["mean_mse"]] &lt;- mean_mse</span></span>
<span id="cb14-1248"><a href="#cb14-1248" aria-hidden="true" tabindex="-1"></a><span class="in">  ret[["mean_pwroneside"]] &lt;- mean_pwroneside</span></span>
<span id="cb14-1249"><a href="#cb14-1249" aria-hidden="true" tabindex="-1"></a><span class="in">  ret[["mean_pwrtwoside"]] &lt;- mean_pwrtwoside</span></span>
<span id="cb14-1250"><a href="#cb14-1250" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1251"><a href="#cb14-1251" aria-hidden="true" tabindex="-1"></a><span class="in">  # calculate mcse</span></span>
<span id="cb14-1252"><a href="#cb14-1252" aria-hidden="true" tabindex="-1"></a><span class="in">  # mcse_rmse &lt;- sqrt(</span></span>
<span id="cb14-1253"><a href="#cb14-1253" aria-hidden="true" tabindex="-1"></a><span class="in">  #   mean_rmse * (1 - mean_rmse) / n_rep)</span></span>
<span id="cb14-1254"><a href="#cb14-1254" aria-hidden="true" tabindex="-1"></a><span class="in">  var_rmse &lt;- apply(calc_rmse, 1, stats::var)</span></span>
<span id="cb14-1255"><a href="#cb14-1255" aria-hidden="true" tabindex="-1"></a><span class="in">  mcse_rmse &lt;- sqrt(</span></span>
<span id="cb14-1256"><a href="#cb14-1256" aria-hidden="true" tabindex="-1"></a><span class="in">    var_rmse/(4 * n_rep * mean_mse)</span></span>
<span id="cb14-1257"><a href="#cb14-1257" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb14-1258"><a href="#cb14-1258" aria-hidden="true" tabindex="-1"></a><span class="in">  names(mcse_rmse) &lt;- paste0("rmse", </span></span>
<span id="cb14-1259"><a href="#cb14-1259" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_reg",</span></span>
<span id="cb14-1260"><a href="#cb14-1260" aria-hidden="true" tabindex="-1"></a><span class="in">                             c(0, 2, 4),</span></span>
<span id="cb14-1261"><a href="#cb14-1261" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1262"><a href="#cb14-1262" aria-hidden="true" tabindex="-1"></a><span class="in">                             rep(measures, each = 3),</span></span>
<span id="cb14-1263"><a href="#cb14-1263" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1264"><a href="#cb14-1264" aria-hidden="true" tabindex="-1"></a><span class="in">                             "bmlvar",</span></span>
<span id="cb14-1265"><a href="#cb14-1265" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_mcse")</span></span>
<span id="cb14-1266"><a href="#cb14-1266" aria-hidden="true" tabindex="-1"></a><span class="in">  var_bias &lt;- apply(calc_bias, 1, stats::var)</span></span>
<span id="cb14-1267"><a href="#cb14-1267" aria-hidden="true" tabindex="-1"></a><span class="in">  mcse_bias &lt;- sqrt(</span></span>
<span id="cb14-1268"><a href="#cb14-1268" aria-hidden="true" tabindex="-1"></a><span class="in">    var_bias/n_rep</span></span>
<span id="cb14-1269"><a href="#cb14-1269" aria-hidden="true" tabindex="-1"></a><span class="in">  )</span></span>
<span id="cb14-1270"><a href="#cb14-1270" aria-hidden="true" tabindex="-1"></a><span class="in">  names(mcse_bias) &lt;- paste0("bias", </span></span>
<span id="cb14-1271"><a href="#cb14-1271" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_reg",</span></span>
<span id="cb14-1272"><a href="#cb14-1272" aria-hidden="true" tabindex="-1"></a><span class="in">                             c(0, 2, 4),</span></span>
<span id="cb14-1273"><a href="#cb14-1273" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1274"><a href="#cb14-1274" aria-hidden="true" tabindex="-1"></a><span class="in">                             rep(measures, each = 3),</span></span>
<span id="cb14-1275"><a href="#cb14-1275" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1276"><a href="#cb14-1276" aria-hidden="true" tabindex="-1"></a><span class="in">                             "bmlvar",</span></span>
<span id="cb14-1277"><a href="#cb14-1277" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_mcse")</span></span>
<span id="cb14-1278"><a href="#cb14-1278" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1279"><a href="#cb14-1279" aria-hidden="true" tabindex="-1"></a><span class="in">  mcse_mse &lt;- sqrt(</span></span>
<span id="cb14-1280"><a href="#cb14-1280" aria-hidden="true" tabindex="-1"></a><span class="in">    mean_mse * (1 - mean_mse) / n_rep)</span></span>
<span id="cb14-1281"><a href="#cb14-1281" aria-hidden="true" tabindex="-1"></a><span class="in">  names(mcse_mse) &lt;- paste0("mse", </span></span>
<span id="cb14-1282"><a href="#cb14-1282" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_reg",</span></span>
<span id="cb14-1283"><a href="#cb14-1283" aria-hidden="true" tabindex="-1"></a><span class="in">                             c(0, 2, 4),</span></span>
<span id="cb14-1284"><a href="#cb14-1284" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1285"><a href="#cb14-1285" aria-hidden="true" tabindex="-1"></a><span class="in">                             rep(measures, each = 3),</span></span>
<span id="cb14-1286"><a href="#cb14-1286" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1287"><a href="#cb14-1287" aria-hidden="true" tabindex="-1"></a><span class="in">                             "bmlvar",</span></span>
<span id="cb14-1288"><a href="#cb14-1288" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_mcse")</span></span>
<span id="cb14-1289"><a href="#cb14-1289" aria-hidden="true" tabindex="-1"></a><span class="in">  mcse_pwroneside &lt;- sqrt(</span></span>
<span id="cb14-1290"><a href="#cb14-1290" aria-hidden="true" tabindex="-1"></a><span class="in">    mean_pwroneside * (1 - mean_pwroneside) / n_rep)</span></span>
<span id="cb14-1291"><a href="#cb14-1291" aria-hidden="true" tabindex="-1"></a><span class="in">  names(mcse_pwroneside) &lt;- paste0("poweroneside", </span></span>
<span id="cb14-1292"><a href="#cb14-1292" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_reg",</span></span>
<span id="cb14-1293"><a href="#cb14-1293" aria-hidden="true" tabindex="-1"></a><span class="in">                             c(0, 2, 4),</span></span>
<span id="cb14-1294"><a href="#cb14-1294" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1295"><a href="#cb14-1295" aria-hidden="true" tabindex="-1"></a><span class="in">                             rep(measures, each = 3),</span></span>
<span id="cb14-1296"><a href="#cb14-1296" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1297"><a href="#cb14-1297" aria-hidden="true" tabindex="-1"></a><span class="in">                             "bmlvar",</span></span>
<span id="cb14-1298"><a href="#cb14-1298" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_mcse")</span></span>
<span id="cb14-1299"><a href="#cb14-1299" aria-hidden="true" tabindex="-1"></a><span class="in">  mcse_pwrtwoside &lt;- sqrt(</span></span>
<span id="cb14-1300"><a href="#cb14-1300" aria-hidden="true" tabindex="-1"></a><span class="in">    mean_pwrtwoside * (1 - mean_pwrtwoside) / n_rep)</span></span>
<span id="cb14-1301"><a href="#cb14-1301" aria-hidden="true" tabindex="-1"></a><span class="in">  names(mcse_pwrtwoside) &lt;- paste0("powertwoside", </span></span>
<span id="cb14-1302"><a href="#cb14-1302" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_reg",</span></span>
<span id="cb14-1303"><a href="#cb14-1303" aria-hidden="true" tabindex="-1"></a><span class="in">                             c(0, 2, 4),</span></span>
<span id="cb14-1304"><a href="#cb14-1304" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1305"><a href="#cb14-1305" aria-hidden="true" tabindex="-1"></a><span class="in">                             rep(measures, each = 3),</span></span>
<span id="cb14-1306"><a href="#cb14-1306" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_",</span></span>
<span id="cb14-1307"><a href="#cb14-1307" aria-hidden="true" tabindex="-1"></a><span class="in">                             "bmlvar",</span></span>
<span id="cb14-1308"><a href="#cb14-1308" aria-hidden="true" tabindex="-1"></a><span class="in">                             "_mcse")</span></span>
<span id="cb14-1309"><a href="#cb14-1309" aria-hidden="true" tabindex="-1"></a><span class="in">  ret[["mcse_rmse"]] &lt;- mcse_rmse</span></span>
<span id="cb14-1310"><a href="#cb14-1310" aria-hidden="true" tabindex="-1"></a><span class="in">  ret[["mcse_bias"]] &lt;- mcse_bias</span></span>
<span id="cb14-1311"><a href="#cb14-1311" aria-hidden="true" tabindex="-1"></a><span class="in">  ret[["mcse_mse"]] &lt;- mcse_mse</span></span>
<span id="cb14-1312"><a href="#cb14-1312" aria-hidden="true" tabindex="-1"></a><span class="in">  ret[["mcse_pwroneside"]] &lt;- mcse_pwroneside</span></span>
<span id="cb14-1313"><a href="#cb14-1313" aria-hidden="true" tabindex="-1"></a><span class="in">  ret[["mcse_pwrtwoside"]] &lt;- mcse_pwrtwoside</span></span>
<span id="cb14-1314"><a href="#cb14-1314" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1315"><a href="#cb14-1315" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1316"><a href="#cb14-1316" aria-hidden="true" tabindex="-1"></a><span class="in">  #--- Return</span></span>
<span id="cb14-1317"><a href="#cb14-1317" aria-hidden="true" tabindex="-1"></a><span class="in">  ret$bmlvar_diagnostics &lt;- list()</span></span>
<span id="cb14-1318"><a href="#cb14-1318" aria-hidden="true" tabindex="-1"></a><span class="in">  ret$bmlvar_diagnostics$rhat_bmlvar_mean &lt;- mean(sapply(results, function(x){</span></span>
<span id="cb14-1319"><a href="#cb14-1319" aria-hidden="true" tabindex="-1"></a><span class="in">     x$bmlvar$rhat_bmlvar_mean}))</span></span>
<span id="cb14-1320"><a href="#cb14-1320" aria-hidden="true" tabindex="-1"></a><span class="in">  ret$bmlvar_diagnostics$rhat11_bmlvar_mean &lt;- mean(sapply(results, function(x){</span></span>
<span id="cb14-1321"><a href="#cb14-1321" aria-hidden="true" tabindex="-1"></a><span class="in">     x$bmlvar$rhat_bmlvar_11}))</span></span>
<span id="cb14-1322"><a href="#cb14-1322" aria-hidden="true" tabindex="-1"></a><span class="in">  ret$bmlvar_diagnostics$divtrans_bmlvar_mean &lt;- mean(sapply(results, function(x){</span></span>
<span id="cb14-1323"><a href="#cb14-1323" aria-hidden="true" tabindex="-1"></a><span class="in">    x$bmlvar$divtrans_bmlvar}))</span></span>
<span id="cb14-1324"><a href="#cb14-1324" aria-hidden="true" tabindex="-1"></a><span class="in">  ret$bmlvar_diagnostics$divtrans_bmlvar_sum &lt;- sum(sapply(results, function(x){</span></span>
<span id="cb14-1325"><a href="#cb14-1325" aria-hidden="true" tabindex="-1"></a><span class="in">    x$bmlvar$divtrans_bmlvar}))</span></span>
<span id="cb14-1326"><a href="#cb14-1326" aria-hidden="true" tabindex="-1"></a><span class="in">  ret$bmlvar_diagnostics$divtrans_bmlvar_sumnonz &lt;- sum(sapply(results, function(x){</span></span>
<span id="cb14-1327"><a href="#cb14-1327" aria-hidden="true" tabindex="-1"></a><span class="in">    x$bmlvar$divtrans_bmlvar}) &gt; 0)</span></span>
<span id="cb14-1328"><a href="#cb14-1328" aria-hidden="true" tabindex="-1"></a><span class="in">  ret_vec &lt;- unlist(ret, use.names = TRUE)</span></span>
<span id="cb14-1329"><a href="#cb14-1329" aria-hidden="true" tabindex="-1"></a><span class="in">  return(ret_vec)</span></span>
<span id="cb14-1330"><a href="#cb14-1330" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1331"><a href="#cb14-1331" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1332"><a href="#cb14-1332" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1333"><a href="#cb14-1333" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1334"><a href="#cb14-1334" aria-hidden="true" tabindex="-1"></a><span class="in">}</span></span>
<span id="cb14-1335"><a href="#cb14-1335" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1336"><a href="#cb14-1336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1337"><a href="#cb14-1337" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-1338"><a href="#cb14-1338" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1339"><a href="#cb14-1339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1340"><a href="#cb14-1340" aria-hidden="true" tabindex="-1"></a><span class="fu"># Executing Simulation</span></span>
<span id="cb14-1341"><a href="#cb14-1341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1342"><a href="#cb14-1342" aria-hidden="true" tabindex="-1"></a><span class="in">```{r run-sim}</span></span>
<span id="cb14-1343"><a href="#cb14-1343" aria-hidden="true" tabindex="-1"></a><span class="in"># For testing</span></span>
<span id="cb14-1344"><a href="#cb14-1344" aria-hidden="true" tabindex="-1"></a><span class="in"># df_design_test &lt;- df_design[3,]</span></span>
<span id="cb14-1345"><a href="#cb14-1345" aria-hidden="true" tabindex="-1"></a><span class="in"># df_design_test$n_id &lt;- 200</span></span>
<span id="cb14-1346"><a href="#cb14-1346" aria-hidden="true" tabindex="-1"></a><span class="in"># df_design_test$n_var &lt;- 4</span></span>
<span id="cb14-1347"><a href="#cb14-1347" aria-hidden="true" tabindex="-1"></a><span class="in"># sim_pars$n_id &lt;- 200</span></span>
<span id="cb14-1348"><a href="#cb14-1348" aria-hidden="true" tabindex="-1"></a><span class="in"># sim_pars$n_var &lt;- 4</span></span>
<span id="cb14-1349"><a href="#cb14-1349" aria-hidden="true" tabindex="-1"></a><span class="in"># n_var &lt;- 4</span></span>
<span id="cb14-1350"><a href="#cb14-1350" aria-hidden="true" tabindex="-1"></a><span class="in"># n_id &lt;- 200</span></span>
<span id="cb14-1351"><a href="#cb14-1351" aria-hidden="true" tabindex="-1"></a><span class="in"># sim_pars$graph_sparse$beta &lt;- sim_pars$graph_sparse$beta[1:4,1:4]</span></span>
<span id="cb14-1352"><a href="#cb14-1352" aria-hidden="true" tabindex="-1"></a><span class="in"># sim_pars$graph_sparse$pcor &lt;- sim_pars$graph_sparse$pcor[1:4,1:4]</span></span>
<span id="cb14-1353"><a href="#cb14-1353" aria-hidden="true" tabindex="-1"></a><span class="in"># sim_pars$graph_sparse$kappa &lt;- sim_pars$graph_sparse$kappa[1:4,1:4]</span></span>
<span id="cb14-1354"><a href="#cb14-1354" aria-hidden="true" tabindex="-1"></a><span class="in"># sim_pars$graph_nonsparse$beta &lt;- sim_pars$graph_nonsparse$beta[1:4,1:4]</span></span>
<span id="cb14-1355"><a href="#cb14-1355" aria-hidden="true" tabindex="-1"></a><span class="in"># sim_pars$graph_nonsparse$pcor &lt;- sim_pars$graph_nonsparse$pcor[1:4,1:4]</span></span>
<span id="cb14-1356"><a href="#cb14-1356" aria-hidden="true" tabindex="-1"></a><span class="in"># sim_pars$graph_nonsparse$kappa &lt;- sim_pars$graph_nonsparse$kappa[1:4,1:4]</span></span>
<span id="cb14-1357"><a href="#cb14-1357" aria-hidden="true" tabindex="-1"></a><span class="in"># sim_pars$graph_sparse$sigma &lt;- sim_pars$graph_sparse$sigma[1:4,1:4]</span></span>
<span id="cb14-1358"><a href="#cb14-1358" aria-hidden="true" tabindex="-1"></a><span class="in"># sim_pars$graph_nonsparse$sigma &lt;- sim_pars$graph_nonsparse$sigma[1:4,1:4]</span></span>
<span id="cb14-1359"><a href="#cb14-1359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1360"><a href="#cb14-1360" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1361"><a href="#cb14-1361" aria-hidden="true" tabindex="-1"></a><span class="in">n_rep &lt;- 200</span></span>
<span id="cb14-1362"><a href="#cb14-1362" aria-hidden="true" tabindex="-1"></a><span class="in">n_workers &lt;- </span></span>
<span id="cb14-1363"><a href="#cb14-1363" aria-hidden="true" tabindex="-1"></a><span class="in">future::plan(multisession, workers = 60)</span></span>
<span id="cb14-1364"><a href="#cb14-1364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1365"><a href="#cb14-1365" aria-hidden="true" tabindex="-1"></a><span class="in"># started 2024-08-13 ~08:35</span></span>
<span id="cb14-1366"><a href="#cb14-1366" aria-hidden="true" tabindex="-1"></a><span class="in"># df_design_test &lt;- df_design[c(4),]</span></span>
<span id="cb14-1367"><a href="#cb14-1367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1368"><a href="#cb14-1368" aria-hidden="true" tabindex="-1"></a><span class="in">sim_results &lt;- SimDesign::runSimulation(</span></span>
<span id="cb14-1369"><a href="#cb14-1369" aria-hidden="true" tabindex="-1"></a><span class="in">                                    design = df_design, </span></span>
<span id="cb14-1370"><a href="#cb14-1370" aria-hidden="true" tabindex="-1"></a><span class="in">                                    replications = n_rep, </span></span>
<span id="cb14-1371"><a href="#cb14-1371" aria-hidden="true" tabindex="-1"></a><span class="in">                                    generate = sim_generate, </span></span>
<span id="cb14-1372"><a href="#cb14-1372" aria-hidden="true" tabindex="-1"></a><span class="in">                                    analyse = sim_analyse, </span></span>
<span id="cb14-1373"><a href="#cb14-1373" aria-hidden="true" tabindex="-1"></a><span class="in">                                    summarise = sim_summarise,</span></span>
<span id="cb14-1374"><a href="#cb14-1374" aria-hidden="true" tabindex="-1"></a><span class="in">                                    fixed_objects = sim_pars,</span></span>
<span id="cb14-1375"><a href="#cb14-1375" aria-hidden="true" tabindex="-1"></a><span class="in">                                    parallel = "future",</span></span>
<span id="cb14-1376"><a href="#cb14-1376" aria-hidden="true" tabindex="-1"></a><span class="in">                                    # parallel = TRUE,</span></span>
<span id="cb14-1377"><a href="#cb14-1377" aria-hidden="true" tabindex="-1"></a><span class="in">                                    max_errors = 2,</span></span>
<span id="cb14-1378"><a href="#cb14-1378" aria-hidden="true" tabindex="-1"></a><span class="in">                                    packages = c("tidyverse", </span></span>
<span id="cb14-1379"><a href="#cb14-1379" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 "gimme",</span></span>
<span id="cb14-1380"><a href="#cb14-1380" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 "mlVAR",</span></span>
<span id="cb14-1381"><a href="#cb14-1381" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 "graphicalVAR",</span></span>
<span id="cb14-1382"><a href="#cb14-1382" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 "lm.beta",</span></span>
<span id="cb14-1383"><a href="#cb14-1383" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 "bayestestR",</span></span>
<span id="cb14-1384"><a href="#cb14-1384" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 "posterior",</span></span>
<span id="cb14-1385"><a href="#cb14-1385" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 "rstan",</span></span>
<span id="cb14-1386"><a href="#cb14-1386" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 "corpcor",</span></span>
<span id="cb14-1387"><a href="#cb14-1387" aria-hidden="true" tabindex="-1"></a><span class="in">                                                 "Rcpp"),</span></span>
<span id="cb14-1388"><a href="#cb14-1388" aria-hidden="true" tabindex="-1"></a><span class="in">                                    save_results = TRUE,</span></span>
<span id="cb14-1389"><a href="#cb14-1389" aria-hidden="true" tabindex="-1"></a><span class="in">                                    filename = "sim_full.rds"</span></span>
<span id="cb14-1390"><a href="#cb14-1390" aria-hidden="true" tabindex="-1"></a><span class="in">                                    # save_seeds = TRUE</span></span>
<span id="cb14-1391"><a href="#cb14-1391" aria-hidden="true" tabindex="-1"></a><span class="in">                                    )</span></span>
<span id="cb14-1392"><a href="#cb14-1392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1393"><a href="#cb14-1393" aria-hidden="true" tabindex="-1"></a><span class="in">plan(sequential)</span></span>
<span id="cb14-1394"><a href="#cb14-1394" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1395"><a href="#cb14-1395" aria-hidden="true" tabindex="-1"></a><span class="in"># SimClean()</span></span>
<span id="cb14-1396"><a href="#cb14-1396" aria-hidden="true" tabindex="-1"></a><span class="in"># saveRDS(sim_results, file = here("output/pilot_sim_results_clean_2104.RDS"))</span></span>
<span id="cb14-1397"><a href="#cb14-1397" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1398"><a href="#cb14-1398" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-1399"><a href="#cb14-1399" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1400"><a href="#cb14-1400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1401"><a href="#cb14-1401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1402"><a href="#cb14-1402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1403"><a href="#cb14-1403" aria-hidden="true" tabindex="-1"></a><span class="fu"># Write to standard R script</span></span>
<span id="cb14-1404"><a href="#cb14-1404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1405"><a href="#cb14-1405" aria-hidden="true" tabindex="-1"></a>To run the simulation on the server, it can be easier to just execute an R script.</span>
<span id="cb14-1406"><a href="#cb14-1406" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1407"><a href="#cb14-1407" aria-hidden="true" tabindex="-1"></a><span class="in">```{r, eval = FALSE}</span></span>
<span id="cb14-1408"><a href="#cb14-1408" aria-hidden="true" tabindex="-1"></a><span class="in">knitr::purl(here::here("scripts", "01_centrality_simulation.qmd"), </span></span>
<span id="cb14-1409"><a href="#cb14-1409" aria-hidden="true" tabindex="-1"></a><span class="in">            output = here::here("scripts", "01_centrality_simulation.R"),</span></span>
<span id="cb14-1410"><a href="#cb14-1410" aria-hidden="true" tabindex="-1"></a><span class="in">            documentation = 2)</span></span>
<span id="cb14-1411"><a href="#cb14-1411" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-1412"><a href="#cb14-1412" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1413"><a href="#cb14-1413" aria-hidden="true" tabindex="-1"></a><span class="fu"># Resummarize after fixing details in summary function</span></span>
<span id="cb14-1414"><a href="#cb14-1414" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1415"><a href="#cb14-1415" aria-hidden="true" tabindex="-1"></a><span class="in">```{r resummarize, eval = FALSE}</span></span>
<span id="cb14-1416"><a href="#cb14-1416" aria-hidden="true" tabindex="-1"></a><span class="in">sim_res_resum &lt;- SimDesign::reSummarise(summarise = sim_summarise,</span></span>
<span id="cb14-1417"><a href="#cb14-1417" aria-hidden="true" tabindex="-1"></a><span class="in">                                        dir = here("sim_full.rds-results_pc04798"))</span></span>
<span id="cb14-1418"><a href="#cb14-1418" aria-hidden="true" tabindex="-1"></a><span class="in">saveRDS(object = sim_res_resum, here::here("output", "sim_results.RDS"))</span></span>
<span id="cb14-1419"><a href="#cb14-1419" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-1420"><a href="#cb14-1420" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1421"><a href="#cb14-1421" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1422"><a href="#cb14-1422" aria-hidden="true" tabindex="-1"></a>Add the run information (seed, time, etc.) from the previous output to the resummarized results object:</span>
<span id="cb14-1423"><a href="#cb14-1423" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1424"><a href="#cb14-1424" aria-hidden="true" tabindex="-1"></a><span class="in">```{r results-info, eval = FALSE}</span></span>
<span id="cb14-1425"><a href="#cb14-1425" aria-hidden="true" tabindex="-1"></a><span class="in">sim_res_old &lt;- readRDS(here("output", "sim_full.RDS"))</span></span>
<span id="cb14-1426"><a href="#cb14-1426" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1427"><a href="#cb14-1427" aria-hidden="true" tabindex="-1"></a><span class="in">sim_res_resum &lt;- readRDS(here("output", "sim_results.RDS"))</span></span>
<span id="cb14-1428"><a href="#cb14-1428" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1429"><a href="#cb14-1429" aria-hidden="true" tabindex="-1"></a><span class="in">sim_info &lt;- sim_res_old |&gt; </span></span>
<span id="cb14-1430"><a href="#cb14-1430" aria-hidden="true" tabindex="-1"></a><span class="in">  select(REPLICATIONS, SIM_TIME, RAM_USED, SEED, COMPLETED, WARNINGS) </span></span>
<span id="cb14-1431"><a href="#cb14-1431" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1432"><a href="#cb14-1432" aria-hidden="true" tabindex="-1"></a><span class="in">sim_res &lt;- bind_cols(sim_res_resum, sim_info)</span></span>
<span id="cb14-1433"><a href="#cb14-1433" aria-hidden="true" tabindex="-1"></a><span class="in">  </span></span>
<span id="cb14-1434"><a href="#cb14-1434" aria-hidden="true" tabindex="-1"></a><span class="in">saveRDS(object = sim_res, here::here("output", "sim_results.RDS"))</span></span>
<span id="cb14-1435"><a href="#cb14-1435" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb14-1436"><a href="#cb14-1436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1437"><a href="#cb14-1437" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-1438"><a href="#cb14-1438" aria-hidden="true" tabindex="-1"></a></span>
</code><button title="Copy to Clipboard" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->




</body></html>